(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();function w(e,t,r){function n(i,l){var u;Object.defineProperty(i,"_zod",{value:i._zod??{},enumerable:!1}),(u=i._zod).traits??(u.traits=new Set),i._zod.traits.add(e),t(i,l);for(const p in s.prototype)p in i||Object.defineProperty(i,p,{value:s.prototype[p].bind(i)});i._zod.constr=s,i._zod.def=l}const a=r?.Parent??Object;class o extends a{}Object.defineProperty(o,"name",{value:e});function s(i){var l;const u=r?.Parent?new o:this;n(u,i),(l=u._zod).deferred??(l.deferred=[]);for(const p of u._zod.deferred)p();return u}return Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:i=>r?.Parent&&i instanceof r.Parent?!0:i?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}class wr extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const xs={};function It(e){return xs}function Ts(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,a])=>t.indexOf(+n)===-1).map(([n,a])=>a)}function ju(e,t){return typeof t=="bigint"?t.toString():t}function _a(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function ba(e){return e==null}function wa(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function Uu(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n,o=Number.parseInt(e.toFixed(a).replace(".","")),s=Number.parseInt(t.toFixed(a).replace(".",""));return o%s/10**a}function G(e,t,r){Object.defineProperty(e,t,{get(){{const n=r();return e[t]=n,n}},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function Or(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function ir(e){return JSON.stringify(e)}const Es=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function tn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Fu=_a(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function rn(e){if(tn(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(tn(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}const qu=new Set(["string","number","symbol"]);function Nr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Zt(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function A(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Bu(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Vu={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Gu(e,t){const r={},n=e._zod.def;for(const a in t){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);t[a]&&(r[a]=n.shape[a])}return Zt(e,{...e._zod.def,shape:r,checks:[]})}function Hu(e,t){const r={...e._zod.def.shape},n=e._zod.def;for(const a in t){if(!(a in n.shape))throw new Error(`Unrecognized key: "${a}"`);t[a]&&delete r[a]}return Zt(e,{...e._zod.def,shape:r,checks:[]})}function Ju(e,t){if(!rn(t))throw new Error("Invalid input to extend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return Or(this,"shape",n),n},checks:[]};return Zt(e,r)}function Wu(e,t){return Zt(e,{...e._zod.def,get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return Or(this,"shape",r),r},catchall:t._zod.def.catchall,checks:[]})}function Yu(e,t,r){const n=t._zod.def.shape,a={...n};if(r)for(const o in r){if(!(o in n))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(a[o]=e?new e({type:"optional",innerType:n[o]}):n[o])}else for(const o in n)a[o]=e?new e({type:"optional",innerType:n[o]}):n[o];return Zt(t,{...t._zod.def,shape:a,checks:[]})}function Xu(e,t,r){const n=t._zod.def.shape,a={...n};if(r)for(const o in r){if(!(o in a))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(a[o]=new e({type:"nonoptional",innerType:n[o]}))}else for(const o in n)a[o]=new e({type:"nonoptional",innerType:n[o]});return Zt(t,{...t._zod.def,shape:a,checks:[]})}function yr(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function Nt(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function jr(e){return typeof e=="string"?e:e?.message}function At(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const a=jr(e.inst?._zod.def?.error?.(e))??jr(t?.error?.(e))??jr(r.customError?.(e))??jr(r.localeError?.(e))??"Invalid input";n.message=a}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function ka(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function kr(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const Ss=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,ju,2)},enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Is=w("$ZodError",Ss),As=w("$ZodError",Ss,{Parent:Error});function Ku(e,t=r=>r.message){const r={},n=[];for(const a of e.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(t(a))):n.push(t(a));return{formErrors:n,fieldErrors:r}}function Qu(e,t){const r=t||function(o){return o.message},n={_errors:[]},a=o=>{for(const s of o.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(i=>a({issues:i}));else if(s.code==="invalid_key")a({issues:s.issues});else if(s.code==="invalid_element")a({issues:s.issues});else if(s.path.length===0)n._errors.push(r(s));else{let i=n,l=0;for(;l<s.path.length;){const u=s.path[l];l===s.path.length-1?(i[u]=i[u]||{_errors:[]},i[u]._errors.push(r(s))):i[u]=i[u]||{_errors:[]},i=i[u],l++}}};return a(e),n}const ec=e=>(t,r,n,a)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new wr;if(s.issues.length){const i=new(a?.Err??e)(s.issues.map(l=>At(l,o,It())));throw Es(i,a?.callee),i}return s.value},tc=e=>async(t,r,n,a)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise&&(s=await s),s.issues.length){const i=new(a?.Err??e)(s.issues.map(l=>At(l,o,It())));throw Es(i,a?.callee),i}return s.value},Rs=e=>(t,r,n)=>{const a=n?{...n,async:!1}:{async:!1},o=t._zod.run({value:r,issues:[]},a);if(o instanceof Promise)throw new wr;return o.issues.length?{success:!1,error:new(e??Is)(o.issues.map(s=>At(s,a,It())))}:{success:!0,data:o.value}},rc=Rs(As),$s=e=>async(t,r,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},a);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(s=>At(s,a,It())))}:{success:!0,data:o.value}},nc=$s(As),ac=/^[cC][^\s-]{8,}$/,oc=/^[0-9a-z]+$/,sc=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ic=/^[0-9a-vA-V]{20}$/,lc=/^[A-Za-z0-9]{27}$/,uc=/^[a-zA-Z0-9_-]{21}$/,cc=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,pc=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,eo=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,dc=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,fc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function hc(){return new RegExp(fc,"u")}const mc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,gc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,vc=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,yc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_c=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Os=/^[A-Za-z0-9_-]*$/,bc=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,wc=/^\+(?:[0-9]){6,14}[0-9]$/,Ns="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",kc=new RegExp(`^${Ns}$`);function Cs(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function xc(e){return new RegExp(`^${Cs(e)}$`)}function Tc(e){const t=Cs({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-]\\d{2}:\\d{2})");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${Ns}T(?:${n})$`)}const Ec=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Sc=/^\d+$/,Ic=/^-?\d+(?:\.\d+)?/i,Ac=/true|false/i,Rc=/null/i,$c=/^[^A-Z]*$/,Oc=/^[^a-z]*$/,je=w("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Ps={number:"number",bigint:"bigint",object:"date"},Ms=w("$ZodCheckLessThan",(e,t)=>{je.init(e,t);const r=Ps[typeof t.value];e._zod.onattach.push(n=>{const a=n._zod.bag,o=(t.inclusive?a.maximum:a.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?a.maximum=t.value:a.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),zs=w("$ZodCheckGreaterThan",(e,t)=>{je.init(e,t);const r=Ps[typeof t.value];e._zod.onattach.push(n=>{const a=n._zod.bag,o=(t.inclusive?a.minimum:a.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?a.minimum=t.value:a.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Nc=w("$ZodCheckMultipleOf",(e,t)=>{je.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):Uu(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),Cc=w("$ZodCheckNumberFormat",(e,t)=>{je.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[a,o]=Vu[t.format];e._zod.onattach.push(s=>{const i=s._zod.bag;i.format=t.format,i.minimum=a,i.maximum=o,r&&(i.pattern=Sc)}),e._zod.check=s=>{const i=s.value;if(r){if(!Number.isInteger(i)){s.issues.push({expected:n,format:t.format,code:"invalid_type",input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?s.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):s.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}i<a&&s.issues.push({origin:"number",input:i,code:"too_small",minimum:a,inclusive:!0,inst:e,continue:!t.abort}),i>o&&s.issues.push({origin:"number",input:i,code:"too_big",maximum:o,inst:e})}}),Pc=w("$ZodCheckMaxLength",(e,t)=>{var r;je.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!ba(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<a&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const a=n.value;if(a.length<=t.maximum)return;const s=ka(a);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:a,inst:e,continue:!t.abort})}}),Mc=w("$ZodCheckMinLength",(e,t)=>{var r;je.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!ba(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>a&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const a=n.value;if(a.length>=t.minimum)return;const s=ka(a);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:a,inst:e,continue:!t.abort})}}),zc=w("$ZodCheckLengthEquals",(e,t)=>{var r;je.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!ba(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag;a.minimum=t.length,a.maximum=t.length,a.length=t.length}),e._zod.check=n=>{const a=n.value,o=a.length;if(o===t.length)return;const s=ka(a),i=o>t.length;n.issues.push({origin:s,...i?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),kn=w("$ZodCheckStringFormat",(e,t)=>{var r,n;je.init(e,t),e._zod.onattach.push(a=>{const o=a._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=a=>{t.pattern.lastIndex=0,!t.pattern.test(a.value)&&a.issues.push({origin:"string",code:"invalid_format",format:t.format,input:a.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),Dc=w("$ZodCheckRegex",(e,t)=>{kn.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Zc=w("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=$c),kn.init(e,t)}),Lc=w("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Oc),kn.init(e,t)}),jc=w("$ZodCheckIncludes",(e,t)=>{je.init(e,t);const r=Nr(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(a=>{const o=a._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=a=>{a.value.includes(t.includes,t.position)||a.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:a.value,inst:e,continue:!t.abort})}}),Uc=w("$ZodCheckStartsWith",(e,t)=>{je.init(e,t);const r=new RegExp(`^${Nr(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const a=n._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),Fc=w("$ZodCheckEndsWith",(e,t)=>{je.init(e,t);const r=new RegExp(`.*${Nr(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const a=n._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),qc=w("$ZodCheckOverwrite",(e,t)=>{je.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class Bc{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(s=>s),a=Math.min(...n.map(s=>s.length-s.trimStart().length)),o=n.map(s=>s.slice(a)).map(s=>" ".repeat(this.indent*2)+s);for(const s of o)this.content.push(s)}compile(){const t=Function,r=this?.args,a=[...(this?.content??[""]).map(o=>`  ${o}`)];return new t(...r,a.join(`
`))}}const Vc={major:4,minor:0,patch:0},te=w("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Vc;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const a of n)for(const o of a._zod.onattach)o(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const a=(o,s,i)=>{let l=yr(o),u;for(const p of s){if(p._zod.def.when){if(!p._zod.def.when(o))continue}else if(l)continue;const f=o.issues.length,v=p._zod.check(o);if(v instanceof Promise&&i?.async===!1)throw new wr;if(u||v instanceof Promise)u=(u??Promise.resolve()).then(async()=>{await v,o.issues.length!==f&&(l||(l=yr(o,f)))});else{if(o.issues.length===f)continue;l||(l=yr(o,f))}}return u?u.then(()=>o):o};e._zod.run=(o,s)=>{const i=e._zod.parse(o,s);if(i instanceof Promise){if(s.async===!1)throw new wr;return i.then(l=>a(l,n,s))}return a(i,n,s)}}e["~standard"]={validate:a=>{try{const o=rc(e,a);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return nc(e,a).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),xa=w("$ZodString",(e,t)=>{te.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Ec(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),le=w("$ZodStringFormat",(e,t)=>{kn.init(e,t),xa.init(e,t)}),Gc=w("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=pc),le.init(e,t)}),Hc=w("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=eo(n))}else t.pattern??(t.pattern=eo());le.init(e,t)}),Jc=w("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=dc),le.init(e,t)}),Wc=w("$ZodURL",(e,t)=>{le.init(e,t),e._zod.check=r=>{try{const n=r.value,a=new URL(n),o=a.href;t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(a.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:bc.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(a.protocol.endsWith(":")?a.protocol.slice(0,-1):a.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),!n.endsWith("/")&&o.endsWith("/")?r.value=o.slice(0,-1):r.value=o;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),Yc=w("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=hc()),le.init(e,t)}),Xc=w("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=uc),le.init(e,t)}),Kc=w("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=ac),le.init(e,t)}),Qc=w("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=oc),le.init(e,t)}),ep=w("$ZodULID",(e,t)=>{t.pattern??(t.pattern=sc),le.init(e,t)}),tp=w("$ZodXID",(e,t)=>{t.pattern??(t.pattern=ic),le.init(e,t)}),rp=w("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=lc),le.init(e,t)}),np=w("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Tc(t)),le.init(e,t)}),ap=w("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=kc),le.init(e,t)}),op=w("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=xc(t)),le.init(e,t)}),sp=w("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=cc),le.init(e,t)}),ip=w("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=mc),le.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),lp=w("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=gc),le.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),up=w("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=vc),le.init(e,t)}),cp=w("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=yc),le.init(e,t),e._zod.check=r=>{const[n,a]=r.value.split("/");try{if(!a)throw new Error;const o=Number(a);if(`${o}`!==a)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${n}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Ds(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const pp=w("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=_c),le.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{Ds(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function dp(e){if(!Os.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Ds(r)}const fp=w("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Os),le.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{dp(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),hp=w("$ZodE164",(e,t)=>{t.pattern??(t.pattern=wc),le.init(e,t)});function mp(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const a=JSON.parse(atob(n));return!("typ"in a&&a?.typ!=="JWT"||!a.alg||t&&(!("alg"in a)||a.alg!==t))}catch{return!1}}const gp=w("$ZodJWT",(e,t)=>{le.init(e,t),e._zod.check=r=>{mp(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Zs=w("$ZodNumber",(e,t)=>{te.init(e,t),e._zod.pattern=e._zod.bag.pattern??Ic,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const a=r.value;if(typeof a=="number"&&!Number.isNaN(a)&&Number.isFinite(a))return r;const o=typeof a=="number"?Number.isNaN(a)?"NaN":Number.isFinite(a)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:a,inst:e,...o?{received:o}:{}}),r}}),vp=w("$ZodNumber",(e,t)=>{Cc.init(e,t),Zs.init(e,t)}),yp=w("$ZodBoolean",(e,t)=>{te.init(e,t),e._zod.pattern=Ac,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const a=r.value;return typeof a=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:a,inst:e}),r}}),_p=w("$ZodNull",(e,t)=>{te.init(e,t),e._zod.pattern=Rc,e._zod.values=new Set([null]),e._zod.parse=(r,n)=>{const a=r.value;return a===null||r.issues.push({expected:"null",code:"invalid_type",input:a,inst:e}),r}}),bp=w("$ZodAny",(e,t)=>{te.init(e,t),e._zod.parse=r=>r}),wp=w("$ZodUnknown",(e,t)=>{te.init(e,t),e._zod.parse=r=>r}),kp=w("$ZodNever",(e,t)=>{te.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function to(e,t,r){e.issues.length&&t.issues.push(...Nt(r,e.issues)),t.value[r]=e.value}const xp=w("$ZodArray",(e,t)=>{te.init(e,t),e._zod.parse=(r,n)=>{const a=r.value;if(!Array.isArray(a))return r.issues.push({expected:"array",code:"invalid_type",input:a,inst:e}),r;r.value=Array(a.length);const o=[];for(let s=0;s<a.length;s++){const i=a[s],l=t.element._zod.run({value:i,issues:[]},n);l instanceof Promise?o.push(l.then(u=>to(u,r,s))):to(l,r,s)}return o.length?Promise.all(o).then(()=>r):r}});function Ur(e,t,r){e.issues.length&&t.issues.push(...Nt(r,e.issues)),t.value[r]=e.value}function ro(e,t,r,n){e.issues.length?n[r]===void 0?r in n?t.value[r]=void 0:t.value[r]=e.value:t.issues.push(...Nt(r,e.issues)):e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}const Tp=w("$ZodObject",(e,t)=>{te.init(e,t);const r=_a(()=>{const f=Object.keys(t.shape);for(const c of f)if(!(t.shape[c]instanceof te))throw new Error(`Invalid element at key "${c}": expected a Zod schema`);const v=Bu(t.shape);return{shape:t.shape,keys:f,keySet:new Set(f),numKeys:f.length,optionalKeys:new Set(v)}});G(e._zod,"propValues",()=>{const f=t.shape,v={};for(const c in f){const d=f[c]._zod;if(d.values){v[c]??(v[c]=new Set);for(const m of d.values)v[c].add(m)}}return v});const n=f=>{const v=new Bc(["shape","payload","ctx"]),c=r.value,d=k=>{const x=ir(k);return`shape[${x}]._zod.run({ value: input[${x}], issues: [] }, ctx)`};v.write("const input = payload.value;");const m=Object.create(null);let y=0;for(const k of c.keys)m[k]=`key_${y++}`;v.write("const newResult = {}");for(const k of c.keys)if(c.optionalKeys.has(k)){const x=m[k];v.write(`const ${x} = ${d(k)};`);const g=ir(k);v.write(`
        if (${x}.issues.length) {
          if (input[${g}] === undefined) {
            if (${g} in input) {
              newResult[${g}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${x}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${g}, ...iss.path] : [${g}],
              }))
            );
          }
        } else if (${x}.value === undefined) {
          if (${g} in input) newResult[${g}] = undefined;
        } else {
          newResult[${g}] = ${x}.value;
        }
        `)}else{const x=m[k];v.write(`const ${x} = ${d(k)};`),v.write(`
          if (${x}.issues.length) payload.issues = payload.issues.concat(${x}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${ir(k)}, ...iss.path] : [${ir(k)}]
          })));`),v.write(`newResult[${ir(k)}] = ${x}.value`)}v.write("payload.value = newResult;"),v.write("return payload;");const b=v.compile();return(k,x)=>b(f,k,x)};let a;const o=tn,s=!xs.jitless,l=s&&Fu.value,u=t.catchall;let p;e._zod.parse=(f,v)=>{p??(p=r.value);const c=f.value;if(!o(c))return f.issues.push({expected:"object",code:"invalid_type",input:c,inst:e}),f;const d=[];if(s&&l&&v?.async===!1&&v.jitless!==!0)a||(a=n(t.shape)),f=a(f,v);else{f.value={};const x=p.shape;for(const g of p.keys){const C=x[g],M=C._zod.run({value:c[g],issues:[]},v),O=C._zod.optin==="optional"&&C._zod.optout==="optional";M instanceof Promise?d.push(M.then(F=>O?ro(F,f,g,c):Ur(F,f,g))):O?ro(M,f,g,c):Ur(M,f,g)}}if(!u)return d.length?Promise.all(d).then(()=>f):f;const m=[],y=p.keySet,b=u._zod,k=b.def.type;for(const x of Object.keys(c)){if(y.has(x))continue;if(k==="never"){m.push(x);continue}const g=b.run({value:c[x],issues:[]},v);g instanceof Promise?d.push(g.then(C=>Ur(C,f,x))):Ur(g,f,x)}return m.length&&f.issues.push({code:"unrecognized_keys",keys:m,input:c,inst:e}),d.length?Promise.all(d).then(()=>f):f}});function no(e,t,r,n){for(const a of e)if(a.issues.length===0)return t.value=a.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(a=>a.issues.map(o=>At(o,n,It())))}),t}const Ls=w("$ZodUnion",(e,t)=>{te.init(e,t),G(e._zod,"optin",()=>t.options.some(r=>r._zod.optin==="optional")?"optional":void 0),G(e._zod,"optout",()=>t.options.some(r=>r._zod.optout==="optional")?"optional":void 0),G(e._zod,"values",()=>{if(t.options.every(r=>r._zod.values))return new Set(t.options.flatMap(r=>Array.from(r._zod.values)))}),G(e._zod,"pattern",()=>{if(t.options.every(r=>r._zod.pattern)){const r=t.options.map(n=>n._zod.pattern);return new RegExp(`^(${r.map(n=>wa(n.source)).join("|")})$`)}}),e._zod.parse=(r,n)=>{let a=!1;const o=[];for(const s of t.options){const i=s._zod.run({value:r.value,issues:[]},n);if(i instanceof Promise)o.push(i),a=!0;else{if(i.issues.length===0)return i;o.push(i)}}return a?Promise.all(o).then(s=>no(s,r,e,n)):no(o,r,e,n)}}),Ep=w("$ZodDiscriminatedUnion",(e,t)=>{Ls.init(e,t);const r=e._zod.parse;G(e._zod,"propValues",()=>{const a={};for(const o of t.options){const s=o._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(o)}"`);for(const[i,l]of Object.entries(s)){a[i]||(a[i]=new Set);for(const u of l)a[i].add(u)}}return a});const n=_a(()=>{const a=t.options,o=new Map;for(const s of a){const i=s._zod.propValues[t.discriminator];if(!i||i.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(s)}"`);for(const l of i){if(o.has(l))throw new Error(`Duplicate discriminator value "${String(l)}"`);o.set(l,s)}}return o});e._zod.parse=(a,o)=>{const s=a.value;if(!tn(s))return a.issues.push({code:"invalid_type",expected:"object",input:s,inst:e}),a;const i=n.value.get(s?.[t.discriminator]);return i?i._zod.run(a,o):t.unionFallback?r(a,o):(a.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:s,path:[t.discriminator],inst:e}),a)}}),Sp=w("$ZodIntersection",(e,t)=>{te.init(e,t),e._zod.parse=(r,n)=>{const a=r.value,o=t.left._zod.run({value:a,issues:[]},n),s=t.right._zod.run({value:a,issues:[]},n);return o instanceof Promise||s instanceof Promise?Promise.all([o,s]).then(([l,u])=>ao(r,l,u)):ao(r,o,s)}});function Qn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(rn(e)&&rn(t)){const r=Object.keys(t),n=Object.keys(e).filter(o=>r.indexOf(o)!==-1),a={...e,...t};for(const o of n){const s=Qn(e[o],t[o]);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};a[o]=s.data}return{valid:!0,data:a}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const a=e[n],o=t[n],s=Qn(a,o);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function ao(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),yr(e))return e;const n=Qn(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const Ip=w("$ZodRecord",(e,t)=>{te.init(e,t),e._zod.parse=(r,n)=>{const a=r.value;if(!rn(a))return r.issues.push({expected:"record",code:"invalid_type",input:a,inst:e}),r;const o=[];if(t.keyType._zod.values){const s=t.keyType._zod.values;r.value={};for(const l of s)if(typeof l=="string"||typeof l=="number"||typeof l=="symbol"){const u=t.valueType._zod.run({value:a[l],issues:[]},n);u instanceof Promise?o.push(u.then(p=>{p.issues.length&&r.issues.push(...Nt(l,p.issues)),r.value[l]=p.value})):(u.issues.length&&r.issues.push(...Nt(l,u.issues)),r.value[l]=u.value)}let i;for(const l in a)s.has(l)||(i=i??[],i.push(l));i&&i.length>0&&r.issues.push({code:"unrecognized_keys",input:a,inst:e,keys:i})}else{r.value={};for(const s of Reflect.ownKeys(a)){if(s==="__proto__")continue;const i=t.keyType._zod.run({value:s,issues:[]},n);if(i instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(i.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:i.issues.map(u=>At(u,n,It())),input:s,path:[s],inst:e}),r.value[i.value]=i.value;continue}const l=t.valueType._zod.run({value:a[s],issues:[]},n);l instanceof Promise?o.push(l.then(u=>{u.issues.length&&r.issues.push(...Nt(s,u.issues)),r.value[i.value]=u.value})):(l.issues.length&&r.issues.push(...Nt(s,l.issues)),r.value[i.value]=l.value)}}return o.length?Promise.all(o).then(()=>r):r}}),Ap=w("$ZodEnum",(e,t)=>{te.init(e,t);const r=Ts(t.entries);e._zod.values=new Set(r),e._zod.pattern=new RegExp(`^(${r.filter(n=>qu.has(typeof n)).map(n=>typeof n=="string"?Nr(n):n.toString()).join("|")})$`),e._zod.parse=(n,a)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:r,input:o,inst:e}),n}}),Rp=w("$ZodLiteral",(e,t)=>{te.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?Nr(r):r?r.toString():String(r)).join("|")})$`),e._zod.parse=(r,n)=>{const a=r.value;return e._zod.values.has(a)||r.issues.push({code:"invalid_value",values:t.values,input:a,inst:e}),r}}),$p=w("$ZodTransform",(e,t)=>{te.init(e,t),e._zod.parse=(r,n)=>{const a=t.transform(r.value,r);if(n.async)return(a instanceof Promise?a:Promise.resolve(a)).then(s=>(r.value=s,r));if(a instanceof Promise)throw new wr;return r.value=a,r}}),Op=w("$ZodOptional",(e,t)=>{te.init(e,t),e._zod.optin="optional",e._zod.optout="optional",G(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),G(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${wa(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>t.innerType._zod.optin==="optional"?t.innerType._zod.run(r,n):r.value===void 0?r:t.innerType._zod.run(r,n)}),Np=w("$ZodNullable",(e,t)=>{te.init(e,t),G(e._zod,"optin",()=>t.innerType._zod.optin),G(e._zod,"optout",()=>t.innerType._zod.optout),G(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${wa(r.source)}|null)$`):void 0}),G(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),Cp=w("$ZodDefault",(e,t)=>{te.init(e,t),e._zod.optin="optional",G(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(r.value===void 0)return r.value=t.defaultValue,r;const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>oo(o,t)):oo(a,t)}});function oo(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Pp=w("$ZodPrefault",(e,t)=>{te.init(e,t),e._zod.optin="optional",G(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),Mp=w("$ZodNonOptional",(e,t)=>{te.init(e,t),G(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>so(o,e)):so(a,e)}});function so(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const zp=w("$ZodCatch",(e,t)=>{te.init(e,t),e._zod.optin="optional",G(e._zod,"optout",()=>t.innerType._zod.optout),G(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(s=>At(s,n,It()))},input:r.value}),r.issues=[]),r)):(r.value=a.value,a.issues.length&&(r.value=t.catchValue({...r,error:{issues:a.issues.map(o=>At(o,n,It()))},input:r.value}),r.issues=[]),r)}}),Dp=w("$ZodPipe",(e,t)=>{te.init(e,t),G(e._zod,"values",()=>t.in._zod.values),G(e._zod,"optin",()=>t.in._zod.optin),G(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(r,n)=>{const a=t.in._zod.run(r,n);return a instanceof Promise?a.then(o=>io(o,t,n)):io(a,t,n)}});function io(e,t,r){return yr(e)?e:t.out._zod.run({value:e.value,issues:e.issues},r)}const Zp=w("$ZodReadonly",(e,t)=>{te.init(e,t),G(e._zod,"propValues",()=>t.innerType._zod.propValues),G(e._zod,"values",()=>t.innerType._zod.values),G(e._zod,"optin",()=>t.innerType._zod.optin),G(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(lo):lo(a)}});function lo(e){return e.value=Object.freeze(e.value),e}const Lp=w("$ZodLazy",(e,t)=>{te.init(e,t),G(e._zod,"innerType",()=>t.getter()),G(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),G(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),G(e._zod,"optin",()=>e._zod.innerType._zod.optin),G(e._zod,"optout",()=>e._zod.innerType._zod.optout),e._zod.parse=(r,n)=>e._zod.innerType._zod.run(r,n)}),jp=w("$ZodCustom",(e,t)=>{je.init(e,t),te.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,a=t.fn(n);if(a instanceof Promise)return a.then(o=>uo(o,r,n,e));uo(a,r,n,e)}});function uo(e,t,r,n){if(!e){const a={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(a.params=n._zod.def.params),t.issues.push(kr(a))}}class js{constructor(){this._map=new Map,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};return delete n.id,{...n,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function Up(){return new js}const vr=Up();function Fp(e,t){return new e({type:"string",...A(t)})}function qp(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...A(t)})}function co(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...A(t)})}function Bp(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...A(t)})}function Vp(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...A(t)})}function Gp(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...A(t)})}function Hp(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...A(t)})}function Jp(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...A(t)})}function Wp(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...A(t)})}function Yp(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...A(t)})}function Xp(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...A(t)})}function Kp(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...A(t)})}function Qp(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...A(t)})}function ed(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...A(t)})}function td(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...A(t)})}function rd(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...A(t)})}function nd(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...A(t)})}function ad(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...A(t)})}function od(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...A(t)})}function Us(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...A(t)})}function sd(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...A(t)})}function id(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...A(t)})}function ld(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...A(t)})}function ud(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...A(t)})}function cd(e,t){return new e({type:"string",format:"date",check:"string_format",...A(t)})}function pd(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...A(t)})}function dd(e,t){return new e({type:"string",format:"duration",check:"string_format",...A(t)})}function fd(e,t){return new e({type:"number",checks:[],...A(t)})}function hd(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...A(t)})}function md(e,t){return new e({type:"boolean",...A(t)})}function gd(e,t){return new e({type:"null",...A(t)})}function vd(e){return new e({type:"any"})}function yd(e){return new e({type:"unknown"})}function _d(e,t){return new e({type:"never",...A(t)})}function po(e,t){return new Ms({check:"less_than",...A(t),value:e,inclusive:!1})}function Cn(e,t){return new Ms({check:"less_than",...A(t),value:e,inclusive:!0})}function fo(e,t){return new zs({check:"greater_than",...A(t),value:e,inclusive:!1})}function Pn(e,t){return new zs({check:"greater_than",...A(t),value:e,inclusive:!0})}function ho(e,t){return new Nc({check:"multiple_of",...A(t),value:e})}function Fs(e,t){return new Pc({check:"max_length",...A(t),maximum:e})}function nn(e,t){return new Mc({check:"min_length",...A(t),minimum:e})}function qs(e,t){return new zc({check:"length_equals",...A(t),length:e})}function bd(e,t){return new Dc({check:"string_format",format:"regex",...A(t),pattern:e})}function wd(e){return new Zc({check:"string_format",format:"lowercase",...A(e)})}function kd(e){return new Lc({check:"string_format",format:"uppercase",...A(e)})}function xd(e,t){return new jc({check:"string_format",format:"includes",...A(t),includes:e})}function Td(e,t){return new Uc({check:"string_format",format:"starts_with",...A(t),prefix:e})}function Ed(e,t){return new Fc({check:"string_format",format:"ends_with",...A(t),suffix:e})}function Cr(e){return new qc({check:"overwrite",tx:e})}function Sd(e){return Cr(t=>t.normalize(e))}function Id(){return Cr(e=>e.trim())}function Ad(){return Cr(e=>e.toLowerCase())}function Rd(){return Cr(e=>e.toUpperCase())}function $d(e,t,r){return new e({type:"array",element:t,...A(r)})}function Od(e,t,r){const n=A(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}function Nd(e,t,r){return new e({type:"custom",check:"custom",fn:t,...A(r)})}class mo{constructor(t){this.counter=0,this.metadataRegistry=t?.metadata??vr,this.target=t?.target??"draft-2020-12",this.unrepresentable=t?.unrepresentable??"throw",this.override=t?.override??(()=>{}),this.io=t?.io??"output",this.seen=new Map}process(t,r={path:[],schemaPath:[]}){var n;const a=t._zod.def,o={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(t);if(s)return s.count++,r.schemaPath.includes(t)&&(s.cycle=r.path),s.schema;const i={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(t,i);const l=t._zod.toJSONSchema?.();if(l)i.schema=l;else{const f={...r,schemaPath:[...r.schemaPath,t],path:r.path},v=t._zod.parent;if(v)i.ref=v,this.process(v,f),this.seen.get(v).isParent=!0;else{const c=i.schema;switch(a.type){case"string":{const d=c;d.type="string";const{minimum:m,maximum:y,format:b,patterns:k,contentEncoding:x}=t._zod.bag;if(typeof m=="number"&&(d.minLength=m),typeof y=="number"&&(d.maxLength=y),b&&(d.format=o[b]??b,d.format===""&&delete d.format),x&&(d.contentEncoding=x),k&&k.size>0){const g=[...k];g.length===1?d.pattern=g[0].source:g.length>1&&(i.schema.allOf=[...g.map(C=>({...this.target==="draft-7"?{type:"string"}:{},pattern:C.source}))])}break}case"number":{const d=c,{minimum:m,maximum:y,format:b,multipleOf:k,exclusiveMaximum:x,exclusiveMinimum:g}=t._zod.bag;typeof b=="string"&&b.includes("int")?d.type="integer":d.type="number",typeof g=="number"&&(d.exclusiveMinimum=g),typeof m=="number"&&(d.minimum=m,typeof g=="number"&&(g>=m?delete d.minimum:delete d.exclusiveMinimum)),typeof x=="number"&&(d.exclusiveMaximum=x),typeof y=="number"&&(d.maximum=y,typeof x=="number"&&(x<=y?delete d.maximum:delete d.exclusiveMaximum)),typeof k=="number"&&(d.multipleOf=k);break}case"boolean":{const d=c;d.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{c.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{c.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const d=c,{minimum:m,maximum:y}=t._zod.bag;typeof m=="number"&&(d.minItems=m),typeof y=="number"&&(d.maxItems=y),d.type="array",d.items=this.process(a.element,{...f,path:[...f.path,"items"]});break}case"object":{const d=c;d.type="object",d.properties={};const m=a.shape;for(const k in m)d.properties[k]=this.process(m[k],{...f,path:[...f.path,"properties",k]});const y=new Set(Object.keys(m)),b=new Set([...y].filter(k=>{const x=a.shape[k]._zod;return this.io==="input"?x.optin===void 0:x.optout===void 0}));b.size>0&&(d.required=Array.from(b)),a.catchall?._zod.def.type==="never"?d.additionalProperties=!1:a.catchall?a.catchall&&(d.additionalProperties=this.process(a.catchall,{...f,path:[...f.path,"additionalProperties"]})):this.io==="output"&&(d.additionalProperties=!1);break}case"union":{const d=c;d.anyOf=a.options.map((m,y)=>this.process(m,{...f,path:[...f.path,"anyOf",y]}));break}case"intersection":{const d=c,m=this.process(a.left,{...f,path:[...f.path,"allOf",0]}),y=this.process(a.right,{...f,path:[...f.path,"allOf",1]}),b=x=>"allOf"in x&&Object.keys(x).length===1,k=[...b(m)?m.allOf:[m],...b(y)?y.allOf:[y]];d.allOf=k;break}case"tuple":{const d=c;d.type="array";const m=a.items.map((k,x)=>this.process(k,{...f,path:[...f.path,"prefixItems",x]}));if(this.target==="draft-2020-12"?d.prefixItems=m:d.items=m,a.rest){const k=this.process(a.rest,{...f,path:[...f.path,"items"]});this.target==="draft-2020-12"?d.items=k:d.additionalItems=k}a.rest&&(d.items=this.process(a.rest,{...f,path:[...f.path,"items"]}));const{minimum:y,maximum:b}=t._zod.bag;typeof y=="number"&&(d.minItems=y),typeof b=="number"&&(d.maxItems=b);break}case"record":{const d=c;d.type="object",d.propertyNames=this.process(a.keyType,{...f,path:[...f.path,"propertyNames"]}),d.additionalProperties=this.process(a.valueType,{...f,path:[...f.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const d=c,m=Ts(a.entries);m.every(y=>typeof y=="number")&&(d.type="number"),m.every(y=>typeof y=="string")&&(d.type="string"),d.enum=m;break}case"literal":{const d=c,m=[];for(const y of a.values)if(y===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof y=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(y))}else m.push(y);if(m.length!==0)if(m.length===1){const y=m[0];d.type=y===null?"null":typeof y,d.const=y}else m.every(y=>typeof y=="number")&&(d.type="number"),m.every(y=>typeof y=="string")&&(d.type="string"),m.every(y=>typeof y=="boolean")&&(d.type="string"),m.every(y=>y===null)&&(d.type="null"),d.enum=m;break}case"file":{const d=c,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:y,maximum:b,mime:k}=t._zod.bag;y!==void 0&&(m.minLength=y),b!==void 0&&(m.maxLength=b),k?k.length===1?(m.contentMediaType=k[0],Object.assign(d,m)):d.anyOf=k.map(x=>({...m,contentMediaType:x})):Object.assign(d,m);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const d=this.process(a.innerType,f);c.anyOf=[d,{type:"null"}];break}case"nonoptional":{this.process(a.innerType,f),i.ref=a.innerType;break}case"success":{const d=c;d.type="boolean";break}case"default":{this.process(a.innerType,f),i.ref=a.innerType,c.default=JSON.parse(JSON.stringify(a.defaultValue));break}case"prefault":{this.process(a.innerType,f),i.ref=a.innerType,this.io==="input"&&(c._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break}case"catch":{this.process(a.innerType,f),i.ref=a.innerType;let d;try{d=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}c.default=d;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const d=c,m=t._zod.pattern;if(!m)throw new Error("Pattern not found in template literal");d.type="string",d.pattern=m.source;break}case"pipe":{const d=this.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;this.process(d,f),i.ref=d;break}case"readonly":{this.process(a.innerType,f),i.ref=a.innerType,c.readOnly=!0;break}case"promise":{this.process(a.innerType,f),i.ref=a.innerType;break}case"optional":{this.process(a.innerType,f),i.ref=a.innerType;break}case"lazy":{const d=t._zod.innerType;this.process(d,f),i.ref=d;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const u=this.metadataRegistry.get(t);return u&&Object.assign(i.schema,u),this.io==="input"&&ke(t)&&(delete i.schema.examples,delete i.schema.default),this.io==="input"&&i.schema._prefault&&((n=i.schema).default??(n.default=i.schema._prefault)),delete i.schema._prefault,this.seen.get(t).schema}emit(t,r){const n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},a=this.seen.get(t);if(!a)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=p=>{const f=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const m=n.external.registry.get(p[0])?.id,y=n.external.uri??(k=>k);if(m)return{ref:y(m)};const b=p[1].defId??p[1].schema.id??`schema${this.counter++}`;return p[1].defId=b,{defId:b,ref:`${y("__shared")}#/${f}/${b}`}}if(p[1]===a)return{ref:"#"};const c=`#/${f}/`,d=p[1].schema.id??`__schema${this.counter++}`;return{defId:d,ref:c+d}},s=p=>{if(p[1].schema.$ref)return;const f=p[1],{ref:v,defId:c}=o(p);f.def={...f.schema},c&&(f.defId=c);const d=f.schema;for(const m in d)delete d[m];d.$ref=v};if(n.cycles==="throw")for(const p of this.seen.entries()){const f=p[1];if(f.cycle)throw new Error(`Cycle detected: #/${f.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const p of this.seen.entries()){const f=p[1];if(t===p[0]){s(p);continue}if(n.external){const c=n.external.registry.get(p[0])?.id;if(t!==p[0]&&c){s(p);continue}}if(this.metadataRegistry.get(p[0])?.id){s(p);continue}if(f.cycle){s(p);continue}if(f.count>1&&n.reused==="ref"){s(p);continue}}const i=(p,f)=>{const v=this.seen.get(p),c=v.def??v.schema,d={...c};if(v.ref===null)return;const m=v.ref;if(v.ref=null,m){i(m,f);const y=this.seen.get(m).schema;y.$ref&&f.target==="draft-7"?(c.allOf=c.allOf??[],c.allOf.push(y)):(Object.assign(c,y),Object.assign(c,d))}v.isParent||this.override({zodSchema:p,jsonSchema:c,path:v.path??[]})};for(const p of[...this.seen.entries()].reverse())i(p[0],{target:this.target});const l={};if(this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){const p=n.external.registry.get(t)?.id;if(!p)throw new Error("Schema is missing an `id` property");l.$id=n.external.uri(p)}Object.assign(l,a.def);const u=n.external?.defs??{};for(const p of this.seen.entries()){const f=p[1];f.def&&f.defId&&(u[f.defId]=f.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?l.$defs=u:l.definitions=u);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function Cd(e,t){if(e instanceof js){const n=new mo(t),a={};for(const i of e._idmap.entries()){const[l,u]=i;n.process(u)}const o={},s={registry:e,uri:t?.uri,defs:a};for(const i of e._idmap.entries()){const[l,u]=i;o[l]=n.emit(u,{...t,external:s})}if(Object.keys(a).length>0){const i=n.target==="draft-2020-12"?"$defs":"definitions";o.__shared={[i]:a}}return{schemas:o}}const r=new mo(t);return r.process(e),r.emit(e,t)}function ke(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const a=e._zod.def;switch(a.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return ke(a.element,r);case"object":{for(const o in a.shape)if(ke(a.shape[o],r))return!0;return!1}case"union":{for(const o of a.options)if(ke(o,r))return!0;return!1}case"intersection":return ke(a.left,r)||ke(a.right,r);case"tuple":{for(const o of a.items)if(ke(o,r))return!0;return!!(a.rest&&ke(a.rest,r))}case"record":return ke(a.keyType,r)||ke(a.valueType,r);case"map":return ke(a.keyType,r)||ke(a.valueType,r);case"set":return ke(a.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return ke(a.innerType,r);case"lazy":return ke(a.getter(),r);case"default":return ke(a.innerType,r);case"prefault":return ke(a.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return ke(a.in,r)||ke(a.out,r);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${a.type}`)}const Pd=w("ZodISODateTime",(e,t)=>{np.init(e,t),ue.init(e,t)});function Md(e){return ud(Pd,e)}const zd=w("ZodISODate",(e,t)=>{ap.init(e,t),ue.init(e,t)});function Dd(e){return cd(zd,e)}const Zd=w("ZodISOTime",(e,t)=>{op.init(e,t),ue.init(e,t)});function Ld(e){return pd(Zd,e)}const jd=w("ZodISODuration",(e,t)=>{sp.init(e,t),ue.init(e,t)});function Ud(e){return dd(jd,e)}const Fd=(e,t)=>{Is.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>Qu(e,r)},flatten:{value:r=>Ku(e,r)},addIssue:{value:r=>e.issues.push(r)},addIssues:{value:r=>e.issues.push(...r)},isEmpty:{get(){return e.issues.length===0}}})},xn=w("ZodError",Fd,{Parent:Error}),qd=ec(xn),Bd=tc(xn),Vd=Rs(xn),Bs=$s(xn),oe=w("ZodType",(e,t)=>(te.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),e.clone=(r,n)=>Zt(e,r,n),e.brand=()=>e,e.register=(r,n)=>(r.add(e,n),e),e.parse=(r,n)=>qd(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>Vd(e,r,n),e.parseAsync=async(r,n)=>Bd(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>Bs(e,r,n),e.spa=e.safeParseAsync,e.refine=(r,n)=>e.check(Uf(r,n)),e.superRefine=r=>e.check(Ff(r)),e.overwrite=r=>e.check(Cr(r)),e.optional=()=>be(e),e.nullable=()=>yo(e),e.nullish=()=>be(yo(e)),e.nonoptional=r=>Of(e,r),e.array=()=>ee(e),e.or=r=>re([e,r]),e.and=r=>wf(e,r),e.transform=r=>_o(e,Ef(r)),e.default=r=>Af(e,r),e.prefault=r=>$f(e,r),e.catch=r=>Cf(e,r),e.pipe=r=>_o(e,r),e.readonly=()=>zf(e),e.describe=r=>{const n=e.clone();return vr.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return vr.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return vr.get(e);const n=e.clone();return vr.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Vs=w("_ZodString",(e,t)=>{xa.init(e,t),oe.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(bd(...n)),e.includes=(...n)=>e.check(xd(...n)),e.startsWith=(...n)=>e.check(Td(...n)),e.endsWith=(...n)=>e.check(Ed(...n)),e.min=(...n)=>e.check(nn(...n)),e.max=(...n)=>e.check(Fs(...n)),e.length=(...n)=>e.check(qs(...n)),e.nonempty=(...n)=>e.check(nn(1,...n)),e.lowercase=n=>e.check(wd(n)),e.uppercase=n=>e.check(kd(n)),e.trim=()=>e.check(Id()),e.normalize=(...n)=>e.check(Sd(...n)),e.toLowerCase=()=>e.check(Ad()),e.toUpperCase=()=>e.check(Rd())}),Gd=w("ZodString",(e,t)=>{xa.init(e,t),Vs.init(e,t),e.email=r=>e.check(qp(Hd,r)),e.url=r=>e.check(Jp(Jd,r)),e.jwt=r=>e.check(ld(uf,r)),e.emoji=r=>e.check(Wp(Wd,r)),e.guid=r=>e.check(co(go,r)),e.uuid=r=>e.check(Bp(Fr,r)),e.uuidv4=r=>e.check(Vp(Fr,r)),e.uuidv6=r=>e.check(Gp(Fr,r)),e.uuidv7=r=>e.check(Hp(Fr,r)),e.nanoid=r=>e.check(Yp(Yd,r)),e.guid=r=>e.check(co(go,r)),e.cuid=r=>e.check(Xp(Xd,r)),e.cuid2=r=>e.check(Kp(Kd,r)),e.ulid=r=>e.check(Qp(Qd,r)),e.base64=r=>e.check(Us(Gs,r)),e.base64url=r=>e.check(sd(sf,r)),e.xid=r=>e.check(ed(ef,r)),e.ksuid=r=>e.check(td(tf,r)),e.ipv4=r=>e.check(rd(rf,r)),e.ipv6=r=>e.check(nd(nf,r)),e.cidrv4=r=>e.check(ad(af,r)),e.cidrv6=r=>e.check(od(of,r)),e.e164=r=>e.check(id(lf,r)),e.datetime=r=>e.check(Md(r)),e.date=r=>e.check(Dd(r)),e.time=r=>e.check(Ld(r)),e.duration=r=>e.check(Ud(r))});function _(e){return Fp(Gd,e)}const ue=w("ZodStringFormat",(e,t)=>{le.init(e,t),Vs.init(e,t)}),Hd=w("ZodEmail",(e,t)=>{Jc.init(e,t),ue.init(e,t)}),go=w("ZodGUID",(e,t)=>{Gc.init(e,t),ue.init(e,t)}),Fr=w("ZodUUID",(e,t)=>{Hc.init(e,t),ue.init(e,t)}),Jd=w("ZodURL",(e,t)=>{Wc.init(e,t),ue.init(e,t)}),Wd=w("ZodEmoji",(e,t)=>{Yc.init(e,t),ue.init(e,t)}),Yd=w("ZodNanoID",(e,t)=>{Xc.init(e,t),ue.init(e,t)}),Xd=w("ZodCUID",(e,t)=>{Kc.init(e,t),ue.init(e,t)}),Kd=w("ZodCUID2",(e,t)=>{Qc.init(e,t),ue.init(e,t)}),Qd=w("ZodULID",(e,t)=>{ep.init(e,t),ue.init(e,t)}),ef=w("ZodXID",(e,t)=>{tp.init(e,t),ue.init(e,t)}),tf=w("ZodKSUID",(e,t)=>{rp.init(e,t),ue.init(e,t)}),rf=w("ZodIPv4",(e,t)=>{ip.init(e,t),ue.init(e,t)}),nf=w("ZodIPv6",(e,t)=>{lp.init(e,t),ue.init(e,t)}),af=w("ZodCIDRv4",(e,t)=>{up.init(e,t),ue.init(e,t)}),of=w("ZodCIDRv6",(e,t)=>{cp.init(e,t),ue.init(e,t)}),Gs=w("ZodBase64",(e,t)=>{pp.init(e,t),ue.init(e,t)});function Hs(e){return Us(Gs,e)}const sf=w("ZodBase64URL",(e,t)=>{fp.init(e,t),ue.init(e,t)}),lf=w("ZodE164",(e,t)=>{hp.init(e,t),ue.init(e,t)}),uf=w("ZodJWT",(e,t)=>{gp.init(e,t),ue.init(e,t)}),Js=w("ZodNumber",(e,t)=>{Zs.init(e,t),oe.init(e,t),e.gt=(n,a)=>e.check(fo(n,a)),e.gte=(n,a)=>e.check(Pn(n,a)),e.min=(n,a)=>e.check(Pn(n,a)),e.lt=(n,a)=>e.check(po(n,a)),e.lte=(n,a)=>e.check(Cn(n,a)),e.max=(n,a)=>e.check(Cn(n,a)),e.int=n=>e.check(vo(n)),e.safe=n=>e.check(vo(n)),e.positive=n=>e.check(fo(0,n)),e.nonnegative=n=>e.check(Pn(0,n)),e.negative=n=>e.check(po(0,n)),e.nonpositive=n=>e.check(Cn(0,n)),e.multipleOf=(n,a)=>e.check(ho(n,a)),e.step=(n,a)=>e.check(ho(n,a)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function L(e){return fd(Js,e)}const cf=w("ZodNumberFormat",(e,t)=>{vp.init(e,t),Js.init(e,t)});function vo(e){return hd(cf,e)}const pf=w("ZodBoolean",(e,t)=>{yp.init(e,t),oe.init(e,t)});function Te(e){return md(pf,e)}const df=w("ZodNull",(e,t)=>{_p.init(e,t),oe.init(e,t)});function ff(e){return gd(df,e)}const hf=w("ZodAny",(e,t)=>{bp.init(e,t),oe.init(e,t)});function Ct(){return vd(hf)}const mf=w("ZodUnknown",(e,t)=>{wp.init(e,t),oe.init(e,t)});function $e(){return yd(mf)}const gf=w("ZodNever",(e,t)=>{kp.init(e,t),oe.init(e,t)});function Ws(e){return _d(gf,e)}const vf=w("ZodArray",(e,t)=>{xp.init(e,t),oe.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(nn(r,n)),e.nonempty=r=>e.check(nn(1,r)),e.max=(r,n)=>e.check(Fs(r,n)),e.length=(r,n)=>e.check(qs(r,n)),e.unwrap=()=>e.element});function ee(e,t){return $d(vf,e,t)}const Ta=w("ZodObject",(e,t)=>{Tp.init(e,t),oe.init(e,t),G(e,"shape",()=>t.shape),e.keyof=()=>an(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:$e()}),e.loose=()=>e.clone({...e._zod.def,catchall:$e()}),e.strict=()=>e.clone({...e._zod.def,catchall:Ws()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>Ju(e,r),e.merge=r=>Wu(e,r),e.pick=r=>Gu(e,r),e.omit=r=>Hu(e,r),e.partial=(...r)=>Yu(Xs,e,r[0]),e.required=(...r)=>Xu(Ks,e,r[0])});function E(e,t){const r={type:"object",get shape(){return Or(this,"shape",{...e}),this.shape},...A(t)};return new Ta(r)}function ae(e,t){return new Ta({type:"object",get shape(){return Or(this,"shape",{...e}),this.shape},catchall:Ws(),...A(t)})}function Gt(e,t){return new Ta({type:"object",get shape(){return Or(this,"shape",{...e}),this.shape},catchall:$e(),...A(t)})}const Ys=w("ZodUnion",(e,t)=>{Ls.init(e,t),oe.init(e,t),e.options=t.options});function re(e,t){return new Ys({type:"union",options:e,...A(t)})}const yf=w("ZodDiscriminatedUnion",(e,t)=>{Ys.init(e,t),Ep.init(e,t)});function _f(e,t,r){return new yf({type:"union",options:t,discriminator:e,...A(r)})}const bf=w("ZodIntersection",(e,t)=>{Sp.init(e,t),oe.init(e,t)});function wf(e,t){return new bf({type:"intersection",left:e,right:t})}const kf=w("ZodRecord",(e,t)=>{Ip.init(e,t),oe.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function Jt(e,t,r){return new kf({type:"record",keyType:e,valueType:t,...A(r)})}const ea=w("ZodEnum",(e,t)=>{Ap.init(e,t),oe.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,a)=>{const o={};for(const s of n)if(r.has(s))o[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new ea({...t,checks:[],...A(a),entries:o})},e.exclude=(n,a)=>{const o={...t.entries};for(const s of n)if(r.has(s))delete o[s];else throw new Error(`Key ${s} not found in enum`);return new ea({...t,checks:[],...A(a),entries:o})}});function an(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new ea({type:"enum",entries:r,...A(t)})}const xf=w("ZodLiteral",(e,t)=>{Rp.init(e,t),oe.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function I(e,t){return new xf({type:"literal",values:Array.isArray(e)?e:[e],...A(t)})}const Tf=w("ZodTransform",(e,t)=>{$p.init(e,t),oe.init(e,t),e._zod.parse=(r,n)=>{r.addIssue=o=>{if(typeof o=="string")r.issues.push(kr(o,r.value,t));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=e),s.continue??(s.continue=!0),r.issues.push(kr(s))}};const a=t.transform(r.value,r);return a instanceof Promise?a.then(o=>(r.value=o,r)):(r.value=a,r)}});function Ef(e){return new Tf({type:"transform",transform:e})}const Xs=w("ZodOptional",(e,t)=>{Op.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function be(e){return new Xs({type:"optional",innerType:e})}const Sf=w("ZodNullable",(e,t)=>{Np.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function yo(e){return new Sf({type:"nullable",innerType:e})}const If=w("ZodDefault",(e,t)=>{Cp.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Af(e,t){return new If({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Rf=w("ZodPrefault",(e,t)=>{Pp.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function $f(e,t){return new Rf({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Ks=w("ZodNonOptional",(e,t)=>{Mp.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Of(e,t){return new Ks({type:"nonoptional",innerType:e,...A(t)})}const Nf=w("ZodCatch",(e,t)=>{zp.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Cf(e,t){return new Nf({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Pf=w("ZodPipe",(e,t)=>{Dp.init(e,t),oe.init(e,t),e.in=t.in,e.out=t.out});function _o(e,t){return new Pf({type:"pipe",in:e,out:t})}const Mf=w("ZodReadonly",(e,t)=>{Zp.init(e,t),oe.init(e,t)});function zf(e){return new Mf({type:"readonly",innerType:e})}const Df=w("ZodLazy",(e,t)=>{Lp.init(e,t),oe.init(e,t),e.unwrap=()=>e._zod.def.getter()});function Zf(e){return new Df({type:"lazy",getter:e})}const Ea=w("ZodCustom",(e,t)=>{jp.init(e,t),oe.init(e,t)});function Lf(e){const t=new je({check:"custom"});return t._zod.check=e,t}function jf(e,t){return Od(Ea,e??(()=>!0),t)}function Uf(e,t={}){return Nd(Ea,e,t)}function Ff(e){const t=Lf(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(kr(n,r.value,t._zod.def));else{const a=n;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=r.value),a.inst??(a.inst=t),a.continue??(a.continue=!t._zod.def.abort),r.issues.push(kr(a))}},e(r.value,r)));return t}function on(e,t={error:`Input not instance of ${e.name}`}){const r=new Ea({type:"custom",check:"custom",fn:n=>n instanceof e,abort:!0,...A(t)});return r._zod.bag.Class=e,r}var D;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(D||(D={}));var qf={},Bf=Object.defineProperty,Vf=Object.defineProperties,Gf=Object.getOwnPropertyDescriptors,bo=Object.getOwnPropertySymbols,Hf=Object.prototype.hasOwnProperty,Jf=Object.prototype.propertyIsEnumerable,wo=(e,t,r)=>t in e?Bf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,he=(e,t)=>{for(var r in t||(t={}))Hf.call(t,r)&&wo(e,r,t[r]);if(bo)for(var r of bo(t))Jf.call(t,r)&&wo(e,r,t[r]);return e},Xr=(e,t)=>Vf(e,Gf(t)),Qs="vercel.ai.error",Wf=Symbol.for(Qs),ei,Yf=class ti extends Error{constructor({name:t,message:r,cause:n}){super(r),this[ei]=!0,this.name=t,this.cause=n}static isInstance(t){return ti.hasMarker(t,Qs)}static hasMarker(t,r){const n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}};ei=Wf;var Ee=Yf,ri="AI_APICallError",ni=`vercel.ai.error.${ri}`,Xf=Symbol.for(ni),ai,mt=class extends Ee{constructor({message:t,url:r,requestBodyValues:n,statusCode:a,responseHeaders:o,responseBody:s,cause:i,isRetryable:l=a!=null&&(a===408||a===409||a===429||a>=500),data:u}){super({name:ri,message:t,cause:i}),this[ai]=!0,this.url=r,this.requestBodyValues=n,this.statusCode=a,this.responseHeaders=o,this.responseBody=s,this.isRetryable=l,this.data=u}static isInstance(t){return Ee.hasMarker(t,ni)}};ai=Xf;var oi="AI_EmptyResponseBodyError",si=`vercel.ai.error.${oi}`,Kf=Symbol.for(si),ii,Qf=class extends Ee{constructor({message:t="Empty response body"}={}){super({name:oi,message:t}),this[ii]=!0}static isInstance(t){return Ee.hasMarker(t,si)}};ii=Kf;function li(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ui="AI_InvalidArgumentError",ci=`vercel.ai.error.${ui}`,eh=Symbol.for(ci),pi,th=class extends Ee{constructor({message:t,cause:r,argument:n}){super({name:ui,message:t,cause:r}),this[pi]=!0,this.argument=n}static isInstance(t){return Ee.hasMarker(t,ci)}};pi=eh;var di="AI_InvalidPromptError",fi=`vercel.ai.error.${di}`,rh=Symbol.for(fi),hi,nh=class extends Ee{constructor({prompt:t,message:r,cause:n}){super({name:di,message:`Invalid prompt: ${r}`,cause:n}),this[hi]=!0,this.prompt=t}static isInstance(t){return Ee.hasMarker(t,fi)}};hi=rh;var mi="AI_InvalidResponseDataError",gi=`vercel.ai.error.${mi}`,ah=Symbol.for(gi),vi,Mn=class extends Ee{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:mi,message:t}),this[vi]=!0,this.data=e}static isInstance(e){return Ee.hasMarker(e,gi)}};vi=ah;var yi="AI_JSONParseError",_i=`vercel.ai.error.${yi}`,oh=Symbol.for(_i),bi,sn=class extends Ee{constructor({text:t,cause:r}){super({name:yi,message:`JSON parsing failed: Text: ${t}.
Error message: ${li(r)}`,cause:r}),this[bi]=!0,this.text=t}static isInstance(t){return Ee.hasMarker(t,_i)}};bi=oh;var wi="AI_LoadAPIKeyError",ki=`vercel.ai.error.${wi}`,sh=Symbol.for(ki),xi,qr=class extends Ee{constructor({message:e}){super({name:wi,message:e}),this[xi]=!0}static isInstance(e){return Ee.hasMarker(e,ki)}};xi=sh;var Ti="AI_TypeValidationError",Ei=`vercel.ai.error.${Ti}`,ih=Symbol.for(Ei),Si,lh=class ta extends Ee{constructor({value:t,cause:r}){super({name:Ti,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${li(r)}`,cause:r}),this[Si]=!0,this.value=t}static isInstance(t){return Ee.hasMarker(t,Ei)}static wrap({value:t,cause:r}){return ta.isInstance(r)&&r.value===t?r:new ta({value:t,cause:r})}};Si=ih;var xr=lh,Ii="AI_UnsupportedFunctionalityError",Ai=`vercel.ai.error.${Ii}`,uh=Symbol.for(Ai),Ri,St=class extends Ee{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Ii,message:t}),this[Ri]=!0,this.functionality=e}static isInstance(e){return Ee.hasMarker(e,Ai)}};Ri=uh;var ko=class extends Error{constructor(t,r){super(t),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}};function zn(e){}function ch(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=zn,onError:r=zn,onRetry:n=zn,onComment:a}=e;let o="",s=!0,i,l="",u="";function p(m){const y=s?m.replace(/^\xEF\xBB\xBF/,""):m,[b,k]=ph(`${o}${y}`);for(const x of b)f(x);o=k,s=!1}function f(m){if(m===""){c();return}if(m.startsWith(":")){a&&a(m.slice(m.startsWith(": ")?2:1));return}const y=m.indexOf(":");if(y!==-1){const b=m.slice(0,y),k=m[y+1]===" "?2:1,x=m.slice(y+k);v(b,x,m);return}v(m,"",m)}function v(m,y,b){switch(m){case"event":u=y;break;case"data":l=`${l}${y}
`;break;case"id":i=y.includes("\0")?void 0:y;break;case"retry":/^\d+$/.test(y)?n(parseInt(y,10)):r(new ko(`Invalid \`retry\` value: "${y}"`,{type:"invalid-retry",value:y,line:b}));break;default:r(new ko(`Unknown field "${m.length>20?`${m.slice(0,20)}`:m}"`,{type:"unknown-field",field:m,value:y,line:b}));break}}function c(){l.length>0&&t({id:i,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",u=""}function d(m={}){o&&m.consume&&f(o),s=!0,i=void 0,l="",u="",o=""}return{feed:p,reset:d}}function ph(e){const t=[];let r="",n=0;for(;n<e.length;){const a=e.indexOf("\r",n),o=e.indexOf(`
`,n);let s=-1;if(a!==-1&&o!==-1?s=Math.min(a,o):a!==-1?s=a:o!==-1&&(s=o),s===-1){r=e.slice(n);break}else{const i=e.slice(n,s);t.push(i),n=s+1,e[n-1]==="\r"&&e[n]===`
`&&n++}}return[t,r]}var dh=class extends TransformStream{constructor({onError:t,onRetry:r,onComment:n}={}){let a;super({start(o){a=ch({onEvent:s=>{o.enqueue(s)},onError(s){t==="terminate"?o.error(s):typeof t=="function"&&t(s)},onRetry:r,onComment:n})},transform(o){a.feed(o)}})}};new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ln(...e){return e.reduce((t,r)=>he(he({},t),r??{}),{})}function Tn(e){return Object.fromEntries([...e.headers])}var fh=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{const a=()=>{const o=r.length,s=new Array(t);for(let i=0;i<t;i++)s[i]=r[Math.random()*o|0];return s.join("")};if(e==null)return a;if(r.includes(n))throw new th({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return()=>`${e}${n}${a()}`},at=fh();function ra(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var hh=["fetch failed","failed to fetch"];function mh({error:e,url:t,requestBodyValues:r}){if(ra(e))return e;if(e instanceof TypeError&&hh.includes(e.message.toLowerCase())){const n=e.cause;if(n!=null)return new mt({message:`Cannot connect to API: ${n.message}`,cause:n,url:t,requestBodyValues:r,isRetryable:!0})}return e}function gh(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}function vh({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new qr({message:`${n} API key must be a string.`});if(typeof process>"u")throw new qr({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=qf[t],e==null)throw new qr({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new qr({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var yh=/"__proto__"\s*:/,_h=/"constructor"\s*:/;function bh(e){const t=JSON.parse(e);return t===null||typeof t!="object"||yh.test(e)===!1&&_h.test(e)===!1?t:wh(t)}function wh(e){let t=[e];for(;t.length;){const r=t;t=[];for(const n of r){if(Object.prototype.hasOwnProperty.call(n,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const a in n){const o=n[a];o&&typeof o=="object"&&t.push(o)}}}return e}function Sa(e){const{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return bh(e)}finally{Error.stackTraceLimit=t}}var na=Symbol.for("vercel.ai.validator");function kh(e){return{[na]:!0,validate:e}}function xh(e){return typeof e=="object"&&e!==null&&na in e&&e[na]===!0&&"validate"in e}function Th(e){return xh(e)?e:Eh(e)}function Eh(e){return kh(async t=>{const r=await e["~standard"].validate(t);return r.issues==null?{success:!0,value:r.value}:{success:!1,error:new xr({value:t,cause:r.issues})}})}async function Sh({value:e,schema:t}){const r=await $i({value:e,schema:t});if(!r.success)throw xr.wrap({value:e,cause:r.error});return r.value}async function $i({value:e,schema:t}){const r=Th(t);try{if(r.validate==null)return{success:!0,value:e,rawValue:e};const n=await r.validate(e);return n.success?{success:!0,value:n.value,rawValue:e}:{success:!1,error:xr.wrap({value:e,cause:n.error}),rawValue:e}}catch(n){return{success:!1,error:xr.wrap({value:e,cause:n}),rawValue:e}}}async function Ih({text:e,schema:t}){try{const r=Sa(e);return t==null?r:Sh({value:r,schema:t})}catch(r){throw sn.isInstance(r)||xr.isInstance(r)?r:new sn({text:e,cause:r})}}async function Oi({text:e,schema:t}){try{const r=Sa(e);return t==null?{success:!0,value:r,rawValue:r}:await $i({value:r,schema:t})}catch(r){return{success:!1,error:sn.isInstance(r)?r:new sn({text:e,cause:r}),rawValue:void 0}}}function Dn(e){try{return Sa(e),!0}catch{return!1}}function Ah({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new dh).pipeThrough(new TransformStream({async transform({data:r},n){r!=="[DONE]"&&n.enqueue(await Oi({text:r,schema:t}))}}))}var Rh=()=>globalThis.fetch,un=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s})=>$h({url:e,headers:he({"Content-Type":"application/json"},t),body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s}),$h=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:a,abortSignal:o,fetch:s=Rh()})=>{try{const i=await s(e,{method:"POST",headers:gh(t),body:r.content,signal:o}),l=Tn(i);if(!i.ok){let u;try{u=await a({response:i,url:e,requestBodyValues:r.values})}catch(p){throw ra(p)||mt.isInstance(p)?p:new mt({message:"Failed to process error response",cause:p,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw u.value}try{return await n({response:i,url:e,requestBodyValues:r.values})}catch(u){throw u instanceof Error&&(ra(u)||mt.isInstance(u))?u:new mt({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(i){throw mh({error:i,url:e,requestBodyValues:r.values})}},Oh=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:a,requestBodyValues:o})=>{const s=await n.text(),i=Tn(n);if(s.trim()==="")return{responseHeaders:i,value:new mt({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})};try{const l=await Ih({text:s,schema:e});return{responseHeaders:i,value:new mt({message:t(l),url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,data:l,isRetryable:r?.(n,l)})}}catch{return{responseHeaders:i,value:new mt({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})}}},Ni=e=>async({response:t})=>{const r=Tn(t);if(t.body==null)throw new Qf({});return{responseHeaders:r,value:Ah({stream:t.body,schema:e})}},Ci=e=>async({response:t,url:r,requestBodyValues:n})=>{const a=await t.text(),o=await Oi({text:a,schema:e}),s=Tn(t);if(!o.success)throw new mt({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:a,url:r,requestBodyValues:n});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}},{btoa:Nh}=globalThis;function Ch(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return Nh(t)}function Ph(e){return e?.replace(/\/$/,"")}var Mh=E({type:I("reasoning.summary"),summary:_()}),zh=E({type:I("reasoning.encrypted"),data:_()}),Dh=E({type:I("reasoning.text"),text:_().nullish(),signature:_().nullish()}),Zh=re([Mh,zh,Dh]),Lh=re([Zh,$e().transform(()=>null)]),Ia=ee(Lh).transform(e=>e.filter(t=>!!t)),Aa=E({error:E({code:re([_(),L()]).nullable().optional().default(null),message:_(),type:_().nullable().optional().default(null),param:Ct().nullable().optional().default(null)})}),cn=Oh({errorSchema:Aa,errorToMessage:e=>e.error.message});function pn(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}function Pi({url:e,protocols:t}){try{const r=new URL(e);return t.has(r.protocol)}catch{return!1}}function xo({part:e,defaultMediaType:t}){var r,n;if(e.data instanceof Uint8Array){const o=Ch(e.data);return`data:${(r=e.mediaType)!=null?r:t};base64,${o}`}const a=e.data.toString();return Pi({url:a,protocols:new Set(["http:","https:"])})||a.startsWith("data:")?a:`data:${(n=e.mediaType)!=null?n:t};base64,${a}`}function Et(e){var t,r,n;const a=e?.anthropic,o=e?.openrouter;return(n=(r=(t=o?.cacheControl)!=null?t:o?.cache_control)!=null?r:a?.cacheControl)!=null?n:a?.cache_control}function jh(e){var t,r,n;const a=[];for(const{role:o,content:s,providerOptions:i}of e)switch(o){case"system":{a.push({role:"system",content:s,cache_control:Et(i)});break}case"user":{if(s.length===1&&((t=s[0])==null?void 0:t.type)==="text"){const p=(r=Et(i))!=null?r:Et(s[0].providerOptions),f=p?[{type:"text",text:s[0].text,cache_control:p}]:s[0].text;a.push({role:"user",content:f});break}const l=Et(i),u=s.map(p=>{var f,v,c,d,m,y;const b=(f=Et(p.providerOptions))!=null?f:l;switch(p.type){case"text":return{type:"text",text:p.text,cache_control:b};case"file":{if((v=p.mediaType)!=null&&v.startsWith("image/"))return{type:"image_url",image_url:{url:xo({part:p,defaultMediaType:"image/jpeg"})},cache_control:b};const k=String((y=(m=(d=(c=p.providerOptions)==null?void 0:c.openrouter)==null?void 0:d.filename)!=null?m:p.filename)!=null?y:""),x=xo({part:p,defaultMediaType:"application/pdf"});return Pi({url:x,protocols:new Set(["http:","https:"])})?{type:"file",file:{filename:k,file_data:x}}:{type:"file",file:{filename:k,file_data:x},cache_control:b}}default:return{type:"text",text:"",cache_control:b}}});a.push({role:"user",content:u});break}case"assistant":{let l="",u="";const p=[],f=[];for(const v of s)switch(v.type){case"text":{l+=v.text;break}case"tool-call":{f.push({id:v.toolCallId,type:"function",function:{name:v.toolName,arguments:JSON.stringify(v.input)}});break}case"reasoning":{u+=v.text,p.push({type:"reasoning.text",text:v.text});break}}a.push({role:"assistant",content:l,tool_calls:f.length>0?f:void 0,reasoning:u||void 0,reasoning_details:p.length>0?p:void 0,cache_control:Et(i)});break}case"tool":{for(const l of s){const u=Uh(l);a.push({role:"tool",tool_call_id:l.toolCallId,content:u,cache_control:(n=Et(i))!=null?n:Et(l.providerOptions)})}break}}return a}function Uh(e){return e.output.type==="text"?e.output.value:JSON.stringify(e.output.value)}re([I("auto"),I("none"),I("required"),E({type:I("function"),function:E({name:_()})})]);function Fh(e){switch(e.type){case"auto":case"none":case"required":return e.type;case"tool":return{type:"function",function:{name:e.toolName}};default:throw new Error(`Invalid tool choice type: ${e}`)}}var Mi=E({id:_().optional(),model:_().optional(),provider:_().optional(),usage:E({prompt_tokens:L(),prompt_tokens_details:E({cached_tokens:L()}).nullish(),completion_tokens:L(),completion_tokens_details:E({reasoning_tokens:L()}).nullish(),total_tokens:L(),cost:L().optional(),cost_details:E({upstream_inference_cost:L().nullish()}).nullish()}).nullish()}),qh=Mi.extend({choices:ee(E({message:E({role:I("assistant"),content:_().nullable().optional(),reasoning:_().nullable().optional(),reasoning_details:Ia.nullish(),tool_calls:ee(E({id:_().optional().nullable(),type:I("function"),function:E({name:_(),arguments:_()})})).optional(),annotations:ee(E({type:an(["url_citation"]),url_citation:E({end_index:L(),start_index:L(),title:_(),url:_(),content:_().optional()})})).nullish()}),index:L().nullish(),logprobs:E({content:ee(E({token:_(),logprob:L(),top_logprobs:ee(E({token:_(),logprob:L()}))})).nullable()}).nullable().optional(),finish_reason:_().optional().nullable()}))}),Bh=re([Mi.extend({choices:ee(E({delta:E({role:an(["assistant"]).optional(),content:_().nullish(),reasoning:_().nullish().optional(),reasoning_details:Ia.nullish(),tool_calls:ee(E({index:L().nullish(),id:_().nullish(),type:I("function").optional(),function:E({name:_().nullish(),arguments:_().nullish()})})).nullish(),annotations:ee(E({type:an(["url_citation"]),url_citation:E({end_index:L(),start_index:L(),title:_(),url:_(),content:_().optional()})})).nullish()}).nullish(),logprobs:E({content:ee(E({token:_(),logprob:L(),top_logprobs:ee(E({token:_(),logprob:L()}))})).nullable()}).nullish(),finish_reason:_().nullable().optional(),index:L().nullish()}))}),Aa]),Vh=class{constructor(e,t,r){this.specificationVersion="v2",this.provider="openrouter",this.defaultObjectGenerationMode="tool",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.modelId=e,this.settings=t,this.config=r}getArgs({prompt:e,maxOutputTokens:t,temperature:r,topP:n,frequencyPenalty:a,presencePenalty:o,seed:s,stopSequences:i,responseFormat:l,topK:u,tools:p,toolChoice:f}){var v;const c=he(he({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:t,temperature:r,top_p:n,frequency_penalty:a,presence_penalty:o,seed:s,stop:i,response_format:l,top_k:u,messages:jh(e),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning,usage:this.settings.usage,plugins:this.settings.plugins,web_search_options:this.settings.web_search_options,provider:this.settings.provider},this.config.extraBody),this.settings.extraBody);if(l?.type==="json"&&l.schema!=null)return Xr(he({},c),{response_format:{type:"json_schema",json_schema:he({schema:l.schema,strict:!0,name:(v=l.name)!=null?v:"response"},l.description&&{description:l.description})}});if(p&&p.length>0){const d=p.filter(m=>m.type==="function").map(m=>({type:"function",function:{name:m.name,description:m.description,parameters:m.inputSchema}}));return Xr(he({},c),{tools:d,tool_choice:f?Fh(f):void 0})}return c}async doGenerate(e){var t,r,n,a,o,s,i,l,u,p,f,v,c,d,m,y,b,k,x,g,C,M,O,F;const We=(e.providerOptions||{}).openrouter||{},Q=he(he({},this.getArgs(e)),We),{value:K,responseHeaders:me}=await un({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ln(this.config.headers(),e.headers),body:Q,failedResponseHandler:cn,successfulResponseHandler:Ci(qh),abortSignal:e.abortSignal,fetch:this.config.fetch}),ge=K.choices[0];if(!ge)throw new Error("No choice in response");const Ue=K.usage?{inputTokens:(t=K.usage.prompt_tokens)!=null?t:0,outputTokens:(r=K.usage.completion_tokens)!=null?r:0,totalTokens:((n=K.usage.prompt_tokens)!=null?n:0)+((a=K.usage.completion_tokens)!=null?a:0),reasoningTokens:(s=(o=K.usage.completion_tokens_details)==null?void 0:o.reasoning_tokens)!=null?s:0,cachedInputTokens:(l=(i=K.usage.prompt_tokens_details)==null?void 0:i.cached_tokens)!=null?l:0}:{inputTokens:0,outputTokens:0,totalTokens:0,reasoningTokens:0,cachedInputTokens:0},Ye=(u=ge.message.reasoning_details)!=null?u:[],V=Ye.length>0?Ye.map(z=>{switch(z.type){case"reasoning.text":{if(z.text)return{type:"reasoning",text:z.text};break}case"reasoning.summary":{if(z.summary)return{type:"reasoning",text:z.summary};break}case"reasoning.encrypted":{if(z.data)return{type:"reasoning",text:"[REDACTED]"};break}}return null}).filter(z=>z!==null):ge.message.reasoning?[{type:"reasoning",text:ge.message.reasoning}]:[],xe=[];if(xe.push(...V),ge.message.content&&xe.push({type:"text",text:ge.message.content}),ge.message.tool_calls)for(const z of ge.message.tool_calls)xe.push({type:"tool-call",toolCallId:(p=z.id)!=null?p:at(),toolName:z.function.name,input:z.function.arguments});if(ge.message.annotations)for(const z of ge.message.annotations)z.type==="url_citation"&&xe.push({type:"source",sourceType:"url",id:z.url_citation.url,url:z.url_citation.url,title:z.url_citation.title,providerMetadata:{openrouter:{content:z.url_citation.content||""}}});return{content:xe,finishReason:pn(ge.finish_reason),usage:Ue,warnings:[],providerMetadata:{openrouter:{provider:(f=K.provider)!=null?f:"",usage:{promptTokens:(v=Ue.inputTokens)!=null?v:0,completionTokens:(c=Ue.outputTokens)!=null?c:0,totalTokens:(d=Ue.totalTokens)!=null?d:0,cost:(m=K.usage)==null?void 0:m.cost,promptTokensDetails:{cachedTokens:(k=(b=(y=K.usage)==null?void 0:y.prompt_tokens_details)==null?void 0:b.cached_tokens)!=null?k:0},completionTokensDetails:{reasoningTokens:(C=(g=(x=K.usage)==null?void 0:x.completion_tokens_details)==null?void 0:g.reasoning_tokens)!=null?C:0},costDetails:{upstreamInferenceCost:(F=(O=(M=K.usage)==null?void 0:M.cost_details)==null?void 0:O.upstream_inference_cost)!=null?F:0}}}},request:{body:Q},response:{id:K.id,modelId:K.model,headers:me}}}async doStream(e){var t;const n=(e.providerOptions||{}).openrouter||{},a=he(he({},this.getArgs(e)),n),{value:o,responseHeaders:s}=await un({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ln(this.config.headers(),e.headers),body:Xr(he({},a),{stream:!0,stream_options:this.config.compatibility==="strict"?he({include_usage:!0},(t=this.settings.usage)!=null&&t.include?{include_usage:!0}:{}):void 0}),failedResponseHandler:cn,successfulResponseHandler:Ni(Bh),abortSignal:e.abortSignal,fetch:this.config.fetch}),i=[];let l="other";const u={inputTokens:Number.NaN,outputTokens:Number.NaN,totalTokens:Number.NaN,reasoningTokens:Number.NaN,cachedInputTokens:Number.NaN},p={};let f=!1,v=!1,c,d,m,y;return{stream:o.pipeThrough(new TransformStream({transform(b,k){var x,g,C,M,O,F,ve,We,Q,K,me,ge,Ue,Ye;if(!b.success){l="error",k.enqueue({type:"error",error:b.error});return}const V=b.value;if("error"in V){l="error",k.enqueue({type:"error",error:V.error});return}if(V.provider&&(y=V.provider),V.id&&(m=V.id,k.enqueue({type:"response-metadata",id:V.id})),V.model&&k.enqueue({type:"response-metadata",modelId:V.model}),V.usage!=null){if(u.inputTokens=V.usage.prompt_tokens,u.outputTokens=V.usage.completion_tokens,u.totalTokens=V.usage.prompt_tokens+V.usage.completion_tokens,p.promptTokens=V.usage.prompt_tokens,V.usage.prompt_tokens_details){const $=(x=V.usage.prompt_tokens_details.cached_tokens)!=null?x:0;u.cachedInputTokens=$,p.promptTokensDetails={cachedTokens:$}}if(p.completionTokens=V.usage.completion_tokens,V.usage.completion_tokens_details){const $=(g=V.usage.completion_tokens_details.reasoning_tokens)!=null?g:0;u.reasoningTokens=$,p.completionTokensDetails={reasoningTokens:$}}p.cost=V.usage.cost,p.totalTokens=V.usage.total_tokens}const xe=V.choices[0];if(xe?.finish_reason!=null&&(l=pn(xe.finish_reason)),xe?.delta==null)return;const z=xe.delta,Xe=$=>{v||(d=m||at(),k.enqueue({type:"reasoning-start",id:d}),v=!0),k.enqueue({type:"reasoning-delta",delta:$,id:d||at()})};if(z.reasoning_details&&z.reasoning_details.length>0)for(const $ of z.reasoning_details)switch($.type){case"reasoning.text":{$.text&&Xe($.text);break}case"reasoning.encrypted":{$.data&&Xe("[REDACTED]");break}case"reasoning.summary":{$.summary&&Xe($.summary);break}}else z.reasoning&&Xe(z.reasoning);if(z.content&&(v&&!f&&(k.enqueue({type:"reasoning-end",id:d||at()}),v=!1),f||(c=m||at(),k.enqueue({type:"text-start",id:c}),f=!0),k.enqueue({type:"text-delta",delta:z.content,id:c||at()})),z.annotations)for(const $ of z.annotations)$.type==="url_citation"&&k.enqueue({type:"source",sourceType:"url",id:$.url_citation.url,url:$.url_citation.url,title:$.url_citation.title,providerMetadata:{openrouter:{content:$.url_citation.content||""}}});if(z.tool_calls!=null)for(const $ of z.tool_calls){const De=(C=$.index)!=null?C:i.length-1;if(i[De]==null){if($.type!=="function")throw new Mn({data:$,message:"Expected 'function' type."});if($.id==null)throw new Mn({data:$,message:"Expected 'id' to be a string."});if(((M=$.function)==null?void 0:M.name)==null)throw new Mn({data:$,message:"Expected 'function.name' to be a string."});i[De]={id:$.id,type:"function",function:{name:$.function.name,arguments:(O=$.function.arguments)!=null?O:""},inputStarted:!1,sent:!1};const ce=i[De];if(ce==null)throw new Error("Tool call is missing");((F=ce.function)==null?void 0:F.name)!=null&&((ve=ce.function)==null?void 0:ve.arguments)!=null&&Dn(ce.function.arguments)&&(ce.inputStarted=!0,k.enqueue({type:"tool-input-start",id:ce.id,toolName:ce.function.name}),k.enqueue({type:"tool-input-delta",id:ce.id,delta:ce.function.arguments}),k.enqueue({type:"tool-input-end",id:ce.id}),k.enqueue({type:"tool-call",toolCallId:ce.id,toolName:ce.function.name,input:ce.function.arguments}),ce.sent=!0);continue}const U=i[De];if(U==null)throw new Error("Tool call is missing");U.inputStarted||(U.inputStarted=!0,k.enqueue({type:"tool-input-start",id:U.id,toolName:U.function.name})),((We=$.function)==null?void 0:We.arguments)!=null&&(U.function.arguments+=(K=(Q=$.function)==null?void 0:Q.arguments)!=null?K:""),k.enqueue({type:"tool-input-delta",id:U.id,delta:(me=$.function.arguments)!=null?me:""}),((ge=U.function)==null?void 0:ge.name)!=null&&((Ue=U.function)==null?void 0:Ue.arguments)!=null&&Dn(U.function.arguments)&&(k.enqueue({type:"tool-call",toolCallId:(Ye=U.id)!=null?Ye:at(),toolName:U.function.name,input:U.function.arguments}),U.sent=!0)}},flush(b){var k;if(l==="tool-calls")for(const g of i)g&&!g.sent&&(b.enqueue({type:"tool-call",toolCallId:(k=g.id)!=null?k:at(),toolName:g.function.name,input:Dn(g.function.arguments)?g.function.arguments:"{}"}),g.sent=!0);v&&b.enqueue({type:"reasoning-end",id:d||at()}),f&&b.enqueue({type:"text-end",id:c||at()});const x={usage:p};y!==void 0&&(x.provider=y),b.enqueue({type:"finish",finishReason:l,usage:u,providerMetadata:{openrouter:x}})}})),warnings:[],request:{body:a},response:{headers:s}}}};function Gh({prompt:e,inputFormat:t,user:r="user",assistant:n="assistant"}){if(e.length===1&&e[0]&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0]&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let a="";e[0]&&e[0].role==="system"&&(a+=`${e[0].content}

`,e=e.slice(1));for(const{role:o,content:s}of e)switch(o){case"system":throw new nh({message:`Unexpected system message in prompt: ${s}`,prompt:e});case"user":{const i=s.map(l=>{switch(l.type){case"text":return l.text;case"file":throw new St({functionality:"file attachments"});default:return""}}).join("");a+=`${r}:
${i}

`;break}case"assistant":{const i=s.map(l=>{switch(l.type){case"text":return l.text;case"tool-call":throw new St({functionality:"tool-call messages"});case"tool-result":throw new St({functionality:"tool-result messages"});case"reasoning":throw new St({functionality:"reasoning messages"});case"file":throw new St({functionality:"file attachments"});default:return""}}).join("");a+=`${n}:
${i}

`;break}case"tool":throw new St({functionality:"tool messages"})}return a+=`${n}:
`,{prompt:a}}var To=re([E({id:_().optional(),model:_().optional(),choices:ee(E({text:_(),reasoning:_().nullish().optional(),reasoning_details:Ia.nullish(),finish_reason:_().nullish(),index:L().nullish(),logprobs:E({tokens:ee(_()),token_logprobs:ee(L()),top_logprobs:ee(Jt(_(),L())).nullable()}).nullable().optional()})),usage:E({prompt_tokens:L(),prompt_tokens_details:E({cached_tokens:L()}).nullish(),completion_tokens:L(),completion_tokens_details:E({reasoning_tokens:L()}).nullish(),total_tokens:L(),cost:L().optional()}).nullish()}),Aa]),Hh=class{constructor(e,t,r){this.specificationVersion="v2",this.provider="openrouter",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"text/*":[/^data:text\//,/^https?:\/\/.+$/],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}getArgs({prompt:e,maxOutputTokens:t,temperature:r,topP:n,frequencyPenalty:a,presencePenalty:o,seed:s,responseFormat:i,topK:l,stopSequences:u,tools:p,toolChoice:f}){const{prompt:v}=Gh({prompt:e,inputFormat:"prompt"});if(p?.length)throw new St({functionality:"tools"});if(f)throw new St({functionality:"toolChoice"});return he(he({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:t,temperature:r,top_p:n,frequency_penalty:a,presence_penalty:o,seed:s,stop:u,response_format:i,top_k:l,prompt:v,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody)}async doGenerate(e){var t,r,n,a,o,s,i,l,u,p,f,v,c,d,m;const b=(e.providerOptions||{}).openrouter||{},k=he(he({},this.getArgs(e)),b),{value:x,responseHeaders:g}=await un({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ln(this.config.headers(),e.headers),body:k,failedResponseHandler:cn,successfulResponseHandler:Ci(To),abortSignal:e.abortSignal,fetch:this.config.fetch});if("error"in x)throw new Error(`${x.error.message}`);const C=x.choices[0];if(!C)throw new Error("No choice in OpenRouter completion response");return{content:[{type:"text",text:(t=C.text)!=null?t:""}],finishReason:pn(C.finish_reason),usage:{inputTokens:(n=(r=x.usage)==null?void 0:r.prompt_tokens)!=null?n:0,outputTokens:(o=(a=x.usage)==null?void 0:a.completion_tokens)!=null?o:0,totalTokens:((i=(s=x.usage)==null?void 0:s.prompt_tokens)!=null?i:0)+((u=(l=x.usage)==null?void 0:l.completion_tokens)!=null?u:0),reasoningTokens:(v=(f=(p=x.usage)==null?void 0:p.completion_tokens_details)==null?void 0:f.reasoning_tokens)!=null?v:0,cachedInputTokens:(m=(d=(c=x.usage)==null?void 0:c.prompt_tokens_details)==null?void 0:d.cached_tokens)!=null?m:0},warnings:[],response:{headers:g}}}async doStream(e){const r=(e.providerOptions||{}).openrouter||{},n=he(he({},this.getArgs(e)),r),{value:a,responseHeaders:o}=await un({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:ln(this.config.headers(),e.headers),body:Xr(he({},n),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:cn,successfulResponseHandler:Ni(To),abortSignal:e.abortSignal,fetch:this.config.fetch});let s="other";const i={inputTokens:Number.NaN,outputTokens:Number.NaN,totalTokens:Number.NaN,reasoningTokens:Number.NaN,cachedInputTokens:Number.NaN},l={};return{stream:a.pipeThrough(new TransformStream({transform(u,p){var f,v;if(!u.success){s="error",p.enqueue({type:"error",error:u.error});return}const c=u.value;if("error"in c){s="error",p.enqueue({type:"error",error:c.error});return}if(c.usage!=null){if(i.inputTokens=c.usage.prompt_tokens,i.outputTokens=c.usage.completion_tokens,i.totalTokens=c.usage.prompt_tokens+c.usage.completion_tokens,l.promptTokens=c.usage.prompt_tokens,c.usage.prompt_tokens_details){const m=(f=c.usage.prompt_tokens_details.cached_tokens)!=null?f:0;i.cachedInputTokens=m,l.promptTokensDetails={cachedTokens:m}}if(l.completionTokens=c.usage.completion_tokens,c.usage.completion_tokens_details){const m=(v=c.usage.completion_tokens_details.reasoning_tokens)!=null?v:0;i.reasoningTokens=m,l.completionTokensDetails={reasoningTokens:m}}l.cost=c.usage.cost,l.totalTokens=c.usage.total_tokens}const d=c.choices[0];d?.finish_reason!=null&&(s=pn(d.finish_reason)),d?.text!=null&&p.enqueue({type:"text-delta",delta:d.text,id:at()})},flush(u){u.enqueue({type:"finish",finishReason:s,usage:i,providerMetadata:{openrouter:{usage:l}}})}})),response:{headers:o}}}};function zi(e={}){var t,r,n;const a=(r=Ph((t=e.baseURL)!=null?t:e.baseUrl))!=null?r:"https://openrouter.ai/api/v1",o=(n=e.compatibility)!=null?n:"compatible",s=()=>he({Authorization:`Bearer ${vh({apiKey:e.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},e.headers),i=(f,v={})=>new Vh(f,v,{provider:"openrouter.chat",url:({path:c})=>`${a}${c}`,headers:s,compatibility:o,fetch:e.fetch,extraBody:e.extraBody}),l=(f,v={})=>new Hh(f,v,{provider:"openrouter.completion",url:({path:c})=>`${a}${c}`,headers:s,compatibility:o,fetch:e.fetch,extraBody:e.extraBody}),u=(f,v)=>{if(new.target)throw new Error("The OpenRouter model function cannot be called with the new keyword.");return f==="openai/gpt-3.5-turbo-instruct"?l(f,v):i(f,v)},p=(f,v)=>u(f,v);return p.languageModel=u,p.chat=i,p.completion=l,p}zi({compatibility:"strict"});var Di="vercel.ai.error",Jh=Symbol.for(Di),Zi,Wh=class Li extends Error{constructor({name:t,message:r,cause:n}){super(r),this[Zi]=!0,this.name=t,this.cause=n}static isInstance(t){return Li.hasMarker(t,Di)}static hasMarker(t,r){const n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}};Zi=Jh;var j=Wh,ji="AI_APICallError",Ui=`vercel.ai.error.${ji}`,Yh=Symbol.for(Ui),Fi,Ce=class extends j{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:a,responseBody:o,cause:s,isRetryable:i=n!=null&&(n===408||n===409||n===429||n>=500),data:l}){super({name:ji,message:e,cause:s}),this[Fi]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=a,this.responseBody=o,this.isRetryable=i,this.data=l}static isInstance(e){return j.hasMarker(e,Ui)}};Fi=Yh;var qi="AI_EmptyResponseBodyError",Bi=`vercel.ai.error.${qi}`,Xh=Symbol.for(Bi),Vi,Kh=class extends j{constructor({message:e="Empty response body"}={}){super({name:qi,message:e}),this[Vi]=!0}static isInstance(e){return j.hasMarker(e,Bi)}};Vi=Xh;function Yt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Gi="AI_InvalidArgumentError",Hi=`vercel.ai.error.${Gi}`,Qh=Symbol.for(Hi),Ji,em=class extends j{constructor({message:t,cause:r,argument:n}){super({name:Gi,message:t,cause:r}),this[Ji]=!0,this.argument=n}static isInstance(t){return j.hasMarker(t,Hi)}};Ji=Qh;var Wi="AI_InvalidPromptError",Yi=`vercel.ai.error.${Wi}`,tm=Symbol.for(Yi),Xi,Vt=class extends j{constructor({prompt:e,message:t,cause:r}){super({name:Wi,message:`Invalid prompt: ${t}`,cause:r}),this[Xi]=!0,this.prompt=e}static isInstance(e){return j.hasMarker(e,Yi)}};Xi=tm;var Ki="AI_JSONParseError",Qi=`vercel.ai.error.${Ki}`,rm=Symbol.for(Qi),el,dn=class extends j{constructor({text:e,cause:t}){super({name:Ki,message:`JSON parsing failed: Text: ${e}.
Error message: ${Yt(t)}`,cause:t}),this[el]=!0,this.text=e}static isInstance(e){return j.hasMarker(e,Qi)}};el=rm;var tl="AI_NoSuchModelError",rl=`vercel.ai.error.${tl}`,nm=Symbol.for(rl),nl,am=class extends j{constructor({errorName:e=tl,modelId:t,modelType:r,message:n=`No such ${r}: ${t}`}){super({name:e,message:n}),this[nl]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return j.hasMarker(e,rl)}};nl=nm;var al="AI_TypeValidationError",ol=`vercel.ai.error.${al}`,om=Symbol.for(ol),sl,sm=class aa extends j{constructor({value:t,cause:r}){super({name:al,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Yt(r)}`,cause:r}),this[sl]=!0,this.value=t}static isInstance(t){return j.hasMarker(t,ol)}static wrap({value:t,cause:r}){return aa.isInstance(r)&&r.value===t?r:new aa({value:t,cause:r})}};sl=om;var Tr=sm;class Eo extends Error{constructor(t,r){super(t),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function Zn(e){}function im(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=Zn,onError:r=Zn,onRetry:n=Zn,onComment:a}=e;let o="",s=!0,i,l="",u="";function p(m){const y=s?m.replace(/^\xEF\xBB\xBF/,""):m,[b,k]=lm(`${o}${y}`);for(const x of b)f(x);o=k,s=!1}function f(m){if(m===""){c();return}if(m.startsWith(":")){a&&a(m.slice(m.startsWith(": ")?2:1));return}const y=m.indexOf(":");if(y!==-1){const b=m.slice(0,y),k=m[y+1]===" "?2:1,x=m.slice(y+k);v(b,x,m);return}v(m,"",m)}function v(m,y,b){switch(m){case"event":u=y;break;case"data":l=`${l}${y}
`;break;case"id":i=y.includes("\0")?void 0:y;break;case"retry":/^\d+$/.test(y)?n(parseInt(y,10)):r(new Eo(`Invalid \`retry\` value: "${y}"`,{type:"invalid-retry",value:y,line:b}));break;default:r(new Eo(`Unknown field "${m.length>20?`${m.slice(0,20)}`:m}"`,{type:"unknown-field",field:m,value:y,line:b}));break}}function c(){l.length>0&&t({id:i,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",u=""}function d(m={}){o&&m.consume&&f(o),s=!0,i=void 0,l="",u="",o=""}return{feed:p,reset:d}}function lm(e){const t=[];let r="",n=0;for(;n<e.length;){const a=e.indexOf("\r",n),o=e.indexOf(`
`,n);let s=-1;if(a!==-1&&o!==-1?s=Math.min(a,o):a!==-1?s=a:o!==-1&&(s=o),s===-1){r=e.slice(n);break}else{const i=e.slice(n,s);t.push(i),n=s+1,e[n-1]==="\r"&&e[n]===`
`&&n++}}return[t,r]}class um extends TransformStream{constructor({onError:t,onRetry:r,onComment:n}={}){let a;super({start(o){a=im({onEvent:s=>{o.enqueue(s)},onError(s){t==="terminate"?o.error(s):typeof t=="function"&&t(s)},onRetry:r,onComment:n})},transform(o){a.feed(o)}})}}const cm=Symbol("Let zodToJsonSchema decide on which parser to use"),So={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},pm=e=>typeof e=="string"?{...So,name:e}:{...So,...e},dm=e=>{const t=pm(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))}};function il(e,t,r,n){n?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function Y(e,t,r,n,a){e[t]=r,il(e,t,n,a)}const ll=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function Le(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?ll(t,e.currentPath):t.join("/")}}function fm(e,t){const r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==D.ZodAny&&(r.items=B(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Y(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Y(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Y(r,"minItems",e.exactLength.value,e.exactLength.message,t),Y(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function hm(e,t){const r={type:"integer",format:"int64"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"min":t.target==="jsonSchema7"?n.inclusive?Y(r,"minimum",n.value,n.message,t):Y(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),Y(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?Y(r,"maximum",n.value,n.message,t):Y(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),Y(r,"maximum",n.value,n.message,t));break;case"multipleOf":Y(r,"multipleOf",n.value,n.message,t);break}return r}function mm(){return{type:"boolean"}}function ul(e,t){return B(e.type._def,t)}const gm=(e,t)=>B(e.innerType._def,t);function cl(e,t,r){const n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>cl(e,t,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return vm(e,t)}}const vm=(e,t)=>{const r={type:"integer",format:"unix-time"};if(t.target==="openApi3")return r;for(const n of e.checks)switch(n.kind){case"min":Y(r,"minimum",n.value,n.message,t);break;case"max":Y(r,"maximum",n.value,n.message,t);break}return r};function ym(e,t){return{...B(e.innerType._def,t),default:e.defaultValue()}}function _m(e,t){return t.effectStrategy==="input"?B(e.schema._def,t):Le(t)}function bm(e){return{type:"string",enum:Array.from(e.values)}}const wm=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function km(e,t){const r=[B(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),B(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(o=>!!o);let n=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return r.forEach(o=>{if(wm(o))a.push(...o.allOf),o.unevaluatedProperties===void 0&&(n=void 0);else{let s=o;if("additionalProperties"in o&&o.additionalProperties===!1){const{additionalProperties:i,...l}=o;s=l}else n=void 0;a.push(s)}}),a.length?{allOf:a,...n}:void 0}function xm(e,t){const r=typeof e.value;return r!=="bigint"&&r!=="number"&&r!=="boolean"&&r!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:r==="bigint"?"integer":r,enum:[e.value]}:{type:r==="bigint"?"integer":r,const:e.value}}let Ln;const rt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ln===void 0&&(Ln=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ln),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function pl(e,t){const r={type:"string"};if(e.checks)for(const n of e.checks)switch(n.kind){case"min":Y(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t);break;case"max":Y(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":nt(r,"email",n.message,t);break;case"format:idn-email":nt(r,"idn-email",n.message,t);break;case"pattern:zod":Oe(r,rt.email,n.message,t);break}break;case"url":nt(r,"uri",n.message,t);break;case"uuid":nt(r,"uuid",n.message,t);break;case"regex":Oe(r,n.regex,n.message,t);break;case"cuid":Oe(r,rt.cuid,n.message,t);break;case"cuid2":Oe(r,rt.cuid2,n.message,t);break;case"startsWith":Oe(r,RegExp(`^${jn(n.value,t)}`),n.message,t);break;case"endsWith":Oe(r,RegExp(`${jn(n.value,t)}$`),n.message,t);break;case"datetime":nt(r,"date-time",n.message,t);break;case"date":nt(r,"date",n.message,t);break;case"time":nt(r,"time",n.message,t);break;case"duration":nt(r,"duration",n.message,t);break;case"length":Y(r,"minLength",typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,n.message,t),Y(r,"maxLength",typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"includes":{Oe(r,RegExp(jn(n.value,t)),n.message,t);break}case"ip":{n.version!=="v6"&&nt(r,"ipv4",n.message,t),n.version!=="v4"&&nt(r,"ipv6",n.message,t);break}case"base64url":Oe(r,rt.base64url,n.message,t);break;case"jwt":Oe(r,rt.jwt,n.message,t);break;case"cidr":{n.version!=="v6"&&Oe(r,rt.ipv4Cidr,n.message,t),n.version!=="v4"&&Oe(r,rt.ipv6Cidr,n.message,t);break}case"emoji":Oe(r,rt.emoji(),n.message,t);break;case"ulid":{Oe(r,rt.ulid,n.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{nt(r,"binary",n.message,t);break}case"contentEncoding:base64":{Y(r,"contentEncoding","base64",n.message,t);break}case"pattern:zod":{Oe(r,rt.base64,n.message,t);break}}break}case"nanoid":Oe(r,rt.nanoid,n.message,t)}return r}function jn(e,t){return t.patternStrategy==="escape"?Em(e):e}const Tm=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Em(e){let t="";for(let r=0;r<e.length;r++)Tm.has(e[r])||(t+="\\"),t+=e[r];return t}function nt(e,t,r,n){e.format||e.anyOf?.some(a=>a.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&n.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):Y(e,"format",t,r,n)}function Oe(e,t,r,n){e.pattern||e.allOf?.some(a=>a.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&n.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:Io(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):Y(e,"pattern",Io(t,n),r,n)}function Io(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;const r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},n=r.i?e.source.toLowerCase():e.source;let a="",o=!1,s=!1,i=!1;for(let l=0;l<n.length;l++){if(o){a+=n[l],o=!1;continue}if(r.i){if(s){if(n[l].match(/[a-z]/)){i?(a+=n[l],a+=`${n[l-2]}-${n[l]}`.toUpperCase(),i=!1):n[l+1]==="-"&&n[l+2]?.match(/[a-z]/)?(a+=n[l],i=!0):a+=`${n[l]}${n[l].toUpperCase()}`;continue}}else if(n[l].match(/[a-z]/)){a+=`[${n[l]}${n[l].toUpperCase()}]`;continue}}if(r.m){if(n[l]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(n[l]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&n[l]==="."){a+=s?`${n[l]}\r
`:`[${n[l]}\r
]`;continue}a+=n[l],n[l]==="\\"?o=!0:s&&n[l]==="]"?s=!1:!s&&n[l]==="["&&(s=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function dl(e,t){if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&e.keyType?._def.typeName===D.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((n,a)=>({...n,[a]:B(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??Le(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const r={type:"object",additionalProperties:B(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return r;if(e.keyType?._def.typeName===D.ZodString&&e.keyType._def.checks?.length){const{type:n,...a}=pl(e.keyType._def,t);return{...r,propertyNames:a}}else{if(e.keyType?._def.typeName===D.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===D.ZodBranded&&e.keyType._def.type._def.typeName===D.ZodString&&e.keyType._def.type._def.checks?.length){const{type:n,...a}=ul(e.keyType._def,t);return{...r,propertyNames:a}}}return r}function Sm(e,t){if(t.mapStrategy==="record")return dl(e,t);const r=B(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Le(t),n=B(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Le(t);return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Im(e){const t=e.values,n=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function Am(e){return e.target==="openAi"?void 0:{not:Le({...e,currentPath:[...e.currentPath,"not"]})}}function Rm(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const fn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function $m(e,t){if(t.target==="openApi3")return Ao(e,t);const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in fn&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const s=fn[o._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,s,i)=>i.indexOf(o)===s);return{type:a.length>1?a:a[0],enum:r.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return Ao(e,t)}const Ao=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,a)=>B(n._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function Om(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:fn[e.innerType._def.typeName],nullable:!0}:{type:[fn[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const n=B(e.innerType._def,{...t,currentPath:[...t.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}const r=B(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function Nm(e,t){const r={type:"number"};if(!e.checks)return r;for(const n of e.checks)switch(n.kind){case"int":r.type="integer",il(r,"type",n.message,t);break;case"min":t.target==="jsonSchema7"?n.inclusive?Y(r,"minimum",n.value,n.message,t):Y(r,"exclusiveMinimum",n.value,n.message,t):(n.inclusive||(r.exclusiveMinimum=!0),Y(r,"minimum",n.value,n.message,t));break;case"max":t.target==="jsonSchema7"?n.inclusive?Y(r,"maximum",n.value,n.message,t):Y(r,"exclusiveMaximum",n.value,n.message,t):(n.inclusive||(r.exclusiveMaximum=!0),Y(r,"maximum",n.value,n.message,t));break;case"multipleOf":Y(r,"multipleOf",n.value,n.message,t);break}return r}function Cm(e,t){const r=t.target==="openAi",n={type:"object",properties:{}},a=[],o=e.shape();for(const i in o){let l=o[i];if(l===void 0||l._def===void 0)continue;let u=Mm(l);u&&r&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const p=B(l._def,{...t,currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]});p!==void 0&&(n.properties[i]=p,u||a.push(i))}a.length&&(n.required=a);const s=Pm(e,t);return s!==void 0&&(n.additionalProperties=s),n}function Pm(e,t){if(e.catchall._def.typeName!=="ZodNever")return B(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function Mm(e){try{return e.isOptional()}catch{return!0}}const zm=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return B(e.innerType._def,t);const r=B(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:Le(t)},r]}:Le(t)},Dm=(e,t)=>{if(t.pipeStrategy==="input")return B(e.in._def,t);if(t.pipeStrategy==="output")return B(e.out._def,t);const r=B(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=B(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function Zm(e,t){return B(e.type._def,t)}function Lm(e,t){const n={type:"array",uniqueItems:!0,items:B(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Y(n,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Y(n,"maxItems",e.maxSize.value,e.maxSize.message,t),n}function jm(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>B(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:B(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>B(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function Um(e){return{not:Le(e)}}function Fm(e){return Le(e)}const qm=(e,t)=>B(e.innerType._def,t),Bm=(e,t,r)=>{switch(t){case D.ZodString:return pl(e,r);case D.ZodNumber:return Nm(e,r);case D.ZodObject:return Cm(e,r);case D.ZodBigInt:return hm(e,r);case D.ZodBoolean:return mm();case D.ZodDate:return cl(e,r);case D.ZodUndefined:return Um(r);case D.ZodNull:return Rm(r);case D.ZodArray:return fm(e,r);case D.ZodUnion:case D.ZodDiscriminatedUnion:return $m(e,r);case D.ZodIntersection:return km(e,r);case D.ZodTuple:return jm(e,r);case D.ZodRecord:return dl(e,r);case D.ZodLiteral:return xm(e,r);case D.ZodEnum:return bm(e);case D.ZodNativeEnum:return Im(e);case D.ZodNullable:return Om(e,r);case D.ZodOptional:return zm(e,r);case D.ZodMap:return Sm(e,r);case D.ZodSet:return Lm(e,r);case D.ZodLazy:return()=>e.getter()._def;case D.ZodPromise:return Zm(e,r);case D.ZodNaN:case D.ZodNever:return Am(r);case D.ZodEffects:return _m(e,r);case D.ZodAny:return Le(r);case D.ZodUnknown:return Fm(r);case D.ZodDefault:return ym(e,r);case D.ZodBranded:return ul(e,r);case D.ZodReadonly:return qm(e,r);case D.ZodCatch:return gm(e,r);case D.ZodPipeline:return Dm(e,r);case D.ZodFunction:case D.ZodVoid:case D.ZodSymbol:return;default:return(n=>{})()}};function B(e,t,r=!1){const n=t.seen.get(e);if(t.override){const i=t.override?.(e,t,n,r);if(i!==cm)return i}if(n&&!r){const i=Vm(n,t);if(i!==void 0)return i}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const o=Bm(e,e.typeName,t),s=typeof o=="function"?B(o(),t):o;if(s&&Gm(e,t,s),t.postProcess){const i=t.postProcess(s,e,t);return a.jsonSchema=s,i}return a.jsonSchema=s,s}const Vm=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:ll(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Le(t)):t.$refStrategy==="seen"?Le(t):void 0}},Gm=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),Hm=(e,t)=>{const r=dm(t);let n=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((l,[u,p])=>({...l,[u]:B(p._def,{...r,currentPath:[...r.basePath,r.definitionPath,u]},!0)??Le(r)}),{}):void 0;const a=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,o=B(e._def,a===void 0?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1)??Le(r),s=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;s!==void 0&&(o.title=s),r.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[r.openAiAnyTypeName]||(n[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:r.$refStrategy==="relative"?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));const i=a===void 0?n?{...o,[r.definitionPath]:n}:o:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...n,[a]:o}};return r.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(r.target==="jsonSchema2019-09"||r.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),r.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var Jm={};function oa(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}async function Wm(e,t){if(e==null)return Promise.resolve();const r=t?.abortSignal;return new Promise((n,a)=>{if(r?.aborted){a(Ro());return}const o=setTimeout(()=>{s(),n()},e),s=()=>{clearTimeout(o),r?.removeEventListener("abort",i)},i=()=>{s(),a(Ro())};r?.addEventListener("abort",i)})}function Ro(){return new DOMException("Delay was aborted","AbortError")}function Pr(e){return Object.fromEntries([...e.headers])}var Mr=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{const a=()=>{const o=r.length,s=new Array(t);for(let i=0;i<t;i++)s[i]=r[Math.random()*o|0];return s.join("")};if(e==null)return a;if(r.includes(n))throw new em({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return()=>`${e}${n}${a()}`},Ym=Mr();function fl(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function zt(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var Xm=["fetch failed","failed to fetch"];function hl({error:e,url:t,requestBodyValues:r}){if(zt(e))return e;if(e instanceof TypeError&&Xm.includes(e.message.toLowerCase())){const n=e.cause;if(n!=null)return new Ce({message:`Cannot connect to API: ${n.message}`,cause:n,url:t,requestBodyValues:r,isRetryable:!0})}return e}function ml(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}var Km=()=>globalThis.fetch,Qm=async({url:e,headers:t={},successfulResponseHandler:r,failedResponseHandler:n,abortSignal:a,fetch:o=Km()})=>{try{const s=await o(e,{method:"GET",headers:ml(t),signal:a}),i=Pr(s);if(!s.ok){let l;try{l=await n({response:s,url:e,requestBodyValues:{}})}catch(u){throw zt(u)||Ce.isInstance(u)?u:new Ce({message:"Failed to process error response",cause:u,statusCode:s.status,url:e,responseHeaders:i,requestBodyValues:{}})}throw l.value}try{return await r({response:s,url:e,requestBodyValues:{}})}catch(l){throw l instanceof Error&&(zt(l)||Ce.isInstance(l))?l:new Ce({message:"Failed to process successful response",cause:l,statusCode:s.status,url:e,responseHeaders:i,requestBodyValues:{}})}}catch(s){throw hl({error:s,url:e,requestBodyValues:{}})}};function eg({mediaType:e,url:t,supportedUrls:r}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(r).map(([n,a])=>{const o=n.toLowerCase();return o==="*"||o==="*/*"?{mediaTypePrefix:"",regexes:a}:{mediaTypePrefix:o.replace(/\*/,""),regexes:a}}).filter(({mediaTypePrefix:n})=>e.startsWith(n)).flatMap(({regexes:n})=>n).some(n=>n.test(t))}function Kr({settingValue:e,environmentVariableName:t}){if(typeof e=="string")return e;if(!(e!=null||typeof process>"u")&&(e=Jm[t],!(e==null||typeof e!="string")))return e}var tg=/"__proto__"\s*:/,rg=/"constructor"\s*:/;function ng(e){const t=JSON.parse(e);return t===null||typeof t!="object"||tg.test(e)===!1&&rg.test(e)===!1?t:ag(t)}function ag(e){let t=[e];for(;t.length;){const r=t;t=[];for(const n of r){if(Object.prototype.hasOwnProperty.call(n,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const a in n){const o=n[a];o&&typeof o=="object"&&t.push(o)}}}return e}function gl(e){const{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return ng(e)}finally{Error.stackTraceLimit=t}}var hn=Symbol.for("vercel.ai.validator");function og(e){return{[hn]:!0,validate:e}}function sg(e){return typeof e=="object"&&e!==null&&hn in e&&e[hn]===!0&&"validate"in e}function ig(e){return sg(e)?e:lg(e)}function lg(e){return og(async t=>{const r=await e["~standard"].validate(t);return r.issues==null?{success:!0,value:r.value}:{success:!1,error:new Tr({value:t,cause:r.issues})}})}async function sa({value:e,schema:t}){const r=await zr({value:e,schema:t});if(!r.success)throw Tr.wrap({value:e,cause:r.error});return r.value}async function zr({value:e,schema:t}){const r=ig(t);try{if(r.validate==null)return{success:!0,value:e,rawValue:e};const n=await r.validate(e);return n.success?{success:!0,value:n.value,rawValue:e}:{success:!1,error:Tr.wrap({value:e,cause:n.error}),rawValue:e}}catch(n){return{success:!1,error:Tr.wrap({value:e,cause:n}),rawValue:e}}}async function ug({text:e,schema:t}){try{const r=gl(e);return t==null?r:sa({value:r,schema:t})}catch(r){throw dn.isInstance(r)||Tr.isInstance(r)?r:new dn({text:e,cause:r})}}async function Wt({text:e,schema:t}){try{const r=gl(e);return t==null?{success:!0,value:r,rawValue:r}:await zr({value:r,schema:t})}catch(r){return{success:!1,error:dn.isInstance(r)?r:new dn({text:e,cause:r}),rawValue:void 0}}}function cg({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new um).pipeThrough(new TransformStream({async transform({data:r},n){r!=="[DONE]"&&n.enqueue(await Wt({text:r,schema:t}))}}))}var pg=()=>globalThis.fetch,ia=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s})=>dg({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s}),dg=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:a,abortSignal:o,fetch:s=pg()})=>{try{const i=await s(e,{method:"POST",headers:ml(t),body:r.content,signal:o}),l=Pr(i);if(!i.ok){let u;try{u=await a({response:i,url:e,requestBodyValues:r.values})}catch(p){throw zt(p)||Ce.isInstance(p)?p:new Ce({message:"Failed to process error response",cause:p,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw u.value}try{return await n({response:i,url:e,requestBodyValues:r.values})}catch(u){throw u instanceof Error&&(zt(u)||Ce.isInstance(u))?u:new Ce({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(i){throw hl({error:i,url:e,requestBodyValues:r.values})}};async function Pt(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var mn=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:a,requestBodyValues:o})=>{const s=await n.text(),i=Pr(n);if(s.trim()==="")return{responseHeaders:i,value:new Ce({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})};try{const l=await ug({text:s,schema:e});return{responseHeaders:i,value:new Ce({message:t(l),url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,data:l,isRetryable:r?.(n,l)})}}catch{return{responseHeaders:i,value:new Ce({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})}}},fg=e=>async({response:t})=>{const r=Pr(t);if(t.body==null)throw new Kh({});return{responseHeaders:r,value:cg({stream:t.body,schema:e})}},Ra=e=>async({response:t,url:r,requestBodyValues:n})=>{const a=await t.text(),o=await Wt({text:a,schema:e}),s=Pr(t);if(!o.success)throw new Ce({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:a,url:r,requestBodyValues:n});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}};function hg(e,t){var r;const n=(r=void 0)!=null?r:!1;return $a(Hm(e,{$refStrategy:n?"root":"none",target:"jsonSchema7"}),{validate:async a=>{const o=await e.safeParseAsync(a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function mg(e,t){var r;const n=(r=void 0)!=null?r:!1,a=Cd(e,{target:"draft-7",io:"output",reused:n?"ref":"inline"});return $a(a,{validate:async o=>{const s=await Bs(e,o);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function gg(e){return"_zod"in e}function vg(e,t){return gg(e)?mg(e):hg(e)}var la=Symbol.for("vercel.ai.schema");function $a(e,{validate:t}={}){return{[la]:!0,_type:void 0,[hn]:!0,jsonSchema:e,validate:t}}function yg(e){return typeof e=="object"&&e!==null&&la in e&&e[la]===!0&&"jsonSchema"in e&&"validate"in e}function En(e){return e==null?$a({properties:{},additionalProperties:!1}):yg(e)?e:vg(e)}var{btoa:_g,atob:bg}=globalThis;function vl(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=bg(t);return Uint8Array.from(r,n=>n.codePointAt(0))}function ua(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return _g(t)}function wg(e){return e?.replace(/\/$/,"")}var kg={},xg="vercel.ai.gateway.error",Un=Symbol.for(xg),$o,Oo,Ve=class yl extends(Oo=Error,$o=Un,Oo){constructor({message:t,statusCode:r=500,cause:n}){super(t),this[$o]=!0,this.statusCode=r,this.cause=n}static isInstance(t){return yl.hasMarker(t)}static hasMarker(t){return typeof t=="object"&&t!==null&&Un in t&&t[Un]===!0}},_l="GatewayAuthenticationError",Tg=`vercel.ai.gateway.error.${_l}`,No=Symbol.for(Tg),Co,Po,Sn=class bl extends(Po=Ve,Co=No,Po){constructor({message:t="Authentication failed",statusCode:r=401,cause:n}={}){super({message:t,statusCode:r,cause:n}),this[Co]=!0,this.name=_l,this.type="authentication_error"}static isInstance(t){return Ve.hasMarker(t)&&No in t}static createContextualError({apiKeyProvided:t,oidcTokenProvided:r,message:n="Authentication failed",statusCode:a=401,cause:o}){let s;return t?s=`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:r?s=`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:s=`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`,new bl({message:s,statusCode:a,cause:o})}},wl="GatewayInvalidRequestError",Eg=`vercel.ai.gateway.error.${wl}`,Mo=Symbol.for(Eg),zo,Do,Sg=class extends(Do=Ve,zo=Mo,Do){constructor({message:e="Invalid request",statusCode:t=400,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[zo]=!0,this.name=wl,this.type="invalid_request_error"}static isInstance(e){return Ve.hasMarker(e)&&Mo in e}},kl="GatewayRateLimitError",Ig=`vercel.ai.gateway.error.${kl}`,Zo=Symbol.for(Ig),Lo,jo,Ag=class extends(jo=Ve,Lo=Zo,jo){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Lo]=!0,this.name=kl,this.type="rate_limit_exceeded"}static isInstance(e){return Ve.hasMarker(e)&&Zo in e}},xl="GatewayModelNotFoundError",Rg=`vercel.ai.gateway.error.${xl}`,Uo=Symbol.for(Rg),$g=E({modelId:_()}),Fo,qo,Tl=class extends(qo=Ve,Fo=Uo,qo){constructor({message:e="Model not found",statusCode:t=404,modelId:r,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Fo]=!0,this.name=xl,this.type="model_not_found",this.modelId=r}static isInstance(e){return Ve.hasMarker(e)&&Uo in e}},El="GatewayInternalServerError",Og=`vercel.ai.gateway.error.${El}`,Bo=Symbol.for(Og),Vo,Go,Ho=class extends(Go=Ve,Vo=Bo,Go){constructor({message:e="Internal server error",statusCode:t=500,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Vo]=!0,this.name=El,this.type="internal_server_error"}static isInstance(e){return Ve.hasMarker(e)&&Bo in e}},Sl="GatewayResponseError",Ng=`vercel.ai.gateway.error.${Sl}`,Jo=Symbol.for(Ng),Wo,Yo,Cg=class extends(Yo=Ve,Wo=Jo,Yo){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:r,validationError:n,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[Wo]=!0,this.name=Sl,this.type="response_error",this.response=r,this.validationError=n}static isInstance(e){return Ve.hasMarker(e)&&Jo in e}};function Xo({response:e,statusCode:t,defaultMessage:r="Gateway request failed",cause:n,authMethod:a}){const o=Pg.safeParse(e);if(!o.success)return new Cg({message:`Invalid error response format: ${r}`,statusCode:t,response:e,validationError:o.error,cause:n});const s=o.data,i=s.error.type,l=s.error.message;switch(i){case"authentication_error":return Sn.createContextualError({apiKeyProvided:a==="api-key",oidcTokenProvided:a==="oidc",statusCode:t,cause:n});case"invalid_request_error":return new Sg({message:l,statusCode:t,cause:n});case"rate_limit_exceeded":return new Ag({message:l,statusCode:t,cause:n});case"model_not_found":{const u=$g.safeParse(s.error.param);return new Tl({message:l,statusCode:t,modelId:u.success?u.data.modelId:void 0,cause:n})}case"internal_server_error":return new Ho({message:l,statusCode:t,cause:n});default:return new Ho({message:l,statusCode:t,cause:n})}}var Pg=E({error:E({message:_(),type:_().nullish(),param:$e().nullish(),code:re([_(),L()]).nullish()})});function Er(e,t){var r;return Ve.isInstance(e)?e:Ce.isInstance(e)?Xo({response:Mg(e),statusCode:(r=e.statusCode)!=null?r:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):Xo({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}function Mg(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var Il="ai-gateway-auth-method";function gn(e){const t=zg.safeParse(e[Il]);return t.success?t.data:void 0}var zg=re([I("api-key"),I("oidc")]),Dg=class{constructor(e){this.config=e}async getAvailableModels(){try{const{value:e}=await Qm({url:`${this.config.baseURL}/config`,headers:await Pt(this.config.headers()),successfulResponseHandler:Ra(Ug),failedResponseHandler:mn({errorSchema:Ct(),errorToMessage:t=>t}),fetch:this.config.fetch});return e}catch(e){throw Er(e)}}},Zg=E({specificationVersion:I("v2"),provider:_(),modelId:_()}),Lg=E({input:_(),output:_()}),jg=E({id:_(),name:_(),description:_().nullish(),pricing:Lg.nullish(),specification:Zg}),Ug=E({models:ee(jg)}),Fg=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){const{abortSignal:t,...r}=e;return{args:this.maybeEncodeFileParts(r),warnings:[]}}async doGenerate(e){const{args:t,warnings:r}=await this.getArgs(e),{abortSignal:n}=e,a=await Pt(this.config.headers());try{const{responseHeaders:o,value:s,rawValue:i}=await ia({url:this.getUrl(),headers:oa(a,e.headers,this.getModelConfigHeaders(this.modelId,!1),await Pt(this.config.o11yHeaders)),body:t,successfulResponseHandler:Ra(Ct()),failedResponseHandler:mn({errorSchema:Ct(),errorToMessage:l=>l}),...n&&{abortSignal:n},fetch:this.config.fetch});return{...s,request:{body:t},response:{headers:o,body:i},warnings:r}}catch(o){throw Er(o,gn(a))}}async doStream(e){const{args:t,warnings:r}=await this.getArgs(e),{abortSignal:n}=e,a=await Pt(this.config.headers());try{const{value:o,responseHeaders:s}=await ia({url:this.getUrl(),headers:oa(a,e.headers,this.getModelConfigHeaders(this.modelId,!0),await Pt(this.config.o11yHeaders)),body:t,successfulResponseHandler:fg(Ct()),failedResponseHandler:mn({errorSchema:Ct(),errorToMessage:i=>i}),...n&&{abortSignal:n},fetch:this.config.fetch});return{stream:o.pipeThrough(new TransformStream({start(i){r.length>0&&i.enqueue({type:"stream-start",warnings:r})},transform(i,l){if(i.success){const u=i.value;if(u.type==="raw"&&!e.includeRawChunks)return;u.type==="response-metadata"&&u.timestamp&&typeof u.timestamp=="string"&&(u.timestamp=new Date(u.timestamp)),l.enqueue(u)}else l.error(i.error)}})),request:{body:t},response:{headers:s}}}catch(o){throw Er(o,gn(a))}}isFilePart(e){return e&&typeof e=="object"&&"type"in e&&e.type==="file"}maybeEncodeFileParts(e){for(const t of e.prompt)for(const r of t.content)if(this.isFilePart(r)){const n=r;if(n.data instanceof Uint8Array){const a=Uint8Array.from(n.data),o=Buffer.from(a).toString("base64");n.data=new URL(`data:${n.mediaType||"application/octet-stream"};base64,${o}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},qg=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:n}){var a;const o=await Pt(this.config.headers());try{const{responseHeaders:s,value:i,rawValue:l}=await ia({url:this.getUrl(),headers:oa(o,t??{},this.getModelConfigHeaders(),await Pt(this.config.o11yHeaders)),body:{input:e.length===1?e[0]:e,...n??{}},successfulResponseHandler:Ra(Bg),failedResponseHandler:mn({errorSchema:Ct(),errorToMessage:u=>u}),...r&&{abortSignal:r},fetch:this.config.fetch});return{embeddings:i.embeddings,usage:(a=i.usage)!=null?a:void 0,providerMetadata:i.providerMetadata,response:{headers:s,body:l}}}catch(s){throw Er(s,gn(o))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},Bg=E({embeddings:ee(ee(L())),usage:E({tokens:L()}).nullish(),providerMetadata:Jt(_(),Jt(_(),$e())).optional()});async function Vg(){var e,t;const r=(t=(e=Al().headers)==null?void 0:e["x-vercel-oidc-token"])!=null?t:kg.VERCEL_OIDC_TOKEN;if(!r)throw new Sn({message:"OIDC token not available",statusCode:401});return r}async function Gg(){var e;return(e=Al().headers)==null?void 0:e["x-vercel-id"]}var Hg=Symbol.for("@vercel/request-context");function Al(){var e,t,r;return(r=(t=(e=globalThis[Hg])==null?void 0:e.get)==null?void 0:t.call(e))!=null?r:{}}var Jg="0.0.1";function Wg(e={}){var t,r;let n=null,a=null;const o=(t=e.metadataCacheRefreshMillis)!=null?t:1e3*60*5;let s=0;const i=(r=wg(e.baseURL))!=null?r:"https://ai-gateway.vercel.sh/v1/ai",l=async()=>{const c=await Xg(e);if(c)return{Authorization:`Bearer ${c.token}`,"ai-gateway-protocol-version":Jg,[Il]:c.authMethod,...e.headers};throw Sn.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},u=()=>{const c=Kr({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),d=Kr({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),m=Kr({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const y=await Gg();return{...c&&{"ai-o11y-deployment-id":c},...d&&{"ai-o11y-environment":d},...m&&{"ai-o11y-region":m},...y&&{"ai-o11y-request-id":y}}}},p=c=>new Fg(c,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),f=async()=>{var c,d,m;const y=(m=(d=(c=e._internal)==null?void 0:c.currentDate)==null?void 0:d.call(c).getTime())!=null?m:Date.now();return(!n||y-s>o)&&(s=y,n=new Dg({baseURL:i,headers:l,fetch:e.fetch}).getAvailableModels().then(b=>(a=b,b)).catch(async b=>{throw Er(b,gn(await l()))})),a?Promise.resolve(a):n},v=function(c){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return p(c)};return v.getAvailableModels=f,v.imageModel=c=>{throw new am({modelId:c,modelType:"imageModel"})},v.languageModel=p,v.textEmbeddingModel=c=>new qg(c,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),v}var Yg=Wg();async function Xg(e){const t=Kr({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await Vg(),authMethod:"oidc"}}catch{return null}}var Kg=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Mt="1.9.0",Ko=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Qg(e){var t=new Set([e]),r=new Set,n=e.match(Ko);if(!n)return function(){return!1};var a={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(a.prerelease!=null)return function(l){return l===e};function o(i){return r.add(i),!1}function s(i){return t.add(i),!0}return function(l){if(t.has(l))return!0;if(r.has(l))return!1;var u=l.match(Ko);if(!u)return o(l);var p={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return p.prerelease!=null||a.major!==p.major?o(l):a.major===0?a.minor===p.minor&&a.patch<=p.patch?s(l):o(l):a.minor<=p.minor?s(l):o(l)}}var ev=Qg(Mt),tv=Mt.split(".")[0],Sr=Symbol.for("opentelemetry.js.api."+tv),Ir=Kg;function Oa(e,t,r,n){var a;n===void 0&&(n=!1);var o=Ir[Sr]=(a=Ir[Sr])!==null&&a!==void 0?a:{version:Mt};if(!n&&o[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(s.stack||s.message),!1}if(o.version!==Mt){var s=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+Mt);return r.error(s.stack||s.message),!1}return o[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+Mt+"."),!0}function Ar(e){var t,r,n=(t=Ir[Sr])===null||t===void 0?void 0:t.version;if(!(!n||!ev(n)))return(r=Ir[Sr])===null||r===void 0?void 0:r[e]}function Na(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+Mt+".");var r=Ir[Sr];r&&delete r[e]}var rv=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},nv=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},av=function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return lr("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return lr("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return lr("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return lr("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return lr("verbose",this._namespace,t)},e}();function lr(e,t,r){var n=Ar("diag");if(n)return r.unshift(t),n[e].apply(n,nv([],rv(r),!1))}var Be;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(Be||(Be={}));function ov(e,t){e<Be.NONE?e=Be.NONE:e>Be.ALL&&(e=Be.ALL),t=t||{};function r(n,a){var o=t[n];return typeof o=="function"&&e>=a?o.bind(t):function(){}}return{error:r("error",Be.ERROR),warn:r("warn",Be.WARN),info:r("info",Be.INFO),debug:r("debug",Be.DEBUG),verbose:r("verbose",Be.VERBOSE)}}var sv=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},iv=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},lv="diag",vn=function(){function e(){function t(a){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var i=Ar("diag");if(i)return i[a].apply(i,iv([],sv(o),!1))}}var r=this,n=function(a,o){var s,i,l;if(o===void 0&&(o={logLevel:Be.INFO}),a===r){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((s=u.stack)!==null&&s!==void 0?s:u.message),!1}typeof o=="number"&&(o={logLevel:o});var p=Ar("diag"),f=ov((i=o.logLevel)!==null&&i!==void 0?i:Be.INFO,a);if(p&&!o.suppressOverrideMessage){var v=(l=new Error().stack)!==null&&l!==void 0?l:"<failed to generate stacktrace>";p.warn("Current logger will be overwritten from "+v),f.warn("Current logger will overwrite one already registered from "+v)}return Oa("diag",f,r,!0)};r.setLogger=n,r.disable=function(){Na(lv,r)},r.createComponentLogger=function(a){return new av(a)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}();function uv(e){return Symbol.for(e)}var cv=function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,a){var o=new e(r._currentContext);return o._currentContext.set(n,a),o},r.deleteValue=function(n){var a=new e(r._currentContext);return a._currentContext.delete(n),a}}return e}(),pv=new cv,dv=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},fv=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},hv=function(){function e(){}return e.prototype.active=function(){return pv},e.prototype.with=function(t,r,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];return r.call.apply(r,fv([n],dv(a),!1))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),mv=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},gv=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},Fn="context",vv=new hv,Rl=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Oa(Fn,t,vn.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,n){for(var a,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return(a=this._getContextManager()).with.apply(a,gv([t,r,n],mv(o),!1))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return Ar(Fn)||vv},e.prototype.disable=function(){this._getContextManager().disable(),Na(Fn,vn.instance())},e}(),ca;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(ca||(ca={}));var $l="0000000000000000",Ol="00000000000000000000000000000000",yv={traceId:Ol,spanId:$l,traceFlags:ca.NONE},_r=function(){function e(t){t===void 0&&(t=yv),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,r){},e}(),Ca=uv("OpenTelemetry Context Key SPAN");function Pa(e){return e.getValue(Ca)||void 0}function _v(){return Pa(Rl.getInstance().active())}function Ma(e,t){return e.setValue(Ca,t)}function bv(e){return e.deleteValue(Ca)}function wv(e,t){return Ma(e,new _r(t))}function Nl(e){var t;return(t=Pa(e))===null||t===void 0?void 0:t.spanContext()}var kv=/^([0-9a-f]{32})$/i,xv=/^[0-9a-f]{16}$/i;function Tv(e){return kv.test(e)&&e!==Ol}function Ev(e){return xv.test(e)&&e!==$l}function Cl(e){return Tv(e.traceId)&&Ev(e.spanId)}function Sv(e){return new _r(e)}var qn=Rl.getInstance(),Pl=function(){function e(){}return e.prototype.startSpan=function(t,r,n){n===void 0&&(n=qn.active());var a=!!r?.root;if(a)return new _r;var o=n&&Nl(n);return Iv(o)&&Cl(o)?new _r(o):new _r},e.prototype.startActiveSpan=function(t,r,n,a){var o,s,i;if(!(arguments.length<2)){arguments.length===2?i=r:arguments.length===3?(o=r,i=n):(o=r,s=n,i=a);var l=s??qn.active(),u=this.startSpan(t,o,l),p=Ma(l,u);return qn.with(p,i,void 0,u)}},e}();function Iv(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var Av=new Pl,Rv=function(){function e(t,r,n,a){this._provider=t,this.name=r,this.version=n,this.options=a}return e.prototype.startSpan=function(t,r,n){return this._getTracer().startSpan(t,r,n)},e.prototype.startActiveSpan=function(t,r,n,a){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Av},e}(),$v=function(){function e(){}return e.prototype.getTracer=function(t,r,n){return new Pl},e}(),Ov=new $v,Qo=function(){function e(){}return e.prototype.getTracer=function(t,r,n){var a;return(a=this.getDelegateTracer(t,r,n))!==null&&a!==void 0?a:new Rv(this,t,r,n)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:Ov},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,r,n){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,r,n)},e}(),yn;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(yn||(yn={}));var Bn="trace",Nv=function(){function e(){this._proxyTracerProvider=new Qo,this.wrapSpanContext=Sv,this.isSpanContextValid=Cl,this.deleteSpan=bv,this.getSpan=Pa,this.getActiveSpan=_v,this.getSpanContext=Nl,this.setSpan=Ma,this.setSpanContext=wv}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=Oa(Bn,this._proxyTracerProvider,vn.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return Ar(Bn)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){Na(Bn,vn.instance()),this._proxyTracerProvider=new Qo},e}(),Cv=Nv.getInstance(),Pv=Object.defineProperty,Mv=(e,t)=>{for(var r in t)Pv(e,r,{get:t[r],enumerable:!0})},Ml="AI_NoOutputSpecifiedError",zl=`vercel.ai.error.${Ml}`,zv=Symbol.for(zl),Dl,Dv=class extends j{constructor({message:e="No output specified."}={}){super({name:Ml,message:e}),this[Dl]=!0}static isInstance(e){return j.hasMarker(e,zl)}};Dl=zv;var Zl="AI_InvalidArgumentError",Ll=`vercel.ai.error.${Zl}`,Zv=Symbol.for(Ll),jl,lt=class extends j{constructor({parameter:e,value:t,message:r}){super({name:Zl,message:`Invalid argument for parameter ${e}: ${r}`}),this[jl]=!0,this.parameter=e,this.value=t}static isInstance(e){return j.hasMarker(e,Ll)}};jl=Zv;var Ul="AI_InvalidToolInputError",Fl=`vercel.ai.error.${Ul}`,Lv=Symbol.for(Fl),ql,Bl=class extends j{constructor({toolInput:e,toolName:t,cause:r,message:n=`Invalid input for tool ${t}: ${Yt(r)}`}){super({name:Ul,message:n,cause:r}),this[ql]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return j.hasMarker(e,Fl)}};ql=Lv;var Vl="AI_NoObjectGeneratedError",Gl=`vercel.ai.error.${Vl}`,jv=Symbol.for(Gl),Hl,es=class extends j{constructor({message:e="No object generated.",cause:t,text:r,response:n,usage:a,finishReason:o}){super({name:Vl,message:e,cause:t}),this[Hl]=!0,this.text=r,this.response=n,this.usage=a,this.finishReason=o}static isInstance(e){return j.hasMarker(e,Gl)}};Hl=jv;var Jl="AI_NoSuchToolError",Wl=`vercel.ai.error.${Jl}`,Uv=Symbol.for(Wl),Yl,pa=class extends j{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Jl,message:r}),this[Yl]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return j.hasMarker(e,Wl)}};Yl=Uv;var Xl="AI_ToolCallRepairError",Kl=`vercel.ai.error.${Xl}`,Fv=Symbol.for(Kl),Ql,qv=class extends j{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${Yt(e)}`}){super({name:Xl,message:r,cause:e}),this[Ql]=!0,this.originalError=t}static isInstance(e){return j.hasMarker(e,Kl)}};Ql=Fv;var Bv=class extends j{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},eu="AI_InvalidMessageRoleError",tu=`vercel.ai.error.${eu}`,Vv=Symbol.for(tu),ru,Gv=class extends j{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:eu,message:t}),this[ru]=!0,this.role=e}static isInstance(e){return j.hasMarker(e,tu)}};ru=Vv;var nu="AI_DownloadError",au=`vercel.ai.error.${nu}`,Hv=Symbol.for(au),ou,Vn=class extends j{constructor({url:e,statusCode:t,statusText:r,cause:n,message:a=n==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${n}`}){super({name:nu,message:a,cause:n}),this[ou]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return j.hasMarker(e,au)}};ou=Hv;var su="AI_RetryError",iu=`vercel.ai.error.${su}`,Jv=Symbol.for(iu),lu,ts=class extends j{constructor({message:e,reason:t,errors:r}){super({name:su,message:e}),this[lu]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return j.hasMarker(e,iu)}};lu=Jv;function uu(e){if(typeof e!="string"){if(e.specificationVersion!=="v2")throw new Bv({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return Wv().languageModel(e)}function Wv(){var e;return(e=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?e:Yg}var Yv=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],Xv=e=>{const t=typeof e=="string"?vl(e):e,r=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(r+10)};function Kv(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Xv(e):e}function Qv({data:e,signatures:t}){const r=Kv(e);for(const n of t)if(typeof r=="string"?r.startsWith(n.base64Prefix):r.length>=n.bytesPrefix.length&&n.bytesPrefix.every((a,o)=>r[o]===a))return n.mediaType}async function ey({url:e}){var t;const r=e.toString();try{const n=await fetch(r);if(!n.ok)throw new Vn({url:r,statusCode:n.status,statusText:n.statusText});return{data:new Uint8Array(await n.arrayBuffer()),mediaType:(t=n.headers.get("content-type"))!=null?t:void 0}}catch(n){throw Vn.isInstance(n)?n:new Vn({url:r,cause:n})}}function ty(e){try{const[t,r]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return{mediaType:void 0,base64Content:void 0}}}var cu=re([_(),on(Uint8Array),on(ArrayBuffer),jf(e=>{var t,r;return(r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]);function pu(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e=="string")try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol==="data:"){const{mediaType:t,base64Content:r}=ty(e.toString());if(t==null||r==null)throw new j({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:r,mediaType:t}}return{data:e,mediaType:void 0}}function ry(e){return typeof e=="string"?e:e instanceof ArrayBuffer?ua(new Uint8Array(e)):ua(e)}async function ny({prompt:e,supportedUrls:t,downloadImplementation:r=ey}){const n=await oy(e.messages,r,t);return[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(a=>ay({message:a,downloadedAssets:n}))]}function ay({message:e,downloadedAssets:t}){const r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"user",content:e.content.map(n=>sy(n,t)).filter(n=>n.type!=="text"||n.text!==""),providerOptions:e.providerOptions};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"assistant",content:e.content.filter(n=>n.type!=="text"||n.text!=="").map(n=>{const a=n.providerOptions;switch(n.type){case"file":{const{data:o,mediaType:s}=pu(n.data);return{type:"file",data:o,filename:n.filename,mediaType:s??n.mediaType,providerOptions:a}}case"reasoning":return{type:"reasoning",text:n.text,providerOptions:a};case"text":return{type:"text",text:n.text,providerOptions:a};case"tool-call":return{type:"tool-call",toolCallId:n.toolCallId,toolName:n.toolName,input:n.input,providerExecuted:n.providerExecuted,providerOptions:a};case"tool-result":return{type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,output:n.output,providerOptions:a}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(n=>({type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,output:n.output,providerOptions:n.providerOptions})),providerOptions:e.providerOptions};default:{const n=r;throw new Gv({role:n})}}}async function oy(e,t,r){const n=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").map(o=>{var s;const i=(s=o.mediaType)!=null?s:o.type==="image"?"image/*":void 0;let l=o.type==="image"?o.image:o.data;if(typeof l=="string")try{l=new URL(l)}catch{}return{mediaType:i,data:l}}).filter(o=>o.data instanceof URL&&o.mediaType!=null&&!eg({url:o.data.toString(),mediaType:o.mediaType,supportedUrls:r})).map(o=>o.data),a=await Promise.all(n.map(async o=>({url:o,data:await t({url:o})})));return Object.fromEntries(a.map(({url:o,data:s})=>[o.toString(),s]))}function sy(e,t){var r;if(e.type==="text")return{type:"text",text:e.text,providerOptions:e.providerOptions};let n;const a=e.type;switch(a){case"image":n=e.image;break;case"file":n=e.data;break;default:throw new Error(`Unsupported part type: ${a}`)}const{data:o,mediaType:s}=pu(n);let i=s??e.mediaType,l=o;if(l instanceof URL){const u=t[l.toString()];u&&(l=u.data,i??(i=u.mediaType))}switch(a){case"image":return(l instanceof Uint8Array||typeof l=="string")&&(i=(r=Qv({data:l,signatures:Yv}))!=null?r:i),{type:"file",mediaType:i??"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":{if(i==null)throw new Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:l,providerOptions:e.providerOptions}}}}function iy({maxOutputTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,seed:s,stopSequences:i}){if(e!=null){if(!Number.isInteger(e))throw new lt({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new lt({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new lt({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new lt({parameter:"topP",value:r,message:"topP must be a number"});if(n!=null&&typeof n!="number")throw new lt({parameter:"topK",value:n,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new lt({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(o!=null&&typeof o!="number")throw new lt({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(s!=null&&!Number.isInteger(s))throw new lt({parameter:"seed",value:s,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,stopSequences:i,seed:s}}function ly(e){return e!=null&&Object.keys(e).length>0}function uy({tools:e,toolChoice:t,activeTools:r}){return ly(e)?{tools:(r!=null?Object.entries(e).filter(([a])=>r.includes(a)):Object.entries(e)).map(([a,o])=>{const s=o.type;switch(s){case void 0:case"dynamic":case"function":return{type:"function",name:a,description:o.description,inputSchema:En(o.inputSchema).jsonSchema,providerOptions:o.providerOptions};case"provider-defined":return{type:"provider-defined",name:a,id:o.id,args:o.args};default:{const i=s;throw new Error(`Unsupported tool type: ${i}`)}}}),toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var Rr=Zf(()=>re([ff(),_(),L(),Te(),Jt(_(),Rr),ee(Rr)])),fe=Jt(_(),Jt(_(),Rr)),du=E({type:I("text"),text:_(),providerOptions:fe.optional()}),cy=E({type:I("image"),image:re([cu,on(URL)]),mediaType:_().optional(),providerOptions:fe.optional()}),fu=E({type:I("file"),data:re([cu,on(URL)]),filename:_().optional(),mediaType:_(),providerOptions:fe.optional()}),py=E({type:I("reasoning"),text:_(),providerOptions:fe.optional()}),dy=E({type:I("tool-call"),toolCallId:_(),toolName:_(),input:$e(),providerOptions:fe.optional(),providerExecuted:Te().optional()}),fy=_f("type",[E({type:I("text"),value:_()}),E({type:I("json"),value:Rr}),E({type:I("error-text"),value:_()}),E({type:I("error-json"),value:Rr}),E({type:I("content"),value:ee(re([E({type:I("text"),text:_()}),E({type:I("media"),data:_(),mediaType:_()})]))})]),hu=E({type:I("tool-result"),toolCallId:_(),toolName:_(),output:fy,providerOptions:fe.optional()}),hy=E({role:I("system"),content:_(),providerOptions:fe.optional()}),my=E({role:I("user"),content:re([_(),ee(re([du,cy,fu]))]),providerOptions:fe.optional()}),gy=E({role:I("assistant"),content:re([_(),ee(re([du,fu,py,dy,hu]))]),providerOptions:fe.optional()}),vy=E({role:I("tool"),content:ee(hu),providerOptions:fe.optional()}),yy=re([hy,my,gy,vy]);async function _y(e){if(e.prompt==null&&e.messages==null)throw new Vt({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new Vt({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new Vt({prompt:e,message:"system must be a string"});let t;if(e.prompt!=null&&typeof e.prompt=="string")t=[{role:"user",content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new Vt({prompt:e,message:"prompt or messages must be defined"});if(t.length===0)throw new Vt({prompt:e,message:"messages must not be empty"});const r=await zr({value:t,schema:ee(yy)});if(!r.success)throw new Vt({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:r.error});return{messages:t,system:e.system}}function by(e){return Sn.isInstance(e)||Tl.isInstance(e)?new j({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}function da({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function wy({model:e,settings:t,telemetry:r,headers:n}){var a;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((o,[s,i])=>(o[`ai.settings.${s}`]=i,o),{}),...Object.entries((a=r?.metadata)!=null?a:{}).reduce((o,[s,i])=>(o[`ai.telemetry.metadata.${s}`]=i,o),{}),...Object.entries(n??{}).reduce((o,[s,i])=>(i!==void 0&&(o[`ai.request.headers.${s}`]=i),o),{})}}var ky={startSpan(){return Br},startActiveSpan(e,t,r,n){if(typeof t=="function")return t(Br);if(typeof r=="function")return r(Br);if(typeof n=="function")return n(Br)}},Br={spanContext(){return xy},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},xy={traceId:"",spanId:"",traceFlags:0};function Ty({isEnabled:e=!1,tracer:t}={}){return e?t||Cv.getTracer("ai"):ky}function fa({name:e,tracer:t,attributes:r,fn:n,endWhenDone:a=!0}){return t.startActiveSpan(e,{attributes:r},async o=>{try{const s=await n(o);return a&&o.end(),s}catch(s){try{mu(o,s)}finally{o.end()}throw s}})}function mu(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:yn.ERROR,message:t.message})):e.setStatus({code:yn.ERROR})}function Ht({telemetry:e,attributes:t}){return e?.isEnabled!==!0?{}:Object.entries(t).reduce((r,[n,a])=>{if(a==null)return r;if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if(e?.recordInputs===!1)return r;const o=a.input();return o==null?r:{...r,[n]:o}}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if(e?.recordOutputs===!1)return r;const o=a.output();return o==null?r:{...r,[n]:o}}return{...r,[n]:a}},{})}function Ey(e){return JSON.stringify(e.map(t=>({...t,content:typeof t.content=="string"?t.content:t.content.map(r=>r.type==="file"?{...r,data:r.data instanceof Uint8Array?ry(r.data):r.data}:r)})))}function Sy(e,t){return{inputTokens:ur(e.inputTokens,t.inputTokens),outputTokens:ur(e.outputTokens,t.outputTokens),totalTokens:ur(e.totalTokens,t.totalTokens),reasoningTokens:ur(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:ur(e.cachedInputTokens,t.cachedInputTokens)}}function ur(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function rs(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function Iy({error:e,exponentialBackoffDelay:t}){const r=e.responseHeaders;if(!r)return t;let n;const a=r["retry-after-ms"];if(a){const s=parseFloat(a);Number.isNaN(s)||(n=s)}const o=r["retry-after"];if(o&&n===void 0){const s=parseFloat(o);Number.isNaN(s)?n=Date.parse(o)-Date.now():n=s*1e3}return n!=null&&!Number.isNaN(n)&&0<=n&&(n<60*1e3||n<t)?n:t}var Ay=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2,abortSignal:n}={})=>async a=>gu(a,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:n});async function gu(e,{maxRetries:t,delayInMs:r,backoffFactor:n,abortSignal:a},o=[]){try{return await e()}catch(s){if(zt(s)||t===0)throw s;const i=fl(s),l=[...o,s],u=l.length;if(u>t)throw new ts({message:`Failed after ${u} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:l});if(s instanceof Error&&Ce.isInstance(s)&&s.isRetryable===!0&&u<=t)return await Wm(Iy({error:s,exponentialBackoffDelay:r}),{abortSignal:a}),gu(e,{maxRetries:t,delayInMs:n*r,backoffFactor:n,abortSignal:a},l);throw u===1?s:new ts({message:`Failed after ${u} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:l})}}function Ry({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new lt({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new lt({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const r=e??2;return{maxRetries:r,retry:Ay({maxRetries:r,abortSignal:t})}}var $y=class{constructor({data:e,mediaType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mediaType=t}get base64(){return this.base64Data==null&&(this.base64Data=ua(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=vl(this.base64Data)),this.uint8ArrayData}},Oy=class extends $y{constructor(e){super(e),this.type="file"}};async function Ny({toolCall:e,tools:t,repairToolCall:r,system:n,messages:a}){try{if(t==null)throw new pa({toolName:e.toolName});try{return await ns({toolCall:e,tools:t})}catch(o){if(r==null||!(pa.isInstance(o)||Bl.isInstance(o)))throw o;let s=null;try{s=await r({toolCall:e,tools:t,inputSchema:({toolName:i})=>{const{inputSchema:l}=t[i];return En(l).jsonSchema},system:n,messages:a,error:o})}catch(i){throw new qv({cause:i,originalError:o})}if(s==null)throw o;return await ns({toolCall:s,tools:t})}}catch(o){return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,dynamic:!0,invalid:!0,error:o}}}async function ns({toolCall:e,tools:t}){const r=e.toolName,n=t[r];if(n==null)throw new pa({toolName:e.toolName,availableTools:Object.keys(t)});const a=En(n.inputSchema),o=e.input.trim()===""?await zr({value:{},schema:a}):await Wt({text:e.input,schema:a});if(o.success===!1)throw new Bl({toolName:r,toolInput:e.input,cause:o.error});return n.type==="dynamic"?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:r,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var Cy=class{constructor({content:e,finishReason:t,usage:r,warnings:n,request:a,response:o,providerMetadata:s}){this.content=e,this.finishReason=t,this.usage=r,this.warnings=n,this.request=a,this.response=o,this.providerMetadata=s}get text(){return this.content.filter(e=>e.type==="text").map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>e.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>e.type==="file").map(e=>e.file)}get sources(){return this.content.filter(e=>e.type==="source")}get toolCalls(){return this.content.filter(e=>e.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!1)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type==="tool-result")}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic===!1)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function Py(e){return({steps:t})=>t.length===e}async function My({stopConditions:e,steps:t}){return(await Promise.all(e.map(r=>r({steps:t})))).some(r=>r)}function Gn({output:e,tool:t,errorMode:r}){return r==="text"?{type:"error-text",value:Yt(e)}:r==="json"?{type:"error-json",value:as(e)}:t?.toModelOutput?t.toModelOutput(e):typeof e=="string"?{type:"text",value:e}:{type:"json",value:as(e)}}function as(e){return e===void 0?null:e}function os({content:e,tools:t}){const r=[],n=e.filter(o=>o.type!=="source").filter(o=>(o.type!=="tool-result"||o.providerExecuted)&&(o.type!=="tool-error"||o.providerExecuted)).filter(o=>o.type!=="text"||o.text.length>0).map(o=>{switch(o.type){case"text":return{type:"text",text:o.text,providerOptions:o.providerMetadata};case"reasoning":return{type:"reasoning",text:o.text,providerOptions:o.providerMetadata};case"file":return{type:"file",data:o.file.base64,mediaType:o.file.mediaType,providerOptions:o.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:o.toolCallId,toolName:o.toolName,input:o.input,providerExecuted:o.providerExecuted,providerOptions:o.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:Gn({tool:t?.[o.toolName],output:o.output,errorMode:"none"}),providerExecuted:!0,providerOptions:o.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:Gn({tool:t?.[o.toolName],output:o.error,errorMode:"json"}),providerOptions:o.providerMetadata}}});n.length>0&&r.push({role:"assistant",content:n});const a=e.filter(o=>o.type==="tool-result"||o.type==="tool-error").filter(o=>!o.providerExecuted).map(o=>({type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:Gn({tool:t?.[o.toolName],output:o.type==="tool-result"?o.output:o.error,errorMode:o.type==="tool-error"?"text":"none"})}));return a.length>0&&r.push({role:"tool",content:a}),r}Mr({prefix:"aitxt",size:24});function In(e,t){const r=new Headers(e??{});for(const[n,a]of Object.entries(t))r.has(n)||r.set(n,a);return r}function zy({status:e,statusText:t,headers:r,textStream:n}){return new Response(n.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:In(r,{"content-type":"text/plain; charset=utf-8"})})}function vu({response:e,status:t,statusText:r,headers:n,stream:a}){e.writeHead(t??200,r,n);const o=a.getReader();(async()=>{try{for(;;){const{done:i,value:l}=await o.read();if(i)break;e.write(l)}}catch(i){throw i}finally{e.end()}})()}function Dy({response:e,status:t,statusText:r,headers:n,textStream:a}){vu({response:e,status:t,statusText:r,headers:Object.fromEntries(In(n,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:a.pipeThrough(new TextEncoderStream)})}var yu=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},_u={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function Zy({status:e,statusText:t,headers:r,stream:n,consumeSseStream:a}){let o=n.pipeThrough(new yu);if(a){const[s,i]=o.tee();o=s,a({stream:i})}return new Response(o.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:In(r,_u)})}function Ly({originalMessages:e,responseMessageId:t}){if(e==null)return;const r=e[e.length-1];return r?.role==="assistant"?r.id:typeof t=="function"?t():t}re([ae({type:I("text-start"),id:_(),providerMetadata:fe.optional()}),ae({type:I("text-delta"),id:_(),delta:_(),providerMetadata:fe.optional()}),ae({type:I("text-end"),id:_(),providerMetadata:fe.optional()}),ae({type:I("error"),errorText:_()}),ae({type:I("tool-input-start"),toolCallId:_(),toolName:_(),providerExecuted:Te().optional(),dynamic:Te().optional()}),ae({type:I("tool-input-delta"),toolCallId:_(),inputTextDelta:_()}),ae({type:I("tool-input-available"),toolCallId:_(),toolName:_(),input:$e(),providerExecuted:Te().optional(),providerMetadata:fe.optional(),dynamic:Te().optional()}),ae({type:I("tool-input-error"),toolCallId:_(),toolName:_(),input:$e(),providerExecuted:Te().optional(),providerMetadata:fe.optional(),dynamic:Te().optional(),errorText:_()}),ae({type:I("tool-output-available"),toolCallId:_(),output:$e(),providerExecuted:Te().optional(),dynamic:Te().optional()}),ae({type:I("tool-output-error"),toolCallId:_(),errorText:_(),providerExecuted:Te().optional(),dynamic:Te().optional()}),ae({type:I("reasoning"),text:_(),providerMetadata:fe.optional()}),ae({type:I("reasoning-start"),id:_(),providerMetadata:fe.optional()}),ae({type:I("reasoning-delta"),id:_(),delta:_(),providerMetadata:fe.optional()}),ae({type:I("reasoning-end"),id:_(),providerMetadata:fe.optional()}),ae({type:I("reasoning-part-finish")}),ae({type:I("source-url"),sourceId:_(),url:_(),title:_().optional(),providerMetadata:fe.optional()}),ae({type:I("source-document"),sourceId:_(),mediaType:_(),title:_(),filename:_().optional(),providerMetadata:fe.optional()}),ae({type:I("file"),url:_(),mediaType:_(),providerMetadata:fe.optional()}),ae({type:_().startsWith("data-"),id:_().optional(),data:$e(),transient:Te().optional()}),ae({type:I("start-step")}),ae({type:I("finish-step")}),ae({type:I("start"),messageId:_().optional(),messageMetadata:$e().optional()}),ae({type:I("finish"),messageMetadata:$e().optional()}),ae({type:I("abort")}),ae({type:I("message-metadata"),messageMetadata:$e()})]);function jy(e){return e.type.startsWith("data-")}function bu(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const r={...e};for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const a=t[n];if(a===void 0)continue;const o=n in e?e[n]:void 0,s=a!==null&&typeof a=="object"&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp),i=o!=null&&typeof o=="object"&&!Array.isArray(o)&&!(o instanceof Date)&&!(o instanceof RegExp);s&&i?r[n]=bu(o,a):r[n]=a}return r}function Uy(e){const t=["ROOT"];let r=-1,n=null;function a(l,u,p){switch(l){case'"':{r=u,t.pop(),t.push(p),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=u,n=u,t.pop(),t.push(p),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(p),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=u,t.pop(),t.push(p),t.push("INSIDE_NUMBER");break}case"{":{r=u,t.pop(),t.push(p),t.push("INSIDE_OBJECT_START");break}case"[":{r=u,t.pop(),t.push(p),t.push("INSIDE_ARRAY_START");break}}}function o(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=u,t.pop();break}}}function s(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=u,t.pop();break}}}for(let l=0;l<e.length;l++){const u=e[l];switch(t[t.length-1]){case"ROOT":a(u,l,"FINISH");break;case"INSIDE_OBJECT_START":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{r=l,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(u){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(u,l,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{o(u,l);break}case"INSIDE_STRING":{switch(u){case'"':{t.pop(),r=l;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=l}break}case"INSIDE_ARRAY_START":{switch(u){case"]":{r=l,t.pop();break}default:{r=l,a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=l,t.pop();break}default:{r=l;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),r=l;break}case"INSIDE_NUMBER":{switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=l;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(u,l);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(u,l);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const f=e.substring(n,l+1);!"false".startsWith(f)&&!"true".startsWith(f)&&!"null".startsWith(f)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?o(u,l):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l)):r=l;break}}}let i=e.slice(0,r+1);for(let l=t.length-1;l>=0;l--)switch(t[l]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const p=e.substring(n,e.length);"true".startsWith(p)?i+="true".slice(p.length):"false".startsWith(p)?i+="false".slice(p.length):"null".startsWith(p)&&(i+="null".slice(p.length))}}return i}async function wu(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=await Wt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await Wt({text:Uy(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function Hn(e){return e.type.startsWith("tool-")}function ss(e){return e.type.split("-").slice(1).join("-")}function Fy({lastMessage:e,messageId:t}){return{message:e?.role==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function qy({stream:e,messageMetadataSchema:t,dataPartSchemas:r,runUpdateMessageJob:n,onError:a,onToolCall:o,onData:s}){return e.pipeThrough(new TransformStream({async transform(i,l){await n(async({state:u,write:p})=>{var f,v,c,d;function m(g){const M=u.message.parts.filter(Hn).find(O=>O.toolCallId===g);if(M==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return M}function y(g){const M=u.message.parts.filter(O=>O.type==="dynamic-tool").find(O=>O.toolCallId===g);if(M==null)throw new Error("tool-output-error must be preceded by a tool-input-available");return M}function b(g){var C;const M=u.message.parts.find(ve=>Hn(ve)&&ve.toolCallId===g.toolCallId),O=g,F=M;M!=null?(M.state=g.state,F.input=O.input,F.output=O.output,F.errorText=O.errorText,F.rawInput=O.rawInput,F.providerExecuted=(C=O.providerExecuted)!=null?C:M.providerExecuted,O.providerMetadata!=null&&M.state==="input-available"&&(M.callProviderMetadata=O.providerMetadata)):u.message.parts.push({type:`tool-${g.toolName}`,toolCallId:g.toolCallId,state:g.state,input:O.input,output:O.output,rawInput:O.rawInput,errorText:O.errorText,providerExecuted:O.providerExecuted,...O.providerMetadata!=null?{callProviderMetadata:O.providerMetadata}:{}})}function k(g){var C;const M=u.message.parts.find(ve=>ve.type==="dynamic-tool"&&ve.toolCallId===g.toolCallId),O=g,F=M;M!=null?(M.state=g.state,F.toolName=g.toolName,F.input=O.input,F.output=O.output,F.errorText=O.errorText,F.rawInput=(C=O.rawInput)!=null?C:F.rawInput,O.providerMetadata!=null&&M.state==="input-available"&&(M.callProviderMetadata=O.providerMetadata)):u.message.parts.push({type:"dynamic-tool",toolName:g.toolName,toolCallId:g.toolCallId,state:g.state,input:O.input,output:O.output,errorText:O.errorText,...O.providerMetadata!=null?{callProviderMetadata:O.providerMetadata}:{}})}async function x(g){if(g!=null){const C=u.message.metadata!=null?bu(u.message.metadata,g):g;t!=null&&await sa({value:C,schema:t}),u.message.metadata=C}}switch(i.type){case"text-start":{const g={type:"text",text:"",providerMetadata:i.providerMetadata,state:"streaming"};u.activeTextParts[i.id]=g,u.message.parts.push(g),p();break}case"text-delta":{const g=u.activeTextParts[i.id];g.text+=i.delta,g.providerMetadata=(f=i.providerMetadata)!=null?f:g.providerMetadata,p();break}case"text-end":{const g=u.activeTextParts[i.id];g.state="done",g.providerMetadata=(v=i.providerMetadata)!=null?v:g.providerMetadata,delete u.activeTextParts[i.id],p();break}case"reasoning-start":{const g={type:"reasoning",text:"",providerMetadata:i.providerMetadata,state:"streaming"};u.activeReasoningParts[i.id]=g,u.message.parts.push(g),p();break}case"reasoning-delta":{const g=u.activeReasoningParts[i.id];g.text+=i.delta,g.providerMetadata=(c=i.providerMetadata)!=null?c:g.providerMetadata,p();break}case"reasoning-end":{const g=u.activeReasoningParts[i.id];g.providerMetadata=(d=i.providerMetadata)!=null?d:g.providerMetadata,g.state="done",delete u.activeReasoningParts[i.id],p();break}case"file":{u.message.parts.push({type:"file",mediaType:i.mediaType,url:i.url}),p();break}case"source-url":{u.message.parts.push({type:"source-url",sourceId:i.sourceId,url:i.url,title:i.title,providerMetadata:i.providerMetadata}),p();break}case"source-document":{u.message.parts.push({type:"source-document",sourceId:i.sourceId,mediaType:i.mediaType,title:i.title,filename:i.filename,providerMetadata:i.providerMetadata}),p();break}case"tool-input-start":{const g=u.message.parts.filter(Hn);u.partialToolCalls[i.toolCallId]={text:"",toolName:i.toolName,index:g.length,dynamic:i.dynamic},i.dynamic?k({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0}):b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}),p();break}case"tool-input-delta":{const g=u.partialToolCalls[i.toolCallId];g.text+=i.inputTextDelta;const{value:C}=await wu(g.text);g.dynamic?k({toolCallId:i.toolCallId,toolName:g.toolName,state:"input-streaming",input:C}):b({toolCallId:i.toolCallId,toolName:g.toolName,state:"input-streaming",input:C}),p();break}case"tool-input-available":{i.dynamic?k({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerMetadata:i.providerMetadata}):b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),p(),o&&!i.providerExecuted&&await o({toolCall:i});break}case"tool-input-error":{i.dynamic?k({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:i.input,errorText:i.errorText,providerMetadata:i.providerMetadata}):b({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:void 0,rawInput:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),p();break}case"tool-output-available":{if(i.dynamic){const g=y(i.toolCallId);k({toolCallId:i.toolCallId,toolName:g.toolName,state:"output-available",input:g.input,output:i.output})}else{const g=m(i.toolCallId);b({toolCallId:i.toolCallId,toolName:ss(g),state:"output-available",input:g.input,output:i.output,providerExecuted:i.providerExecuted})}p();break}case"tool-output-error":{if(i.dynamic){const g=y(i.toolCallId);k({toolCallId:i.toolCallId,toolName:g.toolName,state:"output-error",input:g.input,errorText:i.errorText})}else{const g=m(i.toolCallId);b({toolCallId:i.toolCallId,toolName:ss(g),state:"output-error",input:g.input,rawInput:g.rawInput,errorText:i.errorText})}p();break}case"start-step":{u.message.parts.push({type:"step-start"});break}case"finish-step":{u.activeTextParts={},u.activeReasoningParts={};break}case"start":{i.messageId!=null&&(u.message.id=i.messageId),await x(i.messageMetadata),(i.messageId!=null||i.messageMetadata!=null)&&p();break}case"finish":{await x(i.messageMetadata),i.messageMetadata!=null&&p();break}case"message-metadata":{await x(i.messageMetadata),i.messageMetadata!=null&&p();break}case"error":{a?.(new Error(i.errorText));break}default:if(jy(i)){r?.[i.type]!=null&&await sa({value:i.data,schema:r[i.type]});const g=i;if(g.transient){s?.(g);break}const C=g.id!=null?u.message.parts.find(M=>g.type===M.type&&g.id===M.id):void 0;C!=null?C.data=g.data:u.message.parts.push(g),s?.(g),p()}}l.enqueue(i)})}}))}function By({messageId:e,originalMessages:t=[],onFinish:r,onError:n,stream:a}){let o=t?.[t.length-1];o?.role!=="assistant"?o=void 0:e=o.id;let s=!1;const i=a.pipeThrough(new TransformStream({transform(p,f){if(p.type==="start"){const v=p;v.messageId==null&&e!=null&&(v.messageId=e)}p.type==="abort"&&(s=!0),f.enqueue(p)}}));if(r==null)return i;const l=Fy({lastMessage:o?structuredClone(o):void 0,messageId:e??""});return qy({stream:i,runUpdateMessageJob:async p=>{await p({state:l,write:()=>{}})},onError:n}).pipeThrough(new TransformStream({transform(p,f){f.enqueue(p)},async flush(){const p=l.message.id===o?.id;await r({isAborted:s,isContinuation:p,responseMessage:l.message,messages:[...p?t.slice(0,-1):t,l.message]})}}))}function Vy({response:e,status:t,statusText:r,headers:n,stream:a,consumeSseStream:o}){let s=a.pipeThrough(new yu);if(o){const[i,l]=s.tee();s=i,o({stream:l})}vu({response:e,status:t,statusText:r,headers:Object.fromEntries(In(n,_u).entries()),stream:s.pipeThrough(new TextEncoderStream)})}function Vr(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{const r=t.getReader();return{async next(){const{done:n,value:a}=await r.read();return n?{done:!0,value:void 0}:{done:!1,value:a}}}},t}async function Gy({stream:e,onError:t}){const r=e.getReader();try{for(;;){const{done:n}=await r.read();if(n)break}}catch(n){t?.(n)}finally{r.releaseLock()}}function is(){let e,t;return{promise:new Promise((n,a)=>{e=n,t=a}),resolve:e,reject:t}}function Hy(){let e=[],t=null,r=!1,n=is();const a=()=>{r=!0,n.resolve(),e.forEach(s=>s.cancel()),e=[],t?.close()},o=async()=>{if(r&&e.length===0){t?.close();return}if(e.length===0)return n=is(),await n.promise,o();try{const{value:s,done:i}=await e[0].read();i?(e.shift(),e.length>0?await o():r&&t?.close()):t?.enqueue(s)}catch(s){t?.error(s),e.shift(),a()}};return{stream:new ReadableStream({start(s){t=s},pull:o,async cancel(){for(const s of e)await s.cancel();e=[],r=!0}}),addStream:s=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(s.getReader()),n.resolve()},close:()=>{r=!0,n.resolve(),e.length===0&&t?.close()},terminate:a}}var Gr=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise?this._promise:(this._promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this._promise)}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&((t=this._reject)==null||t.call(this,e))}};function Jy(e,t){return new ReadableStream({async start(r){const n=e.getReader();try{for(;;){const{done:a,value:o}=await n.read();if(a){r.close();break}r.enqueue(o)}}catch(a){await t({error:a,controller:r})}},cancel(r){return e.cancel(r)}})}function Wy(){var e,t;return(t=(e=globalThis?.performance)==null?void 0:e.now())!=null?t:Date.now()}function Yy({tools:e,generatorStream:t,tracer:r,telemetry:n,system:a,messages:o,abortSignal:s,repairToolCall:i,experimental_context:l}){let u=null;const p=new ReadableStream({start(b){u=b}}),f=new Set,v=new Map;let c=!1,d;function m(){c&&f.size===0&&(d!=null&&u.enqueue(d),u.close())}const y=new TransformStream({async transform(b,k){const x=b.type;switch(x){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":{k.enqueue(b);break}case"file":{k.enqueue({type:"file",file:new Oy({data:b.data,mediaType:b.mediaType})});break}case"finish":{d={type:"finish",finishReason:b.finishReason,usage:b.usage,providerMetadata:b.providerMetadata};break}case"tool-call":{try{const g=await Ny({toolCall:b,tools:e,repairToolCall:i,system:a,messages:o});if(k.enqueue(g),g.invalid){u.enqueue({type:"tool-error",toolCallId:g.toolCallId,toolName:g.toolName,input:g.input,error:fl(g.error),dynamic:!0});break}const C=e[g.toolName];if(v.set(g.toolCallId,g.input),C.onInputAvailable!=null&&await C.onInputAvailable({input:g.input,toolCallId:g.toolCallId,messages:o,abortSignal:s,experimental_context:l}),C.execute!=null&&g.providerExecuted!==!0){const M=Ym();f.add(M),fa({name:"ai.toolCall",attributes:Ht({telemetry:n,attributes:{...da({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":g.toolName,"ai.toolCall.id":g.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(g.input)}}}),tracer:r,fn:async O=>{let F;try{F=await C.execute(g.input,{toolCallId:g.toolCallId,messages:o,abortSignal:s,experimental_context:l})}catch(ve){mu(O,ve),u.enqueue({...g,type:"tool-error",error:ve}),f.delete(M),m();return}u.enqueue({...g,type:"tool-result",output:F}),f.delete(M),m();try{O.setAttributes(Ht({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(F)}}}))}catch{}}})}}catch(g){u.enqueue({type:"error",error:g})}break}case"tool-result":{const g=b.toolName;b.isError?u.enqueue({type:"tool-error",toolCallId:b.toolCallId,toolName:g,input:v.get(b.toolCallId),providerExecuted:b.providerExecuted,error:b.result}):k.enqueue({type:"tool-result",toolCallId:b.toolCallId,toolName:g,input:v.get(b.toolCallId),output:b.result,providerExecuted:b.providerExecuted});break}default:{const g=x;throw new Error(`Unhandled chunk type: ${g}`)}}},flush(){c=!0,m()}});return new ReadableStream({async start(b){return Promise.all([t.pipeThrough(y).pipeTo(new WritableStream({write(k){b.enqueue(k)},close(){}})),p.pipeTo(new WritableStream({write(k){b.enqueue(k)},close(){b.close()}}))])}})}var Xy=Mr({prefix:"aitxt",size:24});function Ky({model:e,tools:t,toolChoice:r,system:n,prompt:a,messages:o,maxRetries:s,abortSignal:i,headers:l,stopWhen:u=Py(1),experimental_output:p,experimental_telemetry:f,prepareStep:v,providerOptions:c,experimental_activeTools:d,activeTools:m=d,experimental_repairToolCall:y,experimental_transform:b,includeRawChunks:k=!1,onChunk:x,onError:g=({error:me})=>{console.error(me)},onFinish:C,onAbort:M,onStepFinish:O,experimental_context:F,_internal:{now:ve=Wy,generateId:We=Xy,currentDate:Q=()=>new Date}={},...K}){return new e_({model:uu(e),telemetry:f,headers:l,settings:K,maxRetries:s,abortSignal:i,system:n,prompt:a,messages:o,tools:t,toolChoice:r,transforms:rs(b),activeTools:m,repairToolCall:y,stopConditions:rs(u),output:p,providerOptions:c,prepareStep:v,includeRawChunks:k,onChunk:x,onError:g,onFinish:C,onAbort:M,onStepFinish:O,now:ve,currentDate:Q,generateId:We,experimental_context:F})}function Qy(e){if(!e)return new TransformStream({transform(s,i){i.enqueue({part:s,partialOutput:void 0})}});let t,r="",n="",a="";function o({controller:s,partialOutput:i=void 0}){s.enqueue({part:{type:"text-delta",id:t,text:n},partialOutput:i}),n=""}return new TransformStream({async transform(s,i){if(s.type==="finish-step"&&n.length>0&&o({controller:i}),s.type!=="text-delta"&&s.type!=="text-start"&&s.type!=="text-end"){i.enqueue({part:s,partialOutput:void 0});return}if(t==null)t=s.id;else if(s.id!==t){i.enqueue({part:s,partialOutput:void 0});return}if(s.type==="text-start"){i.enqueue({part:s,partialOutput:void 0});return}if(s.type==="text-end"){n.length>0&&o({controller:i}),i.enqueue({part:s,partialOutput:void 0});return}r+=s.text,n+=s.text;const l=await e.parsePartial({text:r});if(l!=null){const u=JSON.stringify(l.partial);u!==a&&(o({controller:i,partialOutput:l.partial}),a=u)}}})}var e_=class{constructor({model:e,telemetry:t,headers:r,settings:n,maxRetries:a,abortSignal:o,system:s,prompt:i,messages:l,tools:u,toolChoice:p,transforms:f,activeTools:v,repairToolCall:c,stopConditions:d,output:m,providerOptions:y,prepareStep:b,includeRawChunks:k,now:x,currentDate:g,generateId:C,onChunk:M,onError:O,onFinish:F,onAbort:ve,onStepFinish:We,experimental_context:Q}){this._totalUsage=new Gr,this._finishReason=new Gr,this._steps=new Gr,this.output=m,this.includeRawChunks=k,this.tools=u;let K,me=[];const ge=[];let Ue,Ye,V={},xe=[];const z=[];let Xe,$={},De={};const U=new TransformStream({async transform(pe,ne){var ye,q,Ke;ne.enqueue(pe);const{part:S}=pe;if((S.type==="text-delta"||S.type==="reasoning-delta"||S.type==="source"||S.type==="tool-call"||S.type==="tool-result"||S.type==="tool-input-start"||S.type==="tool-input-delta"||S.type==="raw")&&await M?.({chunk:S}),S.type==="error"&&await O({error:by(S.error)}),S.type==="text-start"&&($[S.id]={type:"text",text:"",providerMetadata:S.providerMetadata},me.push($[S.id])),S.type==="text-delta"){const se=$[S.id];if(se==null){ne.enqueue({part:{type:"error",error:`text part ${S.id} not found`},partialOutput:void 0});return}se.text+=S.text,se.providerMetadata=(ye=S.providerMetadata)!=null?ye:se.providerMetadata}if(S.type==="text-end"&&delete $[S.id],S.type==="reasoning-start"&&(De[S.id]={type:"reasoning",text:"",providerMetadata:S.providerMetadata},me.push(De[S.id])),S.type==="reasoning-delta"){const se=De[S.id];if(se==null){ne.enqueue({part:{type:"error",error:`reasoning part ${S.id} not found`},partialOutput:void 0});return}se.text+=S.text,se.providerMetadata=(q=S.providerMetadata)!=null?q:se.providerMetadata}if(S.type==="reasoning-end"){const se=De[S.id];if(se==null){ne.enqueue({part:{type:"error",error:`reasoning part ${S.id} not found`},partialOutput:void 0});return}se.providerMetadata=(Ke=S.providerMetadata)!=null?Ke:se.providerMetadata,delete De[S.id]}if(S.type==="file"&&me.push({type:"file",file:S.file}),S.type==="source"&&me.push(S),S.type==="tool-call"&&me.push(S),S.type==="tool-result"&&me.push(S),S.type==="tool-error"&&me.push(S),S.type==="start-step"&&(V=S.request,xe=S.warnings),S.type==="finish-step"){const se=os({content:me,tools:u}),st=new Cy({content:me,finishReason:S.finishReason,usage:S.usage,warnings:xe,request:V,response:{...S.response,messages:[...ge,...se]},providerMetadata:S.providerMetadata});await We?.(st),z.push(st),me=[],De={},$={},ge.push(...se),K.resolve()}S.type==="finish"&&(Ye=S.totalUsage,Ue=S.finishReason)},async flush(pe){try{if(z.length===0)return;const ne=Ue??"unknown",ye=Ye??{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};Ge._finishReason.resolve(ne),Ge._totalUsage.resolve(ye),Ge._steps.resolve(z);const q=z[z.length-1];await F?.({finishReason:ne,totalUsage:ye,usage:q.usage,content:q.content,text:q.text,reasoningText:q.reasoningText,reasoning:q.reasoning,files:q.files,sources:q.sources,toolCalls:q.toolCalls,staticToolCalls:q.staticToolCalls,dynamicToolCalls:q.dynamicToolCalls,toolResults:q.toolResults,staticToolResults:q.staticToolResults,dynamicToolResults:q.dynamicToolResults,request:q.request,response:q.response,warnings:q.warnings,providerMetadata:q.providerMetadata,steps:z}),Xe.setAttributes(Ht({telemetry:t,attributes:{"ai.response.finishReason":ne,"ai.response.text":{output:()=>q.text},"ai.response.toolCalls":{output:()=>{var Ke;return(Ke=q.toolCalls)!=null&&Ke.length?JSON.stringify(q.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(q.providerMetadata),"ai.usage.inputTokens":ye.inputTokens,"ai.usage.outputTokens":ye.outputTokens,"ai.usage.totalTokens":ye.totalTokens,"ai.usage.reasoningTokens":ye.reasoningTokens,"ai.usage.cachedInputTokens":ye.cachedInputTokens}}))}catch(ne){pe.error(ne)}finally{Xe.end()}}}),ce=Hy();this.addStream=ce.addStream,this.closeStream=ce.close;let J=ce.stream;J=Jy(J,({error:pe,controller:ne})=>{zt(pe)&&o?.aborted?(ve?.({steps:z}),ne.enqueue({type:"abort"}),ne.close()):ne.error(pe)}),J=J.pipeThrough(new TransformStream({start(pe){pe.enqueue({type:"start"})}}));for(const pe of f)J=J.pipeThrough(pe({tools:u,stopStream(){ce.terminate()}}));this.baseStream=J.pipeThrough(Qy(m)).pipeThrough(U);const{maxRetries:Rt,retry:Xt}=Ry({maxRetries:a,abortSignal:o}),jt=Ty(t),Fe=iy(n),Kt=wy({model:e,telemetry:t,headers:r,settings:{...Fe,maxRetries:Rt}}),Ge=this;fa({name:"ai.streamText",attributes:Ht({telemetry:t,attributes:{...da({operationId:"ai.streamText",telemetry:t}),...Kt,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:i,messages:l})}}}),tracer:jt,endWhenDone:!1,fn:async pe=>{Xe=pe;async function ne({currentStep:ye,responseMessages:q,usage:Ke}){var S,se,st,Qt,er;const Zr=Ge.includeRawChunks;K=new Gr;const Ut=await _y({system:s,prompt:i,messages:l}),Qe=[...Ut.messages,...q],Se=await b?.({model:e,steps:z,stepNumber:z.length,messages:Qe}),ut=await ny({prompt:{system:(S=Se?.system)!=null?S:Ut.system,messages:(se=Se?.messages)!=null?se:Qe},supportedUrls:await e.supportedUrls}),yt=uu((st=Se?.model)!=null?st:e),{toolChoice:Ft,tools:qt}=uy({tools:u,toolChoice:(Qt=Se?.toolChoice)!=null?Qt:p,activeTools:(er=Se?.activeTools)!=null?er:v}),{result:{stream:tr,response:rr,request:$t},doStreamSpan:et,startTimestampMs:He}=await Xt(()=>fa({name:"ai.streamText.doStream",attributes:Ht({telemetry:t,attributes:{...da({operationId:"ai.streamText.doStream",telemetry:t}),...Kt,"ai.model.provider":yt.provider,"ai.model.id":yt.modelId,"ai.prompt.messages":{input:()=>Ey(ut)},"ai.prompt.tools":{input:()=>qt?.map(P=>JSON.stringify(P))},"ai.prompt.toolChoice":{input:()=>Ft!=null?JSON.stringify(Ft):void 0},"gen_ai.system":yt.provider,"gen_ai.request.model":yt.modelId,"gen_ai.request.frequency_penalty":Fe.frequencyPenalty,"gen_ai.request.max_tokens":Fe.maxOutputTokens,"gen_ai.request.presence_penalty":Fe.presencePenalty,"gen_ai.request.stop_sequences":Fe.stopSequences,"gen_ai.request.temperature":Fe.temperature,"gen_ai.request.top_k":Fe.topK,"gen_ai.request.top_p":Fe.topP}}),tracer:jt,endWhenDone:!1,fn:async P=>({startTimestampMs:x(),doStreamSpan:P,result:await yt.doStream({...Fe,tools:qt,toolChoice:Ft,responseFormat:m?.responseFormat,prompt:ut,providerOptions:y,abortSignal:o,headers:r,includeRawChunks:Zr})})})),_t=Yy({tools:u,generatorStream:tr,tracer:jt,telemetry:t,system:s,messages:Qe,repairToolCall:c,abortSignal:o,experimental_context:Q}),nr=$t??{},bt=[],ar=[];let wt;const kt={};let xt="unknown",Ie={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},or,Lr=!0,W={id:C(),timestamp:g(),modelId:e.modelId},ct="";Ge.addStream(_t.pipeThrough(new TransformStream({async transform(P,_e){var pt,Tt,Ot,tt;if(P.type==="stream-start"){wt=P.warnings;return}if(Lr){const de=x()-He;Lr=!1,et.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":de}),et.setAttributes({"ai.response.msToFirstChunk":de}),_e.enqueue({type:"start-step",request:nr,warnings:wt??[]})}const qe=P.type;switch(qe){case"text-start":case"text-end":{_e.enqueue(P);break}case"text-delta":{P.delta.length>0&&(_e.enqueue({type:"text-delta",id:P.id,text:P.delta,providerMetadata:P.providerMetadata}),ct+=P.delta);break}case"reasoning-start":case"reasoning-end":{_e.enqueue(P);break}case"reasoning-delta":{_e.enqueue({type:"reasoning-delta",id:P.id,text:P.delta,providerMetadata:P.providerMetadata});break}case"tool-call":{_e.enqueue(P),bt.push(P);break}case"tool-result":{_e.enqueue(P),ar.push(P);break}case"tool-error":{_e.enqueue(P),ar.push(P);break}case"response-metadata":{W={id:(pt=P.id)!=null?pt:W.id,timestamp:(Tt=P.timestamp)!=null?Tt:W.timestamp,modelId:(Ot=P.modelId)!=null?Ot:W.modelId};break}case"finish":{Ie=P.usage,xt=P.finishReason,or=P.providerMetadata;const de=x()-He;et.addEvent("ai.stream.finish"),et.setAttributes({"ai.response.msToFinish":de,"ai.response.avgOutputTokensPerSecond":1e3*((tt=Ie.outputTokens)!=null?tt:0)/de});break}case"file":{_e.enqueue(P);break}case"source":{_e.enqueue(P);break}case"tool-input-start":{kt[P.id]=P.toolName;const de=u?.[P.toolName];de?.onInputStart!=null&&await de.onInputStart({toolCallId:P.id,messages:Qe,abortSignal:o,experimental_context:Q}),_e.enqueue({...P,dynamic:de?.type==="dynamic"});break}case"tool-input-end":{delete kt[P.id],_e.enqueue(P);break}case"tool-input-delta":{const de=kt[P.id],Bt=u?.[de];Bt?.onInputDelta!=null&&await Bt.onInputDelta({inputTextDelta:P.delta,toolCallId:P.id,messages:Qe,abortSignal:o,experimental_context:Q}),_e.enqueue(P);break}case"error":{_e.enqueue(P),xt="error";break}case"raw":{Zr&&_e.enqueue(P);break}default:{const de=qe;throw new Error(`Unknown chunk type: ${de}`)}}},async flush(P){const _e=bt.length>0?JSON.stringify(bt):void 0;try{et.setAttributes(Ht({telemetry:t,attributes:{"ai.response.finishReason":xt,"ai.response.text":{output:()=>ct},"ai.response.toolCalls":{output:()=>_e},"ai.response.id":W.id,"ai.response.model":W.modelId,"ai.response.timestamp":W.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(or),"ai.usage.inputTokens":Ie.inputTokens,"ai.usage.outputTokens":Ie.outputTokens,"ai.usage.totalTokens":Ie.totalTokens,"ai.usage.reasoningTokens":Ie.reasoningTokens,"ai.usage.cachedInputTokens":Ie.cachedInputTokens,"gen_ai.response.finish_reasons":[xt],"gen_ai.response.id":W.id,"gen_ai.response.model":W.modelId,"gen_ai.usage.input_tokens":Ie.inputTokens,"gen_ai.usage.output_tokens":Ie.outputTokens}}))}catch{}finally{et.end()}P.enqueue({type:"finish-step",finishReason:xt,usage:Ie,providerMetadata:or,response:{...W,headers:rr?.headers}});const pt=Sy(Ke,Ie);await K.promise;const Tt=bt.filter(tt=>tt.providerExecuted!==!0),Ot=ar.filter(tt=>tt.providerExecuted!==!0);if(Tt.length>0&&Ot.length===Tt.length&&!await My({stopConditions:d,steps:z})){q.push(...os({content:z[z.length-1].content,tools:u}));try{await ne({currentStep:ye+1,responseMessages:q,usage:pt})}catch(tt){P.enqueue({type:"error",error:tt}),Ge.closeStream()}}else P.enqueue({type:"finish",finishReason:xt,totalUsage:pt}),Ge.closeStream()}})))}await ne({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(pe=>{Ge.addStream(new ReadableStream({start(ne){ne.enqueue({type:"error",error:pe}),ne.close()}})),Ge.closeStream()})}get steps(){return this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this._totalUsage.promise}get finishReason(){return this._finishReason.promise}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Vr(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.text)}})))}get fullStream(){return Vr(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await Gy({stream:this.fullStream,onError:e?.onError})}catch(r){(t=e?.onError)==null||t.call(e,r)}}get experimental_partialOutputStream(){if(this.output==null)throw new Dv;return Vr(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a=!0,sendSources:o=!1,sendStart:s=!0,sendFinish:i=!0,onError:l=Yt}={}){const u=t!=null?Ly({originalMessages:e,responseMessageId:t}):void 0,p={},f=c=>{var d,m;const y=p[c];return((m=(d=this.tools)==null?void 0:d[y])==null?void 0:m.type)==="dynamic"?!0:void 0},v=this.fullStream.pipeThrough(new TransformStream({transform:async(c,d)=>{const m=n?.({part:c}),y=c.type;switch(y){case"text-start":{d.enqueue({type:"text-start",id:c.id,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}});break}case"text-delta":{d.enqueue({type:"text-delta",id:c.id,delta:c.text,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}});break}case"text-end":{d.enqueue({type:"text-end",id:c.id,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}});break}case"reasoning-start":{d.enqueue({type:"reasoning-start",id:c.id,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}});break}case"reasoning-delta":{a&&d.enqueue({type:"reasoning-delta",id:c.id,delta:c.text,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}});break}case"reasoning-end":{d.enqueue({type:"reasoning-end",id:c.id,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}});break}case"file":{d.enqueue({type:"file",mediaType:c.file.mediaType,url:`data:${c.file.mediaType};base64,${c.file.base64}`});break}case"source":{o&&c.sourceType==="url"&&d.enqueue({type:"source-url",sourceId:c.id,url:c.url,title:c.title,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}}),o&&c.sourceType==="document"&&d.enqueue({type:"source-document",sourceId:c.id,mediaType:c.mediaType,title:c.title,filename:c.filename,...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{}});break}case"tool-input-start":{p[c.id]=c.toolName;const b=f(c.id);d.enqueue({type:"tool-input-start",toolCallId:c.id,toolName:c.toolName,...c.providerExecuted!=null?{providerExecuted:c.providerExecuted}:{},...b!=null?{dynamic:b}:{}});break}case"tool-input-delta":{d.enqueue({type:"tool-input-delta",toolCallId:c.id,inputTextDelta:c.delta});break}case"tool-call":{p[c.toolCallId]=c.toolName;const b=f(c.toolCallId);c.invalid?d.enqueue({type:"tool-input-error",toolCallId:c.toolCallId,toolName:c.toolName,input:c.input,...c.providerExecuted!=null?{providerExecuted:c.providerExecuted}:{},...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{},...b!=null?{dynamic:b}:{},errorText:l(c.error)}):d.enqueue({type:"tool-input-available",toolCallId:c.toolCallId,toolName:c.toolName,input:c.input,...c.providerExecuted!=null?{providerExecuted:c.providerExecuted}:{},...c.providerMetadata!=null?{providerMetadata:c.providerMetadata}:{},...b!=null?{dynamic:b}:{}});break}case"tool-result":{const b=f(c.toolCallId);d.enqueue({type:"tool-output-available",toolCallId:c.toolCallId,output:c.output,...c.providerExecuted!=null?{providerExecuted:c.providerExecuted}:{},...b!=null?{dynamic:b}:{}});break}case"tool-error":{const b=f(c.toolCallId);d.enqueue({type:"tool-output-error",toolCallId:c.toolCallId,errorText:l(c.error),...c.providerExecuted!=null?{providerExecuted:c.providerExecuted}:{},...b!=null?{dynamic:b}:{}});break}case"error":{d.enqueue({type:"error",errorText:l(c.error)});break}case"start-step":{d.enqueue({type:"start-step"});break}case"finish-step":{d.enqueue({type:"finish-step"});break}case"start":{s&&d.enqueue({type:"start",...m!=null?{messageMetadata:m}:{},...u!=null?{messageId:u}:{}});break}case"finish":{i&&d.enqueue({type:"finish",...m!=null?{messageMetadata:m}:{}});break}case"abort":{d.enqueue(c);break}case"tool-input-end":break;case"raw":break;default:{const b=y;throw new Error(`Unknown chunk type: ${b}`)}}m!=null&&y!=="start"&&y!=="finish"&&d.enqueue({type:"message-metadata",messageMetadata:m})}}));return Vr(By({stream:v,messageId:u??t?.(),originalMessages:e,onFinish:r,onError:l}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:r,onFinish:n,messageMetadata:a,sendReasoning:o,sendSources:s,sendFinish:i,sendStart:l,onError:u,...p}={}){Vy({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:r,onFinish:n,messageMetadata:a,sendReasoning:o,sendSources:s,sendFinish:i,sendStart:l,onError:u}),...p})}pipeTextStreamToResponse(e,t){Dy({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:i,onError:l,...u}={}){return Zy({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:i,onError:l}),...u})}toTextStreamResponse(e){return zy({textStream:this.textStream,...e})}};Mr({prefix:"aiobj",size:24});Mr({prefix:"aiobj",size:24});var t_={};Mv(t_,{object:()=>n_,text:()=>r_});var r_=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:e}){return{partial:e}},async parseOutput({text:e}){return e}}),n_=({schema:e})=>{const t=En(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:r}){const n=await wu(r);switch(n.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:n.value};default:{const a=n.state;throw new Error(`Unsupported parse state: ${a}`)}}},async parseOutput({text:r},n){const a=await Wt({text:r});if(!a.success)throw new es({message:"No object generated: could not parse the response.",cause:a.error,text:r,response:n.response,usage:n.usage,finishReason:n.finishReason});const o=await zr({value:a.value,schema:t});if(!o.success)throw new es({message:"No object generated: response did not match schema.",cause:o.error,text:r,response:n.response,usage:n.usage,finishReason:n.finishReason});return o.value}}},a_=Gt({name:_(),version:_()}),za=Gt({_meta:be(E({}).loose())}),$r=za,o_=E({method:_(),params:be(za)}),s_=Gt({experimental:be(E({}).loose()),logging:be(E({}).loose()),prompts:be(Gt({listChanged:be(Te())})),resources:be(Gt({subscribe:be(Te()),listChanged:be(Te())})),tools:be(Gt({listChanged:be(Te())}))});$r.extend({protocolVersion:_(),capabilities:s_,serverInfo:a_,instructions:be(_())});var i_=$r.extend({nextCursor:be(_())}),l_=E({name:_(),description:be(_()),inputSchema:E({type:I("object"),properties:be(E({}).loose())}).loose()}).loose();i_.extend({tools:ee(l_)});var u_=E({type:I("text"),text:_()}).loose(),c_=E({type:I("image"),data:Hs(),mimeType:_()}).loose(),ku=E({uri:_(),mimeType:be(_())}).loose(),p_=ku.extend({text:_()}),d_=ku.extend({blob:Hs()}),f_=E({type:I("resource"),resource:re([p_,d_])}).loose();$r.extend({content:ee(re([u_,c_,f_])),isError:Te().default(!1).optional()}).or($r.extend({toolResult:$e()}));var An="2.0",h_=E({jsonrpc:I(An),id:re([_(),L().int()])}).merge(o_).strict(),m_=E({jsonrpc:I(An),id:re([_(),L().int()]),result:$r}).strict(),g_=E({jsonrpc:I(An),id:re([_(),L().int()]),error:E({code:L().int(),message:_(),data:be($e())})}).strict(),v_=E({jsonrpc:I(An)}).merge(E({method:_(),params:be(za)})).strict();re([h_,v_,m_,g_]);/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:xu,setPrototypeOf:ls,isFrozen:y_,getPrototypeOf:__,getOwnPropertyDescriptor:b_}=Object;let{freeze:Me,seal:Je,create:Tu}=Object,{apply:ha,construct:ma}=typeof Reflect<"u"&&Reflect;Me||(Me=function(t){return t});Je||(Je=function(t){return t});ha||(ha=function(t,r,n){return t.apply(r,n)});ma||(ma=function(t,r){return new t(...r)});const Hr=ze(Array.prototype.forEach),w_=ze(Array.prototype.lastIndexOf),us=ze(Array.prototype.pop),cr=ze(Array.prototype.push),k_=ze(Array.prototype.splice),Qr=ze(String.prototype.toLowerCase),Jn=ze(String.prototype.toString),cs=ze(String.prototype.match),pr=ze(String.prototype.replace),x_=ze(String.prototype.indexOf),T_=ze(String.prototype.trim),ot=ze(Object.prototype.hasOwnProperty),Ne=ze(RegExp.prototype.test),dr=E_(TypeError);function ze(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return ha(e,t,n)}}function E_(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return ma(e,r)}}function Z(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Qr;ls&&ls(e,null);let n=t.length;for(;n--;){let a=t[n];if(typeof a=="string"){const o=r(a);o!==a&&(y_(t)||(t[n]=o),a=o)}e[a]=!0}return e}function S_(e){for(let t=0;t<e.length;t++)ot(e,t)||(e[t]=null);return e}function ht(e){const t=Tu(null);for(const[r,n]of xu(e))ot(e,r)&&(Array.isArray(n)?t[r]=S_(n):n&&typeof n=="object"&&n.constructor===Object?t[r]=ht(n):t[r]=n);return t}function fr(e,t){for(;e!==null;){const n=b_(e,t);if(n){if(n.get)return ze(n.get);if(typeof n.value=="function")return ze(n.value)}e=__(e)}function r(){return null}return r}const ps=Me(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Wn=Me(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Yn=Me(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),I_=Me(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Xn=Me(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),A_=Me(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ds=Me(["#text"]),fs=Me(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Kn=Me(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),hs=Me(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Jr=Me(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),R_=Je(/\{\{[\w\W]*|[\w\W]*\}\}/gm),$_=Je(/<%[\w\W]*|[\w\W]*%>/gm),O_=Je(/\$\{[\w\W]*/gm),N_=Je(/^data-[\-\w.\u00B7-\uFFFF]+$/),C_=Je(/^aria-[\-\w]+$/),Eu=Je(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),P_=Je(/^(?:\w+script|data):/i),M_=Je(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Su=Je(/^html$/i),z_=Je(/^[a-z][.\w]*(-[.\w]+)+$/i);var ms=Object.freeze({__proto__:null,ARIA_ATTR:C_,ATTR_WHITESPACE:M_,CUSTOM_ELEMENT:z_,DATA_ATTR:N_,DOCTYPE_NAME:Su,ERB_EXPR:$_,IS_ALLOWED_URI:Eu,IS_SCRIPT_OR_DATA:P_,MUSTACHE_EXPR:R_,TMPLIT_EXPR:O_});const hr={element:1,text:3,progressingInstruction:7,comment:8,document:9},D_=function(){return typeof window>"u"?null:window},Z_=function(t,r){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let n=null;const a="data-tt-policy-suffix";r&&r.hasAttribute(a)&&(n=r.getAttribute(a));const o="dompurify"+(n?"#"+n:"");try{return t.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},gs=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Iu(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D_();const t=N=>Iu(N);if(t.version="3.2.6",t.removed=[],!e||!e.document||e.document.nodeType!==hr.document||!e.Element)return t.isSupported=!1,t;let{document:r}=e;const n=r,a=n.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:i,Element:l,NodeFilter:u,NamedNodeMap:p=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:f,DOMParser:v,trustedTypes:c}=e,d=l.prototype,m=fr(d,"cloneNode"),y=fr(d,"remove"),b=fr(d,"nextSibling"),k=fr(d,"childNodes"),x=fr(d,"parentNode");if(typeof s=="function"){const N=r.createElement("template");N.content&&N.content.ownerDocument&&(r=N.content.ownerDocument)}let g,C="";const{implementation:M,createNodeIterator:O,createDocumentFragment:F,getElementsByTagName:ve}=r,{importNode:We}=n;let Q=gs();t.isSupported=typeof xu=="function"&&typeof x=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:K,ERB_EXPR:me,TMPLIT_EXPR:ge,DATA_ATTR:Ue,ARIA_ATTR:Ye,IS_SCRIPT_OR_DATA:V,ATTR_WHITESPACE:xe,CUSTOM_ELEMENT:z}=ms;let{IS_ALLOWED_URI:Xe}=ms,$=null;const De=Z({},[...ps,...Wn,...Yn,...Xn,...ds]);let U=null;const ce=Z({},[...fs,...Kn,...hs,...Jr]);let J=Object.seal(Tu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Rt=null,Xt=null,jt=!0,Fe=!0,Kt=!1,Ge=!0,pe=!1,ne=!0,ye=!1,q=!1,Ke=!1,S=!1,se=!1,st=!1,Qt=!0,er=!1;const Zr="user-content-";let Ut=!0,Qe=!1,Se={},ut=null;const yt=Z({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ft=null;const qt=Z({},["audio","video","img","source","image","track"]);let tr=null;const rr=Z({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),$t="http://www.w3.org/1998/Math/MathML",et="http://www.w3.org/2000/svg",He="http://www.w3.org/1999/xhtml";let _t=He,nr=!1,bt=null;const ar=Z({},[$t,et,He],Jn);let wt=Z({},["mi","mo","mn","ms","mtext"]),kt=Z({},["annotation-xml"]);const xt=Z({},["title","style","font","a","script"]);let Ie=null;const or=["application/xhtml+xml","text/html"],Lr="text/html";let W=null,ct=null;const P=r.createElement("form"),_e=function(h){return h instanceof RegExp||h instanceof Function},pt=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ct&&ct===h)){if((!h||typeof h!="object")&&(h={}),h=ht(h),Ie=or.indexOf(h.PARSER_MEDIA_TYPE)===-1?Lr:h.PARSER_MEDIA_TYPE,W=Ie==="application/xhtml+xml"?Jn:Qr,$=ot(h,"ALLOWED_TAGS")?Z({},h.ALLOWED_TAGS,W):De,U=ot(h,"ALLOWED_ATTR")?Z({},h.ALLOWED_ATTR,W):ce,bt=ot(h,"ALLOWED_NAMESPACES")?Z({},h.ALLOWED_NAMESPACES,Jn):ar,tr=ot(h,"ADD_URI_SAFE_ATTR")?Z(ht(rr),h.ADD_URI_SAFE_ATTR,W):rr,Ft=ot(h,"ADD_DATA_URI_TAGS")?Z(ht(qt),h.ADD_DATA_URI_TAGS,W):qt,ut=ot(h,"FORBID_CONTENTS")?Z({},h.FORBID_CONTENTS,W):yt,Rt=ot(h,"FORBID_TAGS")?Z({},h.FORBID_TAGS,W):ht({}),Xt=ot(h,"FORBID_ATTR")?Z({},h.FORBID_ATTR,W):ht({}),Se=ot(h,"USE_PROFILES")?h.USE_PROFILES:!1,jt=h.ALLOW_ARIA_ATTR!==!1,Fe=h.ALLOW_DATA_ATTR!==!1,Kt=h.ALLOW_UNKNOWN_PROTOCOLS||!1,Ge=h.ALLOW_SELF_CLOSE_IN_ATTR!==!1,pe=h.SAFE_FOR_TEMPLATES||!1,ne=h.SAFE_FOR_XML!==!1,ye=h.WHOLE_DOCUMENT||!1,S=h.RETURN_DOM||!1,se=h.RETURN_DOM_FRAGMENT||!1,st=h.RETURN_TRUSTED_TYPE||!1,Ke=h.FORCE_BODY||!1,Qt=h.SANITIZE_DOM!==!1,er=h.SANITIZE_NAMED_PROPS||!1,Ut=h.KEEP_CONTENT!==!1,Qe=h.IN_PLACE||!1,Xe=h.ALLOWED_URI_REGEXP||Eu,_t=h.NAMESPACE||He,wt=h.MATHML_TEXT_INTEGRATION_POINTS||wt,kt=h.HTML_INTEGRATION_POINTS||kt,J=h.CUSTOM_ELEMENT_HANDLING||{},h.CUSTOM_ELEMENT_HANDLING&&_e(h.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(J.tagNameCheck=h.CUSTOM_ELEMENT_HANDLING.tagNameCheck),h.CUSTOM_ELEMENT_HANDLING&&_e(h.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(J.attributeNameCheck=h.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),h.CUSTOM_ELEMENT_HANDLING&&typeof h.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(J.allowCustomizedBuiltInElements=h.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),pe&&(Fe=!1),se&&(S=!0),Se&&($=Z({},ds),U=[],Se.html===!0&&(Z($,ps),Z(U,fs)),Se.svg===!0&&(Z($,Wn),Z(U,Kn),Z(U,Jr)),Se.svgFilters===!0&&(Z($,Yn),Z(U,Kn),Z(U,Jr)),Se.mathMl===!0&&(Z($,Xn),Z(U,hs),Z(U,Jr))),h.ADD_TAGS&&($===De&&($=ht($)),Z($,h.ADD_TAGS,W)),h.ADD_ATTR&&(U===ce&&(U=ht(U)),Z(U,h.ADD_ATTR,W)),h.ADD_URI_SAFE_ATTR&&Z(tr,h.ADD_URI_SAFE_ATTR,W),h.FORBID_CONTENTS&&(ut===yt&&(ut=ht(ut)),Z(ut,h.FORBID_CONTENTS,W)),Ut&&($["#text"]=!0),ye&&Z($,["html","head","body"]),$.table&&(Z($,["tbody"]),delete Rt.tbody),h.TRUSTED_TYPES_POLICY){if(typeof h.TRUSTED_TYPES_POLICY.createHTML!="function")throw dr('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof h.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw dr('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');g=h.TRUSTED_TYPES_POLICY,C=g.createHTML("")}else g===void 0&&(g=Z_(c,a)),g!==null&&typeof C=="string"&&(C=g.createHTML(""));Me&&Me(h),ct=h}},Tt=Z({},[...Wn,...Yn,...I_]),Ot=Z({},[...Xn,...A_]),tt=function(h){let T=x(h);(!T||!T.tagName)&&(T={namespaceURI:_t,tagName:"template"});const R=Qr(h.tagName),ie=Qr(T.tagName);return bt[h.namespaceURI]?h.namespaceURI===et?T.namespaceURI===He?R==="svg":T.namespaceURI===$t?R==="svg"&&(ie==="annotation-xml"||wt[ie]):!!Tt[R]:h.namespaceURI===$t?T.namespaceURI===He?R==="math":T.namespaceURI===et?R==="math"&&kt[ie]:!!Ot[R]:h.namespaceURI===He?T.namespaceURI===et&&!kt[ie]||T.namespaceURI===$t&&!wt[ie]?!1:!Ot[R]&&(xt[R]||!Tt[R]):!!(Ie==="application/xhtml+xml"&&bt[h.namespaceURI]):!1},qe=function(h){cr(t.removed,{element:h});try{x(h).removeChild(h)}catch{y(h)}},de=function(h,T){try{cr(t.removed,{attribute:T.getAttributeNode(h),from:T})}catch{cr(t.removed,{attribute:null,from:T})}if(T.removeAttribute(h),h==="is")if(S||se)try{qe(T)}catch{}else try{T.setAttribute(h,"")}catch{}},Bt=function(h){let T=null,R=null;if(Ke)h="<remove></remove>"+h;else{const we=cs(h,/^[\r\n\t ]+/);R=we&&we[0]}Ie==="application/xhtml+xml"&&_t===He&&(h='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+h+"</body></html>");const ie=g?g.createHTML(h):h;if(_t===He)try{T=new v().parseFromString(ie,Ie)}catch{}if(!T||!T.documentElement){T=M.createDocument(_t,"template",null);try{T.documentElement.innerHTML=nr?C:ie}catch{}}const Ae=T.body||T.documentElement;return h&&R&&Ae.insertBefore(r.createTextNode(R),Ae.childNodes[0]||null),_t===He?ve.call(T,ye?"html":"body")[0]:ye?T.documentElement:Ae},Ga=function(h){return O.call(h.ownerDocument||h,h,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},On=function(h){return h instanceof f&&(typeof h.nodeName!="string"||typeof h.textContent!="string"||typeof h.removeChild!="function"||!(h.attributes instanceof p)||typeof h.removeAttribute!="function"||typeof h.setAttribute!="function"||typeof h.namespaceURI!="string"||typeof h.insertBefore!="function"||typeof h.hasChildNodes!="function")},Ha=function(h){return typeof i=="function"&&h instanceof i};function dt(N,h,T){Hr(N,R=>{R.call(t,h,T,ct)})}const Ja=function(h){let T=null;if(dt(Q.beforeSanitizeElements,h,null),On(h))return qe(h),!0;const R=W(h.nodeName);if(dt(Q.uponSanitizeElement,h,{tagName:R,allowedTags:$}),ne&&h.hasChildNodes()&&!Ha(h.firstElementChild)&&Ne(/<[/\w!]/g,h.innerHTML)&&Ne(/<[/\w!]/g,h.textContent)||h.nodeType===hr.progressingInstruction||ne&&h.nodeType===hr.comment&&Ne(/<[/\w]/g,h.data))return qe(h),!0;if(!$[R]||Rt[R]){if(!Rt[R]&&Ya(R)&&(J.tagNameCheck instanceof RegExp&&Ne(J.tagNameCheck,R)||J.tagNameCheck instanceof Function&&J.tagNameCheck(R)))return!1;if(Ut&&!ut[R]){const ie=x(h)||h.parentNode,Ae=k(h)||h.childNodes;if(Ae&&ie){const we=Ae.length;for(let Ze=we-1;Ze>=0;--Ze){const ft=m(Ae[Ze],!0);ft.__removalCount=(h.__removalCount||0)+1,ie.insertBefore(ft,b(h))}}}return qe(h),!0}return h instanceof l&&!tt(h)||(R==="noscript"||R==="noembed"||R==="noframes")&&Ne(/<\/no(script|embed|frames)/i,h.innerHTML)?(qe(h),!0):(pe&&h.nodeType===hr.text&&(T=h.textContent,Hr([K,me,ge],ie=>{T=pr(T,ie," ")}),h.textContent!==T&&(cr(t.removed,{element:h.cloneNode()}),h.textContent=T)),dt(Q.afterSanitizeElements,h,null),!1)},Wa=function(h,T,R){if(Qt&&(T==="id"||T==="name")&&(R in r||R in P))return!1;if(!(Fe&&!Xt[T]&&Ne(Ue,T))){if(!(jt&&Ne(Ye,T))){if(!U[T]||Xt[T]){if(!(Ya(h)&&(J.tagNameCheck instanceof RegExp&&Ne(J.tagNameCheck,h)||J.tagNameCheck instanceof Function&&J.tagNameCheck(h))&&(J.attributeNameCheck instanceof RegExp&&Ne(J.attributeNameCheck,T)||J.attributeNameCheck instanceof Function&&J.attributeNameCheck(T))||T==="is"&&J.allowCustomizedBuiltInElements&&(J.tagNameCheck instanceof RegExp&&Ne(J.tagNameCheck,R)||J.tagNameCheck instanceof Function&&J.tagNameCheck(R))))return!1}else if(!tr[T]){if(!Ne(Xe,pr(R,xe,""))){if(!((T==="src"||T==="xlink:href"||T==="href")&&h!=="script"&&x_(R,"data:")===0&&Ft[h])){if(!(Kt&&!Ne(V,pr(R,xe,"")))){if(R)return!1}}}}}}return!0},Ya=function(h){return h!=="annotation-xml"&&cs(h,z)},Xa=function(h){dt(Q.beforeSanitizeAttributes,h,null);const{attributes:T}=h;if(!T||On(h))return;const R={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let ie=T.length;for(;ie--;){const Ae=T[ie],{name:we,namespaceURI:Ze,value:ft}=Ae,sr=W(we),Nn=ft;let Re=we==="value"?Nn:T_(Nn);if(R.attrName=sr,R.attrValue=Re,R.keepAttr=!0,R.forceKeepAttr=void 0,dt(Q.uponSanitizeAttribute,h,R),Re=R.attrValue,er&&(sr==="id"||sr==="name")&&(de(we,h),Re=Zr+Re),ne&&Ne(/((--!?|])>)|<\/(style|title)/i,Re)){de(we,h);continue}if(R.forceKeepAttr)continue;if(!R.keepAttr){de(we,h);continue}if(!Ge&&Ne(/\/>/i,Re)){de(we,h);continue}pe&&Hr([K,me,ge],Qa=>{Re=pr(Re,Qa," ")});const Ka=W(h.nodeName);if(!Wa(Ka,sr,Re)){de(we,h);continue}if(g&&typeof c=="object"&&typeof c.getAttributeType=="function"&&!Ze)switch(c.getAttributeType(Ka,sr)){case"TrustedHTML":{Re=g.createHTML(Re);break}case"TrustedScriptURL":{Re=g.createScriptURL(Re);break}}if(Re!==Nn)try{Ze?h.setAttributeNS(Ze,we,Re):h.setAttribute(we,Re),On(h)?qe(h):us(t.removed)}catch{de(we,h)}}dt(Q.afterSanitizeAttributes,h,null)},Lu=function N(h){let T=null;const R=Ga(h);for(dt(Q.beforeSanitizeShadowDOM,h,null);T=R.nextNode();)dt(Q.uponSanitizeShadowNode,T,null),Ja(T),Xa(T),T.content instanceof o&&N(T.content);dt(Q.afterSanitizeShadowDOM,h,null)};return t.sanitize=function(N){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},T=null,R=null,ie=null,Ae=null;if(nr=!N,nr&&(N="<!-->"),typeof N!="string"&&!Ha(N))if(typeof N.toString=="function"){if(N=N.toString(),typeof N!="string")throw dr("dirty is not a string, aborting")}else throw dr("toString is not a function");if(!t.isSupported)return N;if(q||pt(h),t.removed=[],typeof N=="string"&&(Qe=!1),Qe){if(N.nodeName){const ft=W(N.nodeName);if(!$[ft]||Rt[ft])throw dr("root node is forbidden and cannot be sanitized in-place")}}else if(N instanceof i)T=Bt("<!---->"),R=T.ownerDocument.importNode(N,!0),R.nodeType===hr.element&&R.nodeName==="BODY"||R.nodeName==="HTML"?T=R:T.appendChild(R);else{if(!S&&!pe&&!ye&&N.indexOf("<")===-1)return g&&st?g.createHTML(N):N;if(T=Bt(N),!T)return S?null:st?C:""}T&&Ke&&qe(T.firstChild);const we=Ga(Qe?N:T);for(;ie=we.nextNode();)Ja(ie),Xa(ie),ie.content instanceof o&&Lu(ie.content);if(Qe)return N;if(S){if(se)for(Ae=F.call(T.ownerDocument);T.firstChild;)Ae.appendChild(T.firstChild);else Ae=T;return(U.shadowroot||U.shadowrootmode)&&(Ae=We.call(n,Ae,!0)),Ae}let Ze=ye?T.outerHTML:T.innerHTML;return ye&&$["!doctype"]&&T.ownerDocument&&T.ownerDocument.doctype&&T.ownerDocument.doctype.name&&Ne(Su,T.ownerDocument.doctype.name)&&(Ze="<!DOCTYPE "+T.ownerDocument.doctype.name+`>
`+Ze),pe&&Hr([K,me,ge],ft=>{Ze=pr(Ze,ft," ")}),g&&st?g.createHTML(Ze):Ze},t.setConfig=function(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};pt(N),q=!0},t.clearConfig=function(){ct=null,q=!1},t.isValidAttribute=function(N,h,T){ct||pt({});const R=W(N),ie=W(h);return Wa(R,ie,T)},t.addHook=function(N,h){typeof h=="function"&&cr(Q[N],h)},t.removeHook=function(N,h){if(h!==void 0){const T=w_(Q[N],h);return T===-1?void 0:k_(Q[N],T,1)[0]}return us(Q[N])},t.removeHooks=function(N){Q[N]=[]},t.removeAllHooks=function(){Q=gs()},t}var L_=Iu();function Da(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Lt=Da();function Au(e){Lt=e}var br={exec:()=>null};function H(e,t=""){let r=typeof e=="string"?e:e.source,n={replace:(a,o)=>{let s=typeof o=="string"?o:o.source;return s=s.replace(Pe.caret,"$1"),r=r.replace(a,s),n},getRegex:()=>new RegExp(r,t)};return n}var Pe={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},j_=/^(?:[ \t]*(?:\n|$))+/,U_=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,F_=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Dr=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,q_=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Za=/(?:[*+-]|\d{1,9}[.)])/,Ru=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,$u=H(Ru).replace(/bull/g,Za).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),B_=H(Ru).replace(/bull/g,Za).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),La=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,V_=/^[^\n]+/,ja=/(?!\s*\])(?:\\.|[^\[\]\\])+/,G_=H(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ja).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),H_=H(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Za).getRegex(),Rn="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ua=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,J_=H("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ua).replace("tag",Rn).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ou=H(La).replace("hr",Dr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Rn).getRegex(),W_=H(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ou).getRegex(),Fa={blockquote:W_,code:U_,def:G_,fences:F_,heading:q_,hr:Dr,html:J_,lheading:$u,list:H_,newline:j_,paragraph:Ou,table:br,text:V_},vs=H("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Dr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Rn).getRegex(),Y_={...Fa,lheading:B_,table:vs,paragraph:H(La).replace("hr",Dr).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",vs).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Rn).getRegex()},X_={...Fa,html:H(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ua).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:br,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:H(La).replace("hr",Dr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",$u).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},K_=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Q_=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Nu=/^( {2,}|\\)\n(?!\s*$)/,eb=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,$n=/[\p{P}\p{S}]/u,qa=/[\s\p{P}\p{S}]/u,Cu=/[^\s\p{P}\p{S}]/u,tb=H(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,qa).getRegex(),Pu=/(?!~)[\p{P}\p{S}]/u,rb=/(?!~)[\s\p{P}\p{S}]/u,nb=/(?:[^\s\p{P}\p{S}]|~)/u,ab=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,Mu=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,ob=H(Mu,"u").replace(/punct/g,$n).getRegex(),sb=H(Mu,"u").replace(/punct/g,Pu).getRegex(),zu="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ib=H(zu,"gu").replace(/notPunctSpace/g,Cu).replace(/punctSpace/g,qa).replace(/punct/g,$n).getRegex(),lb=H(zu,"gu").replace(/notPunctSpace/g,nb).replace(/punctSpace/g,rb).replace(/punct/g,Pu).getRegex(),ub=H("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Cu).replace(/punctSpace/g,qa).replace(/punct/g,$n).getRegex(),cb=H(/\\(punct)/,"gu").replace(/punct/g,$n).getRegex(),pb=H(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),db=H(Ua).replace("(?:-->|$)","-->").getRegex(),fb=H("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",db).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),_n=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,hb=H(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",_n).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Du=H(/^!?\[(label)\]\[(ref)\]/).replace("label",_n).replace("ref",ja).getRegex(),Zu=H(/^!?\[(ref)\](?:\[\])?/).replace("ref",ja).getRegex(),mb=H("reflink|nolink(?!\\()","g").replace("reflink",Du).replace("nolink",Zu).getRegex(),Ba={_backpedal:br,anyPunctuation:cb,autolink:pb,blockSkip:ab,br:Nu,code:Q_,del:br,emStrongLDelim:ob,emStrongRDelimAst:ib,emStrongRDelimUnd:ub,escape:K_,link:hb,nolink:Zu,punctuation:tb,reflink:Du,reflinkSearch:mb,tag:fb,text:eb,url:br},gb={...Ba,link:H(/^!?\[(label)\]\((.*?)\)/).replace("label",_n).getRegex(),reflink:H(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_n).getRegex()},ga={...Ba,emStrongRDelimAst:lb,emStrongLDelim:sb,url:H(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},vb={...ga,br:H(Nu).replace("{2,}","*").getRegex(),text:H(ga.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Wr={normal:Fa,gfm:Y_,pedantic:X_},mr={normal:Ba,gfm:ga,breaks:vb,pedantic:gb},yb={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ys=e=>yb[e];function it(e,t){if(t){if(Pe.escapeTest.test(e))return e.replace(Pe.escapeReplace,ys)}else if(Pe.escapeTestNoEncode.test(e))return e.replace(Pe.escapeReplaceNoEncode,ys);return e}function _s(e){try{e=encodeURI(e).replace(Pe.percentDecode,"%")}catch{return null}return e}function bs(e,t){let r=e.replace(Pe.findPipe,(o,s,i)=>{let l=!1,u=s;for(;--u>=0&&i[u]==="\\";)l=!l;return l?"|":" |"}),n=r.split(Pe.splitPipe),a=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;a<n.length;a++)n[a]=n[a].trim().replace(Pe.slashPipe,"|");return n}function gr(e,t,r){let n=e.length;if(n===0)return"";let a=0;for(;a<n&&e.charAt(n-a-1)===t;)a++;return e.slice(0,n-a)}function _b(e,t){if(e.indexOf(t[1])===-1)return-1;let r=0;for(let n=0;n<e.length;n++)if(e[n]==="\\")n++;else if(e[n]===t[0])r++;else if(e[n]===t[1]&&(r--,r<0))return n;return r>0?-2:-1}function ws(e,t,r,n,a){let o=t.href,s=t.title||null,i=e[1].replace(a.other.outputLinkReplace,"$1");n.state.inLink=!0;let l={type:e[0].charAt(0)==="!"?"image":"link",raw:r,href:o,title:s,text:i,tokens:n.inlineTokens(i)};return n.state.inLink=!1,l}function bb(e,t,r){let n=e.match(r.other.indentCodeCompensation);if(n===null)return t;let a=n[1];return t.split(`
`).map(o=>{let s=o.match(r.other.beginningSpace);if(s===null)return o;let[i]=s;return i.length>=a.length?o.slice(a.length):o}).join(`
`)}var bn=class{options;rules;lexer;constructor(e){this.options=e||Lt}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:gr(r,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let r=t[0],n=bb(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let n=gr(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:gr(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let r=gr(t[0],`
`).split(`
`),n="",a="",o=[];for(;r.length>0;){let s=!1,i=[],l;for(l=0;l<r.length;l++)if(this.rules.other.blockquoteStart.test(r[l]))i.push(r[l]),s=!0;else if(!s)i.push(r[l]);else break;r=r.slice(l);let u=i.join(`
`),p=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${u}`:u,a=a?`${a}
${p}`:p;let f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,o,!0),this.lexer.state.top=f,r.length===0)break;let v=o.at(-1);if(v?.type==="code")break;if(v?.type==="blockquote"){let c=v,d=c.raw+`
`+r.join(`
`),m=this.blockquote(d);o[o.length-1]=m,n=n.substring(0,n.length-c.raw.length)+m.raw,a=a.substring(0,a.length-c.text.length)+m.text;break}else if(v?.type==="list"){let c=v,d=c.raw+`
`+r.join(`
`),m=this.list(d);o[o.length-1]=m,n=n.substring(0,n.length-v.raw.length)+m.raw,a=a.substring(0,a.length-c.raw.length)+m.raw,r=d.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:o,text:a}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),n=r.length>1,a={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let o=this.rules.other.listItemRegex(r),s=!1;for(;e;){let l=!1,u="",p="";if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let f=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,b=>" ".repeat(3*b.length)),v=e.split(`
`,1)[0],c=!f.trim(),d=0;if(this.options.pedantic?(d=2,p=f.trimStart()):c?d=t[1].length+1:(d=t[2].search(this.rules.other.nonSpaceChar),d=d>4?1:d,p=f.slice(d),d+=t[1].length),c&&this.rules.other.blankLine.test(v)&&(u+=v+`
`,e=e.substring(v.length+1),l=!0),!l){let b=this.rules.other.nextBulletRegex(d),k=this.rules.other.hrRegex(d),x=this.rules.other.fencesBeginRegex(d),g=this.rules.other.headingBeginRegex(d),C=this.rules.other.htmlBeginRegex(d);for(;e;){let M=e.split(`
`,1)[0],O;if(v=M,this.options.pedantic?(v=v.replace(this.rules.other.listReplaceNesting,"  "),O=v):O=v.replace(this.rules.other.tabCharGlobal,"    "),x.test(v)||g.test(v)||C.test(v)||b.test(v)||k.test(v))break;if(O.search(this.rules.other.nonSpaceChar)>=d||!v.trim())p+=`
`+O.slice(d);else{if(c||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||x.test(f)||g.test(f)||k.test(f))break;p+=`
`+v}!c&&!v.trim()&&(c=!0),u+=M+`
`,e=e.substring(M.length+1),f=O.slice(d)}}a.loose||(s?a.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(s=!0));let m=null,y;this.options.gfm&&(m=this.rules.other.listIsTask.exec(p),m&&(y=m[0]!=="[ ] ",p=p.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:u,task:!!m,checked:y,loose:!1,text:p,tokens:[]}),a.raw+=u}let i=a.items.at(-1);if(i)i.raw=i.raw.trimEnd(),i.text=i.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let l=0;l<a.items.length;l++)if(this.lexer.state.top=!1,a.items[l].tokens=this.lexer.blockTokens(a.items[l].text,[]),!a.loose){let u=a.items[l].tokens.filter(f=>f.type==="space"),p=u.length>0&&u.some(f=>this.rules.other.anyLine.test(f.raw));a.loose=p}if(a.loose)for(let l=0;l<a.items.length;l++)a.items[l].loose=!0;return a}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:n,title:a}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=bs(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let s of n)this.rules.other.tableAlignRight.test(s)?o.align.push("right"):this.rules.other.tableAlignCenter.test(s)?o.align.push("center"):this.rules.other.tableAlignLeft.test(s)?o.align.push("left"):o.align.push(null);for(let s=0;s<r.length;s++)o.header.push({text:r[s],tokens:this.lexer.inline(r[s]),header:!0,align:o.align[s]});for(let s of a)o.rows.push(bs(s,o.header.length).map((i,l)=>({text:i,tokens:this.lexer.inline(i),header:!1,align:o.align[l]})));return o}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let o=gr(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{let o=_b(t[2],"()");if(o===-2)return;if(o>-1){let s=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,s).trim(),t[3]=""}}let n=t[2],a="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(n);o&&(n=o[1],a=o[3])}else a=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),ws(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=t[n.toLowerCase()];if(!a){let o=r[0].charAt(0);return{type:"text",raw:o,text:o}}return ws(r,a,r[0],this.lexer,this.rules)}}emStrong(e,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(e);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let a=[...n[0]].length-1,o,s,i=a,l=0,u=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,t=t.slice(-1*e.length+a);(n=u.exec(t))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(s=[...o].length,n[3]||n[4]){i+=s;continue}else if((n[5]||n[6])&&a%3&&!((a+s)%3)){l+=s;continue}if(i-=s,i>0)continue;s=Math.min(s,s+i+l);let p=[...n[0]][0].length,f=e.slice(0,a+n.index+p+s);if(Math.min(a,s)%2){let c=f.slice(1,-1);return{type:"em",raw:f,text:c,tokens:this.lexer.inlineTokens(c)}}let v=f.slice(2,-2);return{type:"strong",raw:f,text:v,tokens:this.lexer.inlineTokens(v)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),a=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&a&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let r,n;return t[2]==="@"?(r=t[1],n="mailto:"+r):(r=t[1],n=r),{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let r,n;if(t[2]==="@")r=t[0],n="mailto:"+r;else{let a;do a=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(a!==t[0]);r=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},gt=class va{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Lt,this.options.tokenizer=this.options.tokenizer||new bn,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:Pe,block:Wr.normal,inline:mr.normal};this.options.pedantic?(r.block=Wr.pedantic,r.inline=mr.pedantic):this.options.gfm&&(r.block=Wr.gfm,this.options.breaks?r.inline=mr.breaks:r.inline=mr.gfm),this.tokenizer.rules=r}static get rules(){return{block:Wr,inline:mr}}static lex(t,r){return new va(r).lex(t)}static lexInline(t,r){return new va(r).inlineTokens(t)}lex(t){t=t.replace(Pe.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[],n=!1){for(this.options.pedantic&&(t=t.replace(Pe.tabCharGlobal,"    ").replace(Pe.spaceLine,""));t;){let a;if(this.options.extensions?.block?.some(s=>(a=s.call({lexer:this},t,r))?(t=t.substring(a.raw.length),r.push(a),!0):!1))continue;if(a=this.tokenizer.space(t)){t=t.substring(a.raw.length);let s=r.at(-1);a.raw.length===1&&s!==void 0?s.raw+=`
`:r.push(a);continue}if(a=this.tokenizer.code(t)){t=t.substring(a.raw.length);let s=r.at(-1);s?.type==="paragraph"||s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+a.raw,s.text+=`
`+a.text,this.inlineQueue.at(-1).src=s.text):r.push(a);continue}if(a=this.tokenizer.fences(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.heading(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.hr(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.blockquote(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.list(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.html(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.def(t)){t=t.substring(a.raw.length);let s=r.at(-1);s?.type==="paragraph"||s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+a.raw,s.text+=`
`+a.raw,this.inlineQueue.at(-1).src=s.text):this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title});continue}if(a=this.tokenizer.table(t)){t=t.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.lheading(t)){t=t.substring(a.raw.length),r.push(a);continue}let o=t;if(this.options.extensions?.startBlock){let s=1/0,i=t.slice(1),l;this.options.extensions.startBlock.forEach(u=>{l=u.call({lexer:this},i),typeof l=="number"&&l>=0&&(s=Math.min(s,l))}),s<1/0&&s>=0&&(o=t.substring(0,s+1))}if(this.state.top&&(a=this.tokenizer.paragraph(o))){let s=r.at(-1);n&&s?.type==="paragraph"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+a.raw,s.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):r.push(a),n=o.length!==t.length,t=t.substring(a.raw.length);continue}if(a=this.tokenizer.text(t)){t=t.substring(a.raw.length);let s=r.at(-1);s?.type==="text"?(s.raw+=(s.raw.endsWith(`
`)?"":`
`)+a.raw,s.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=s.text):r.push(a);continue}if(t){let s="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(s);break}else throw new Error(s)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let n=t,a=null;if(this.tokens.links){let i=Object.keys(this.tokens.links);if(i.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)i.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,a.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let o=!1,s="";for(;t;){o||(s=""),o=!1;let i;if(this.options.extensions?.inline?.some(u=>(i=u.call({lexer:this},t,r))?(t=t.substring(i.raw.length),r.push(i),!0):!1))continue;if(i=this.tokenizer.escape(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.tag(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.link(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(i.raw.length);let u=r.at(-1);i.type==="text"&&u?.type==="text"?(u.raw+=i.raw,u.text+=i.text):r.push(i);continue}if(i=this.tokenizer.emStrong(t,n,s)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.codespan(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.br(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.del(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.autolink(t)){t=t.substring(i.raw.length),r.push(i);continue}if(!this.state.inLink&&(i=this.tokenizer.url(t))){t=t.substring(i.raw.length),r.push(i);continue}let l=t;if(this.options.extensions?.startInline){let u=1/0,p=t.slice(1),f;this.options.extensions.startInline.forEach(v=>{f=v.call({lexer:this},p),typeof f=="number"&&f>=0&&(u=Math.min(u,f))}),u<1/0&&u>=0&&(l=t.substring(0,u+1))}if(i=this.tokenizer.inlineText(l)){t=t.substring(i.raw.length),i.raw.slice(-1)!=="_"&&(s=i.raw.slice(-1)),o=!0;let u=r.at(-1);u?.type==="text"?(u.raw+=i.raw,u.text+=i.text):r.push(i);continue}if(t){let u="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return r}},wn=class{options;parser;constructor(e){this.options=e||Lt}space(e){return""}code({text:e,lang:t,escaped:r}){let n=(t||"").match(Pe.notSpaceStart)?.[0],a=e.replace(Pe.endingNewline,"")+`
`;return n?'<pre><code class="language-'+it(n)+'">'+(r?a:it(a,!0))+`</code></pre>
`:"<pre><code>"+(r?a:it(a,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,r=e.start,n="";for(let s=0;s<e.items.length;s++){let i=e.items[s];n+=this.listitem(i)}let a=t?"ol":"ul",o=t&&r!==1?' start="'+r+'"':"";return"<"+a+o+`>
`+n+"</"+a+`>
`}listitem(e){let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+it(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",r="";for(let a=0;a<e.header.length;a++)r+=this.tablecell(e.header[a]);t+=this.tablerow({text:r});let n="";for(let a=0;a<e.rows.length;a++){let o=e.rows[a];r="";for(let s=0;s<o.length;s++)r+=this.tablecell(o[s]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${it(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){let n=this.parser.parseInline(r),a=_s(e);if(a===null)return n;e=a;let o='<a href="'+e+'"';return t&&(o+=' title="'+it(t)+'"'),o+=">"+n+"</a>",o}image({href:e,title:t,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let a=_s(e);if(a===null)return it(r);e=a;let o=`<img src="${e}" alt="${r}"`;return t&&(o+=` title="${it(t)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:it(e.text)}},Va=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},vt=class ya{options;renderer;textRenderer;constructor(t){this.options=t||Lt,this.options.renderer=this.options.renderer||new wn,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Va}static parse(t,r){return new ya(r).parse(t)}static parseInline(t,r){return new ya(r).parseInline(t)}parse(t,r=!0){let n="";for(let a=0;a<t.length;a++){let o=t[a];if(this.options.extensions?.renderers?.[o.type]){let i=o,l=this.options.extensions.renderers[i.type].call({parser:this},i);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(i.type)){n+=l||"";continue}}let s=o;switch(s.type){case"space":{n+=this.renderer.space(s);continue}case"hr":{n+=this.renderer.hr(s);continue}case"heading":{n+=this.renderer.heading(s);continue}case"code":{n+=this.renderer.code(s);continue}case"table":{n+=this.renderer.table(s);continue}case"blockquote":{n+=this.renderer.blockquote(s);continue}case"list":{n+=this.renderer.list(s);continue}case"html":{n+=this.renderer.html(s);continue}case"paragraph":{n+=this.renderer.paragraph(s);continue}case"text":{let i=s,l=this.renderer.text(i);for(;a+1<t.length&&t[a+1].type==="text";)i=t[++a],l+=`
`+this.renderer.text(i);r?n+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l,escaped:!0}]}):n+=l;continue}default:{let i='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return n}parseInline(t,r=this.renderer){let n="";for(let a=0;a<t.length;a++){let o=t[a];if(this.options.extensions?.renderers?.[o.type]){let i=this.options.extensions.renderers[o.type].call({parser:this},o);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=i||"";continue}}let s=o;switch(s.type){case"escape":{n+=r.text(s);break}case"html":{n+=r.html(s);break}case"link":{n+=r.link(s);break}case"image":{n+=r.image(s);break}case"strong":{n+=r.strong(s);break}case"em":{n+=r.em(s);break}case"codespan":{n+=r.codespan(s);break}case"br":{n+=r.br(s);break}case"del":{n+=r.del(s);break}case"text":{n+=r.text(s);break}default:{let i='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return n}},en=class{options;block;constructor(e){this.options=e||Lt}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?gt.lex:gt.lexInline}provideParser(){return this.block?vt.parse:vt.parseInline}},wb=class{defaults=Da();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=vt;Renderer=wn;TextRenderer=Va;Lexer=gt;Tokenizer=bn;Hooks=en;constructor(...e){this.use(...e)}walkTokens(e,t){let r=[];for(let n of e)switch(r=r.concat(t.call(this,n)),n.type){case"table":{let a=n;for(let o of a.header)r=r.concat(this.walkTokens(o.tokens,t));for(let o of a.rows)for(let s of o)r=r.concat(this.walkTokens(s.tokens,t));break}case"list":{let a=n;r=r.concat(this.walkTokens(a.items,t));break}default:{let a=n;this.defaults.extensions?.childTokens?.[a.type]?this.defaults.extensions.childTokens[a.type].forEach(o=>{let s=a[o].flat(1/0);r=r.concat(this.walkTokens(s,t))}):a.tokens&&(r=r.concat(this.walkTokens(a.tokens,t)))}}return r}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let o=t.renderers[a.name];o?t.renderers[a.name]=function(...s){let i=a.renderer.apply(this,s);return i===!1&&(i=o.apply(this,s)),i}:t.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=t[a.level];o?o.unshift(a.tokenizer):t[a.level]=[a.tokenizer],a.start&&(a.level==="block"?t.startBlock?t.startBlock.push(a.start):t.startBlock=[a.start]:a.level==="inline"&&(t.startInline?t.startInline.push(a.start):t.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(t.childTokens[a.name]=a.childTokens)}),n.extensions=t),r.renderer){let a=this.defaults.renderer||new wn(this.defaults);for(let o in r.renderer){if(!(o in a))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let s=o,i=r.renderer[s],l=a[s];a[s]=(...u)=>{let p=i.apply(a,u);return p===!1&&(p=l.apply(a,u)),p||""}}n.renderer=a}if(r.tokenizer){let a=this.defaults.tokenizer||new bn(this.defaults);for(let o in r.tokenizer){if(!(o in a))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let s=o,i=r.tokenizer[s],l=a[s];a[s]=(...u)=>{let p=i.apply(a,u);return p===!1&&(p=l.apply(a,u)),p}}n.tokenizer=a}if(r.hooks){let a=this.defaults.hooks||new en;for(let o in r.hooks){if(!(o in a))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let s=o,i=r.hooks[s],l=a[s];en.passThroughHooks.has(o)?a[s]=u=>{if(this.defaults.async)return Promise.resolve(i.call(a,u)).then(f=>l.call(a,f));let p=i.call(a,u);return l.call(a,p)}:a[s]=(...u)=>{let p=i.apply(a,u);return p===!1&&(p=l.apply(a,u)),p}}n.hooks=a}if(r.walkTokens){let a=this.defaults.walkTokens,o=r.walkTokens;n.walkTokens=function(s){let i=[];return i.push(o.call(this,s)),a&&(i=i.concat(a.call(this,s))),i}}this.defaults={...this.defaults,...n}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return gt.lex(e,t??this.defaults)}parser(e,t){return vt.parse(e,t??this.defaults)}parseMarkdown(e){return(t,r)=>{let n={...r},a={...this.defaults,...n},o=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&n.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));a.hooks&&(a.hooks.options=a,a.hooks.block=e);let s=a.hooks?a.hooks.provideLexer():e?gt.lex:gt.lexInline,i=a.hooks?a.hooks.provideParser():e?vt.parse:vt.parseInline;if(a.async)return Promise.resolve(a.hooks?a.hooks.preprocess(t):t).then(l=>s(l,a)).then(l=>a.hooks?a.hooks.processAllTokens(l):l).then(l=>a.walkTokens?Promise.all(this.walkTokens(l,a.walkTokens)).then(()=>l):l).then(l=>i(l,a)).then(l=>a.hooks?a.hooks.postprocess(l):l).catch(o);try{a.hooks&&(t=a.hooks.preprocess(t));let l=s(t,a);a.hooks&&(l=a.hooks.processAllTokens(l)),a.walkTokens&&this.walkTokens(l,a.walkTokens);let u=i(l,a);return a.hooks&&(u=a.hooks.postprocess(u)),u}catch(l){return o(l)}}}onError(e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let n="<p>An error occurred:</p><pre>"+it(r.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(r);throw r}}},Dt=new wb;function X(e,t){return Dt.parse(e,t)}X.options=X.setOptions=function(e){return Dt.setOptions(e),X.defaults=Dt.defaults,Au(X.defaults),X};X.getDefaults=Da;X.defaults=Lt;X.use=function(...e){return Dt.use(...e),X.defaults=Dt.defaults,Au(X.defaults),X};X.walkTokens=function(e,t){return Dt.walkTokens(e,t)};X.parseInline=Dt.parseInline;X.Parser=vt;X.parser=vt.parse;X.Renderer=wn;X.TextRenderer=Va;X.Lexer=gt;X.lexer=gt.lex;X.Tokenizer=bn;X.Hooks=en;X.parse=X;X.options;X.setOptions;X.use;X.walkTokens;X.parseInline;vt.parse;gt.lex;const kb=zi({apiKey:"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"}),xb=document.querySelector("form"),Yr=document.querySelector("#chat-messages"),ks=document.querySelector("#submit");xb.addEventListener("submit",async e=>{e.preventDefault();const t=document.querySelector("#input").value.trim();if(t===""){alert("no puede ir vacio");return}ks.disabled=!0;const r=Ky({model:kb("deepseek/deepseek-chat-v3-0324:free"),prompt:t,system:"Eres desarrollador frontend senior con varios aos de experiencia",temperature:1});for(;Yr.firstChild;)Yr.removeChild(Yr.firstChild);let n="";for await(const a of r.textStream){n+=a;const o=X(n);Yr.innerHTML=L_.sanitize(o),console.log(n)}ks.disabled=!1});
